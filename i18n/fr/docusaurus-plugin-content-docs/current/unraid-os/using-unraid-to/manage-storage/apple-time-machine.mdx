---
sidebar_position: 5
sidebar_label: Apple Time Machine
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Apple Time Machine

L’outil de sauvegarde Time Machine d’Apple est fourni avec chaque Mac. Il facilite la protection de vos fichiers, applications et paramètres système en les sauvegardant automatiquement. En connectant Time Machine à votre serveur Unraid, vous pouvez stocker ces sauvegardes en toute sécurité sur votre propre matériel. Cette configuration vous offre non seulement plus de contrôle mais permet également une évolutivité plus facile et une tranquillité d'esprit accrue.

::::note[macOS compatibilité]

Ce guide s'applique aux versions macOS Ventura (13.x), Sonoma (14.x), et Sequoia (15.x). Certaines fonctionnalités, comme les améliorations de %%SMB|samba%% et la prise en charge de Time Machine via %%SMB|samba%%, nécessitent des versions de macOS qui supportent ces protocoles.

Pour obtenir les meilleurs résultats, gardez votre Mac à jour avec la dernière version de macOS compatible avec votre matériel.
:::caution[mises en garde macOS Sequoia (15.x)]

Certains utilisateurs signalent des problèmes intermittents avec Time Machine et les partages réseau sur macOS Sequoia. Si vous rencontrez des échecs de sauvegarde, envisagez d'utiliser le [conteneur Docker Time Machine](https://unraid.net/community/apps?q=time+machine#r) comme alternative.

:::
::::

## Créer un partage Time Machine

:::caution[Before you begin]

Assurez-vous que **%%SMB|samba%%** est activé dans le %%WebGUI|web-gui%% :

1. Dans le %%WebGUI|web-gui%%, allez à **Partages** et cliquez sur **Ajouter un %%user share|user-share%%**.
2. Réglez **Activer %%SMB|samba%%** sur **Oui** (vous devez arrêter le %%array&#124;array%% pour changer cela).
3. Cliquez sur **Appliquer** pour créer le %%user share|user-share%%.

<div style={{ margin: 'auto', maxWidth: '600px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
  ![Interopérabilité macOS améliorée](/img/enhancedmacos.png)
</div>

:::

Pour créer un partage Time Machine :

1. Dans le %%WebGUI|web-gui%%, allez à **Partages** et cliquez sur **Ajouter un %%user share|user-share%%**.

2. Configurez les paramètres suivants :

   | Paramètre                                      | Description                                                                                                                                                                                                    |
   | ---------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **Nom du %%partage utilisateur\|user-share%%** | Nommez votre %%user share\|user-share%% (par exemple, Time Machine).                                                                                                                                           |
   | **Espace libre minimum**                       | Set to **1** (1 KB) for best results. This prevents Time Machine from failing when disks approach capacity.                                                                                                    |
   | **Disque(s) inclus**                           | Sélectionnez le(s) disque(s) dans le %%array\|array%% à utiliser pour le %%user share\|user-share%% Time Machine.                                                                                              |
   | **Activer l'écriture différée**                | Gardez sur **Auto** pour de meilleures performances.                                                                                                                                                           |
   | **Exportation %%SMB\|samba%%**                 | Réglez sur **Oui (Time Machine)** pour activer la prise en charge de Time Machine.                                                                                                                             |
   | **Taille du volume Time Machine**              | Set to your desired maximum size, or leave unset. If not setting minimum free space to 1, apply the share first, then re-edit and set volume size to less than the calculated minimum free space that appears. |
   | **Paramètres de sécurité**                     | Configurer les paramètres de sécurité %%SMB\|samba%% selon votre convenance.                                                                                                                                   |

3. Cliquez sur **Appliquer** pour créer le %%user share|user-share%%.

Pour plus de détails sur la création et la gestion des partages, consultez [Shares utilisateurs](./shares.mdx).

## Connexion depuis macOS

Pour vous connecter à votre %%user share|user-share%% depuis votre Mac :

1. Dans **Finder**, appuyez sur **Command + K** pour ouvrir la fenêtre "Se connecter au serveur".
2. Enter the %%SMB|samba%% address of your Unraid server. For example, use the format `smb://[server-ip]/[Time Machine share name]` and click **Connect**.
3. Lorsque cela est demandé, entrez votre nom d'utilisateur et mot de passe Unraid pour accéder au partage, puis cliquez sur **Connecter**.
4. Open **System Settings** if you're using macOS Ventura 13.0 or later, or **System Preferences** if you're on macOS Monterey 12.x or earlier. Then navigate to **Time Machine**.
5. Cliquez sur **Sélectionner le disque** ou **Ajouter un disque de sauvegarde**, choisissez votre %%user share&#124;user-share%% Time Machine Unraid, puis cliquez sur **Utiliser le disque**.
6. (Optionnel) Si vous souhaitez protéger votre sauvegarde par un mot de passe, activez **Crypter les sauvegardes**.
7. Si cela s'avère nécessaire, confirmez la connexion et re-saisissez vos identifiants %%root user|root-user%% Unraid si besoin.
8. Time Machine will start the initial backup automatically. Keep in mind that the first backup may take a while, but future backups will be faster since they are incremental.

:::tip

Pour créer des sauvegardes distinctes pour différents utilisateurs ou Macs sur votre serveur Unraid :

<div style={{ margin: 'auto', maxWidth: '600px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
  ![Éditeur Time Machine](/img/TimeMachineEditor.png)
</div>

:::

## Configurations multiples de Time Machine

:::tip

Pour les familles ou les environnements avec plusieurs Macs, cette méthode offre une séparation claire des sauvegardes, améliore la sécurité et simplifie la gestion.

:::

Pour créer des sauvegardes distinctes pour différents utilisateurs ou Macs sur votre serveur Unraid :

1. **Create unique Unraid %%root user|root-user%% accounts** for each person or Mac that will back up data. For example, users named `larry`, `curly`, and `moe`. This ensures that each user has their own identity and permissions.

2. **Create individual Time Machine %%user shares|user-share%%** for each user, naming them clearly to match the user, such as `tm-larry`, `tm-curly`, and `tm-moe`. Keeping shares separate helps with managing storage and access for each user.

3. **Attribuez les autorisations utilisateur appropriées** pour chaque %%user share|user-share%% :
   - Réglez les paramètres de sécurité %%SMB|samba%% du %%user share|user-share%% pour s'assurer que seul l'utilisateur correspondant a accès.
   - Assurez-vous que seul l'utilisateur prévu peut lire et écrire sur son %%user share|user-share%% Time Machine.

4. **Configurez Time Machine sur chaque Mac** pour se connecter à son %%user share|user-share%% désigné :
   - Sur chaque Mac, connectez-vous au serveur Unraid en utilisant le chemin %%SMB|samba%% pour leur %%user share|user-share%% spécifique (par exemple, `smb://unraid-server/tm-larry`).
   - Suivez les étapes habituelles de configuration de Time Machine pour sélectionner le %%user share|user-share%% comme disque de sauvegarde.

5. **Surveillez et gérez l'utilisation de l'espace de stockage** :
   - Vous pouvez éventuellement définir des limites de taille de volume sur chaque %%user share|user-share%% Time Machine pour empêcher un utilisateur de prendre trop d'espace.
   - Vérifiez régulièrement l'utilisation et ajustez les quotas si nécessaire.

Pour plus d'informations sur la gestion des utilisateurs et la sécurité, voir [Gestion des utilisateurs](../../system-administration/secure-your-server/user-management.mdx).

## Dépannage

Si les sauvegardes Time Machine échouent ou deviennent peu fiables :

1. **Essayez le conteneur Docker Time Machine** : [Disponible via les Applications Communautaires](https://unraid.net/community/apps?q=time+machine#r), cette option peut fournir des sauvegardes plus stables que les %%user shares|user-share%% %%SMB|samba%% directs.
2. **Vérifiez le pare-feu macOS** : Désactivez temporairement le pare-feu pour voir s'il bloque les connexions.
3. **Créez une nouvelle destination de sauvegarde** : Supprimez et recréez le %%user share|user-share%% Time Machine si les problèmes persistent.

Pour plus d'aide en matière de dépannage, consultez [Dépannage](../../troubleshooting/troubleshooting.mdx) ou visitez les [forums Unraid](https://forums.unraid.net/).
