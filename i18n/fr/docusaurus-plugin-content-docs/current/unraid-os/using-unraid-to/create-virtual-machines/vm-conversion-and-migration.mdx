---
sidebar_position: 5
sidebar_label: VM conversion & migration
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# VM conversion and migration

When consolidating hardware, preserving legacy systems, or testing upgrades in a virtual environment, you may need to convert a physical disk or migrate an existing system into a %%virtual machine|vm%% on Unraid. This process applies to both Linux and Windows systems, enabling you to run your installation as a %%VM|vm%% within your Unraid server.

:::note\[Prerequisites]

- Your Unraid server should meet the minimum [hardware requirements for virtualization](./overview-and-system-prep.mdx#requirements) (see table below).
- The source disk must be connected to your Unraid server (via SATA, USB, or as an unassigned device).
- Ensure you have enough free space in your **%%array|array%%** or **%%cache pool|cache-pool%%** to accommodate the new virtual disk image.
- Sauvegardez toutes les données critiques avant de démarrer le processus de conversion ou de migration.

## Hardware requirements

| Composant            | Exigence minimale                                                                 | Recommandé pour de meilleures performances                       |
| -------------------- | --------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| **Processeur**       | 64-bit with hardware virtualization (%%Intel VT-X\|intel-vt-x%%/%%AMD-V\|amd-v%%) | Processeur multicœur avec VT-d/AMD-Vi pour le passage direct     |
| **RAM**              | 8 Go                                                                              | 16 Go ou plus                                                    |
| **Stockage**         | Un pool de cache SSD ou NVMe %%cache pool\|cache-pool%% avec espace suffisant     | Dedicated NVMe %%cache pool\|cache-pool%% for %%VM\|vm%% storage |
| **Motherboard/BIOS** | %%UEFI\|uefi%% avec virtualisation activée                                        | %%UEFI\|uefi%% avec %%IOMMU\|iommu%%/VT-d/AMD-Vi activé          |

---

## Convert a physical disk to a VM

Migrating an existing Linux or Windows system into a %%virtual machine|vm%% on your Unraid server can be a great way to save hardware space, keep legacy systems running, or test new upgrades safely.

To convert a physical disk to a %%VM|vm%%:

<Tabs>
  <TabItem value="Linux" label="Linux" default>
    <h4>Étape 1 : Préparer le disque physique</h4>

    1. Connectez le disque source à votre serveur Unraid (en utilisant SATA ou USB).
    2. Log in to the %%WebGUI|web-gui%% (`http://tower` or `http://tower.local`).
    3. Click on the **Main** tab.
    4. Démarrez l'**%%array|array%%** s'il n'est pas déjà en cours d'exécution.
    5. Trouvez votre disque sous **Périphériques non assignés**.
    6. Notez la lettre du périphérique (par ex., `sdb`, `sdc`) et la taille du disque. Vous aurez besoin d'au moins cet espace libre sur votre **%%array|array%%** ou **%%cache pool|cache-pool%%** pour le nouveau %%virtual disk|vdisk%%.

    <h4>Étape 2 : Créer une nouvelle machine virtuelle</h4>

    Référez-vous au guide [Créer vos propres machines virtuelles](../create-virtual-machines/vm-setup.mdx#creating-your-own-virtual-machines), avec les exceptions suivantes :

    - Réglez le **BIOS** sur **OVMF**.
      Assurez-vous de spécifier l'ISO des pilotes **VirtIO** pour [des performances optimales](./overview-and-system-prep.mdx#set-up-virtualization-preferences).
    - Stockez les images %%VM|vm%% sur un **%%cache pool|cache-pool%%** au lieu d'un %%array|array%% pour les [meilleures performances](./overview-and-system-prep.mdx#user-shares-for-virtualization).

    <h4>Étape 3 : Convertir le disque physique en image de %%disque virtuel|vdisk%%</h4>

    Ouvrez un terminal ([%%SSH|ssh%%](../../system-administration/advanced-tools/command-line-interface.mdx) ou console locale) et connectez-vous en tant que `root`.

    Utilisez la commande suivante pour convertir le disque physique en image de %%disque virtuel|vdisk%% :

    ```
    qemu-img convert -p -O raw /dev/sdX /mnt/user/[vdisk_share]/[vmname]/vdisk1.img
    ```

    - **/dev/sdX** : Remplacez par la lettre du périphérique de l'étape 1 (ex. : `/dev/sdb`)
    - **[vdisk_share]** : Le partage où vous enregistrez vos images %%VM|vm%%
    - **[vmname]** : Le nom que vous souhaitez pour votre %%VM|vm%%

    **Décomposition de la commande :**

    - `qemu-img convert` : Cet outil est utilisé pour la conversion d'images disque.
    - `-p` : Affiche la progression en pourcentage.
    - `-O raw` : Définit le format de sortie sur brut (par défaut Unraid).
    - `/dev/sdX` : La source correspond à votre disque physique.
    - `/mnt/user/[vdisk_share]/[vmname]/vdisk1.img` : Destination pour l'image %%disque virtuel|vdisk%%.

    Attendez que l'opération se termine. Le fichier `.img` résultant sera le disque principal pour votre %%VM|vm%%.
  </TabItem>

  <TabItem value="Windows" label="Windows">
    <h4>Étape 1 : Modifier le XML pour votre machine virtuelle</h4>

    - Dans l'onglet %%VMs|vm%%, cliquez sur l'icône %%VM|vm%% et sélectionnez **Modifier XML** dans le menu contextuel.

    - Ensuite, faites défiler vers le bas le XML et trouvez l'étiquette `<target>` pour le `<disk>` qui a un fichier `<source>` défini sur `vdisk1.img`. Cela devrait ressembler à ceci :

      ```xml

      <disk type='file' device='disk'>
      <driver name='qemu' type='raw' cache='writeback'/>
      <source file='/mnt/cache/vdisk_share/vmname/vdisk1.img'/>
      <backingStore/>
      <target dev='hda' bus='virtio'/>
      <boot order='1'/>
      <alias name='virtio-disk0'/>
      <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>
      </disk>
      ```

    - Pour le modifier, changez l'attribut **bus** dans l'étiquette `<target>` de `virtio` à `ide`.

    - Ensuite, supprimez entièrement la ligne `<address>` pour ce `<disk>`.

    - Votre XML mis à jour devrait ressembler à ceci :

      ```xml

      <disk type='file' device='disk'>
      <driver name='qemu' type='raw' cache='writeback'/>
      <source file='/mnt/cache/vdisk_share/vmname/vdisk1.img'/>
      <backingStore/>
      <target dev='hda' bus='ide'/>
      <boot order='1'/>
      </disk>
      ```

    - Enfin, cliquez sur **Mettre à jour** pour sauvegarder vos modifications dans le XML de la %%machine virtuelle|vm%%.

    <h4>Étape 2 : Installez les pilotes VirtIO depuis l'intérieur de la VM (guests Windows uniquement)</h4>

    - Ouvrez l'**Explorateur de fichiers Windows** et accédez au %%CD-ROM virtuel VirtIO|virtio%% pour en explorer le contenu.
      - Naviguez vers le dossier **Balloon**.
      - Dans ce dossier, trouvez le sous-dossier de votre **version de Windows OS** (par exemple, `w8.1`).
      - Allez dans le sous-dossier **amd64**.
      - Cliquez avec le bouton droit sur le fichier **balloon.inf** et sélectionnez **Installer** dans le menu contextuel. (Vous devez activer la visibilité des extensions de fichier pour cela.)
    - Répétez ces étapes pour chacun des dossiers suivants :
      - **NetKVM**
      - **vioserial**
      - **viostor**
    - Après avoir installé les pilotes, revenez dans le CD-ROM virtuel et ouvrez le dossier **guest-agent**.
    - Double-cliquez sur **qemu-ga-x64.msi** pour installer l'agent invité %%QEMU|qemu%%/%%KVM|kvm%%.

    <h4>Étape 3 : Convertissez le bus du disque en VirtIO</h4>

    - Si votre %%VM|vm%% est en cours d'exécution, allez-y et **arrêtez-le**.
    - Dans l'onglet **VMs**, cliquez sur l'icône %%VM|vm%% et sélectionnez **Modifier XML** dans le menu contextuel.
    - Localisez la section `<disk>` pour `vdisk1.img` et changez `bus='ide'` en `bus='virtio'` dans l'étiquette `<target>`.
    - Cliquez sur **Mettre à jour** pour enregistrer vos modifications dans le %%VM|vm%%.
    - Vous pouvez maintenant démarrer votre %%machine virtuelle|vm%% convertie !
  </TabItem>
</Tabs>

---

## Migrating a physical disk to a VM

You can run a Windows installation directly from a physical disk in an Unraid virtual machine (VM). This method helps migrate an existing Windows system without converting it to a virtual disk image. For a visual walkthrough, check out Spaceinvader One’s tutorial:\
[How to pass through hard drives, convert disks, and test performance in Unraid VMs (YouTube)](https://www.youtube.com/watch?v=QaB9HhpbDAI).

:::important[Choosing your migration approach]

**Physical disk passthrough:** This uses the original disk directly in the %%VM|vm%%.

- Pros: Fastest method, no image conversion required.
- Cons: Takes up a SATA port; Unraid cannot use the disk for other purposes when it's attached to the VM.

**Disk image conversion:** This converts the physical disk to a %%virtual disk|vdisk%% image (`.img`) for use in the %%VM|vm%%.

- Pros: More flexibility, allows the disk to be used as an Unraid share or for snapshots.
- Cons: Requires time and free space for the conversion process.

Choisissez le transfert direct si vous souhaitez une migration simple ou prévoyez de configurer un double démarrage pour le disque. Optez pour une conversion d'image pour une meilleure portabilité et des options de sauvegarde.
:::

:::note\[Prerequisites]

- Back up your Windows installation before starting.
- Have a spare USB flash drive ready for recovery tools.
- Select a hardware preparation tool that enables Windows to boot on virtualized hardware by modifying drivers and the hardware abstraction layer (HAL):
  - **Microsoft Sysprep** (free and built into Windows 8.1 and later)
  - **Acronis True Image 2025** (commercial solution with advanced migration capabilities)
- Assurez-vous que votre serveur Unraid dispose d'un port SATA ou NVMe libre pour le disque physique.
  :::

<h4>Step 1: Prepare the Windows disk for migration</h4>

Moving a Windows installation to new hardware, whether physical or virtual, can result in boot failures due to hardware differences. Follow one of the methods below to prepare your Windows system:

<h5>Option A: Microsoft sysprep (recommended - free)</h5>

Sysprep is built into Windows and eliminates unique system information, preparing Windows for different hardware.

:::note[Before running sysprep]

- Temporarily disable any antivirus software.
- Clean up unnecessary user profiles and temporary files.
- Corrigez ou supprimez toutes les applications problématiques du Microsoft Store qui pourraient empêcher sysprep de s'exécuter.
  :::

1. **Run sysprep:**
   - Open Command Prompt as an administrator.
   - Navigate to the sysprep directory:

     ```bash
     cd C:\Windows\System32\Sysprep
     ```
   - Execute sysprep with generalization:
     ```bash
     sysprep.exe /generalize /shutdown /oobe
     ```
   - The system will generalize the installation and then shut down.

2. **Install the disk in your Unraid server** after the shutdown.

<h5>Option B: Acronis True Image 2025 (commercial)</h5>

Acronis True Image 2025 features Universal Restore, which assists with hardware migration.

1. Download and install [Acronis True Image 2025](https://www.acronis.com/en-us/products/true-image/).
2. Create bootable recovery media using the included tools:
   - Choose the Windows-like interface.
   - Select the architecture that matches your Windows (32-bit or 64-bit).
3. Boot your Windows system from the Acronis recovery media.
4. Follow the on-screen instructions to apply Universal Restore to your Windows disk. This will update drivers and the HAL for better compatibility with virtualized hardware.
5. Shut down the system and install the disk in your Unraid server.

<h4>Step 2: Identify the physical disk in Unraid</h4>

1. Log in to the %%WebGUI|web-gui%% (`http://tower` or `http://tower.local`).
2. Go to the **Main** tab.
3. Start the %%array|array%% if it’s not already running.
4. Locate your disk under **Unassigned Devices**.
5. Note the device letter (for example, `sdb`, `sdc`) for use in the %%VM|vm%% configuration.

<h4>Step 3: Create a new virtual machine</h4>

1. Go to the **%%VMs|vm%%** tab in the %%WebGUI|web-gui%%. If the tab is missing, ensure that virtualization is enabled and that hardware requirements are met.
2. Click **Add VM**.
3. Follow the [Creating your own virtual machines](../create-virtual-machines/vm-setup.mdx#creating-your-own-virtual-machines) guide, using these settings:
   - Set **BIOS** to %%SeaBIOS|seabios%% (try %%OVMF|ovmf%% if %%SeaBIOS|seabios%% fails to boot).
   - Leave **OS Install ISO** blank.
   - Specify the **VirtIO Drivers ISO** for optimal performance after boot.
   - For the primary %%virtual disk|vdisk%%, select any location and size (this will be replaced in the next step).
   - Uncheck **Start VM after creation**.

<h4>Step 4: Edit the XML for your virtual machine</h4>

You'll need to modify the %%VM|vm%%'s XML configuration to connect your physical disk to the %%virtual machine|vm%%.

1. From the **VMs** tab, click the %%VM|vm%% icon, then select **Edit XML** from the context menu.

2. Scroll down in the XML and find the existing `<disk>` entry for your primary %%virtual disk|vdisk%%. This usually points to a `.img` file and will look something like this:

   ```xml

   <disk type='file' device='disk'>
   <driver name='qemu' type='raw' cache='writeback'/>
   <source file='/mnt/cache/vdisk_share/vmname/vdisk1.img'/>
   <backingStore/>
   <target dev='hda' bus='virtio'/>
   <boot order='1'/>
   <alias name='virtio-disk0'/>
   <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>
   </disk>
   ```

   Replace this block with the following, where `sdX` is the device letter or, better yet, use `/dev/disk/by-id/[your-disk-id]` for a more reliable device assignment (refer to the [Unraid Docs: Using a physical disk in a VM]):

   ```xml

   <disk type='block' device='disk'>
   <driver name='qemu' type='raw' cache='writeback'/>
   <source dev='/dev/disk/by-id/[your-disk-id]'/>
   <target dev='hdd' bus='sata'/>
   </disk>
   ```

   If your disk is IDE, change the bus from "SATA" to "IDE".

   Using `/dev/disk/by-id/` is preferred over `/dev/sdX` to ensure the disk assignment stays consistent after reboots or hardware changes.

3. Click **Update** to save your XML changes.

<h4>Step 5: Install drivers</h4>

1. Start your %%VM|vm%%.
2. Once in Windows, open Device Manager by right-clicking the Start menu and selecting **Device Manager**.
3. Look for devices marked with a yellow exclamation mark (indicating missing drivers). Right-click on each and select **Update driver**.
4. Choose **Browse my computer for drivers**.
5. Direct it to the drive where the %%VirtIO|virtio%% Drivers ISO is mounted (usually D: or E:).
6. Make sure **Include subfolders** is checked, then click **Next**.
7. Repeat this process for each device with missing drivers, commonly including: SCSI Controller, Ethernet, Balloon, and Serial devices.

Remember to reinstall those applications after migration if you use software that installs its own drivers (such as antivirus programs).

:::tip
If you are stuck at %%SeaBIOS|seabios%% with a "Booting from Hard Disk" message, it’s likely because your Windows OS was installed using %%UEFI|uefi%% instead of the traditional BIOS. In this case, recreate the VM using %%OVMF|ovmf%% as the BIOS type rather than %%SeaBIOS|seabios%%. Most modern Windows installations (Windows 8.1, 10, and 11) support %%UEFI|uefi%% and may need %%OVMF|ovmf%% to boot successfully. The rest of the conversion process will remain the same.
:::

---

## Xen to KVM migration

:::info[Historical Context]
Unraid supported %%Xen|xen-hvm%% from early 6.x versions until it was deprecated in 6.2 (September 2016) and later removed entirely. This migration guide is relevant for users upgrading from very old Unraid installations (pre-2017) to modern versions.
:::

A %%Xen|xen-hvm%% hypervisor is a virtualization platform that allows multiple operating systems to run on the same hardware. In Unraid, %%Xen|xen-hvm%% was historically used for %%virtual machines|vm%%, but %%KVM|kvm%% is now the standard. Migrating from %%Xen|xen-hvm%% to %%KVM|kvm%% is essential for utilizing modern Unraid features, enabling hardware passthrough, and ensuring compatibility with current releases.

The process of migrating a %%VM|vm%% from %%Xen|xen-hvm%% to %%KVM|kvm%% varies depending on whether your %%VM|vm%% is set up as a paravirtualized (PV) or hardware-virtualized (%%HVM|hvm%%) guest. This guide focuses specifically on converting Windows VMs that utilize Xen’s GPLPV drivers, as they require special handling.

Always create a backup of your %%Xen|xen-hvm%% virtual disk before starting this process. And test your migration on the backup to prevent data loss.

:::info[Why migrate?]
Unraid no longer supports %%Xen|xen-hvm%% from version 6.2 onward. %%KVM|kvm%% is now mandatory for VM management, hardware passthrough, and ongoing updates. Migrating ensures your VMs remain secure and compatible with new features.
:::

### Windows conversion procedure

To convert a Windows VM from %%Xen|xen-hvm%% to %%KVM|kvm%%, follow these steps. Remember to **remove any PCI device passthrough from your %%Xen|xen-hvm%% domain configuration** before you begin. These devices can be added back after the migration is complete.

<details>
  <summary><strong>Étape 1 : Déterminez si votre VM utilise les pilotes GPLPV de Xen</strong> - Cliquer pour développer/réduire</summary>

  1. Inside your %%Xen|xen-hvm%% VM, open **Windows Device Manager** (press *Windows key + X*, then select **Device Manager**).
  2. Expand **Network adapters** and check the device name.
     - If the name contains "Xen," you are using GPLPV drivers.
     - If it doesn't, skip to the step about rebooting into %%KVM|kvm%% mode.

  :::tip
  Si vous n'utilisez pas les pilotes GPLPV, vous pouvez sauter les prochaines étapes et continuer à partir de la section de redémarrage en mode %%KVM|kvm%%.
  :::
</details>

<details>
  <summary><strong>Étape 2 : Préparez Windows pour la suppression des pilotes GPLPV</strong> - Cliquer pour développer/réduire</summary>

  1. Open a command prompt as Administrator (**Start menu** → type `cmd` → right-click **Command Prompt** → select **Run as administrator**).
  2. Enter the following command:
     ```
     bcdedit -set loadoptions nogplpv
     ```
  3. Reboot your VM.
</details>

<details>
  <summary><strong>Étape 1 : Déterminez si votre VM utilise les pilotes GPLPV de Xen</strong> - Cliquer pour développer/réduire</summary>

  Après le redémarrage, purgez tous les pilotes GPLPV de %%Xen|xen-hvm%% de votre système en utilisant le processus complet de suppression manuelle documenté dans le [Wiki du projet Xen](https://wiki.xenproject.org/wiki/Xen_Windows_GPLPV).

  :::tip
  Si vous n'utilisez pas les pilotes GPLPV, vous pouvez sauter les prochaines étapes et continuer à partir de la section de redémarrage en mode %%KVM|kvm%%.
  :::
</details>

<details>
  <summary><strong>Étape 2 : Préparez Windows pour la suppression des pilotes GPLPV</strong> - Cliquer pour développer/réduire</summary>

  1. Ensure the **VM manager** is enabled:
     - Go to ***Settings → VM manager***.
     - Set **Enable VMs** to **Yes**.
     - Download the latest **VirtIO drivers ISO** for Windows by selecting it from the dropdown menu and clicking **Download**.

  2. Navigate to the **VMs** tab and click **Add VM**.

  3. Select the Windows version that matches your original %%Xen|xen-hvm%% virtual machine.

  4. Configure the basic settings:
     - **Name**: Assign a descriptive name to your VM.
     - **VirtIO drivers ISO**: Choose the version you just downloaded.

  5. Under **Primary vDisk Location**:
     - Browse and select your existing %%Xen|xen-hvm%% virtual disk.

  6. Add a **temporary secondary vDisk**:
     - Click the green plus sign.
     - Set the size to **1M** (this will enforce IDE bus compatibility during the initial boot).
     - Choose any temporary directory for the location (this will be removed later).

  7. Leave the other settings for graphics and sound at their default values, then click **Create**.

  8. Immediately force-stop the VM:
     - Click the VM icon and choose **Force stop**.

  9. Edit the VM configuration:
     - Click the VM icon and select **Edit**.
     - Switch to **XML view** using the toggle in the top-right corner.

  10. Modify the primary disk XML:
      - Locate the `<disk>` section for your primary virtual disk.
      - Remove the entire `<address>` line.
      - Change `bus='virtio'` to `bus='ide'` in the `<target>` tag.
      - Click **Update**.

  :::tip[Pourquoi le disque temporaire ?]
  Le disque temporaire de 1 Mo force Unraid à assigner le disque principal comme `hda` (IDE) au lieu de `vda` (%%VirtIO|virtio%%), permettant à Windows de démarrer sans pilotes %%VirtIO|virtio%% au départ. Ce disque temporaire sera supprimé après l'installation du pilote.
  :::
</details>

<details>
  <summary><strong>Étape 5 : Installez les pilotes VirtIO</strong> - Cliquer pour développer/réduire</summary>

  1. Start the VM from the **VMs** tab.
  2. Connect via %%VNC|vnc-session%% by clicking the VM icon and select **Start with console (VNC)**.
  3. During boot:
     - Windows will detect new hardware but might fail to install drivers.
     - Choose **Reboot later** when prompted.
  4. Open **Device Manager** (press Win+X and choose Device Manager):
     - Install drivers for each device listed under **Other devices** (like Ethernet Controller, PCI Device, etc.):
       1. Right-click the device and select **Update driver**.
       2. Choose **Browse my computer for drivers**.
       3. Point to the %%VirtIO|virtio%% ISO drive (for example, `D:\`).
       4. Check **Include subfolders**.
       5. If prompted, accept **Always trust Red Hat**.
  5. Install the %%QEMU|qemu%% %%guest agent|guest-agent%%:
     - Open File Explorer and navigate to `D:\guest-agent\`.
     - Double-click `qemu-ga-x64.msi`.
  6. Shut down the VM.
</details>

<details>
  <summary><strong>Étape 4 : Créer une nouvelle machine virtuelle KVM</strong> - Cliquer pour développer/réduire</summary>

  1. Edit the VM:
     - Remove the temporary secondary %%vDisk|vdisk%% by clicking the red minus icon.
     - Confirm that the primary %%vDisk|vdisk%% points to your original %%Xen|xen-hvm%% disk.
  2. Update the VM:
     - Click **Update** to save your changes.
  3. Start the VM normally.
  4. Verify in **Device Manager** that:
     - No warning icons appear.
     - All devices utilize %%VirtIO|virtio%% drivers (for example, "Red Hat %%VirtIO|virtio%% Ethernet Adapter").
  5. (Optional) Enable %%VirtIO|virtio%% for better performance:
     - Edit the VM and switch to XML view.
     - Change the primary disk's `bus` from `ide` to `virtio`.
     - Click **Update** and reboot the VM.

  :::tip[Pourquoi le disque temporaire ?]
  Le disque temporaire de 1 Mo force Unraid à assigner le disque principal comme `hda` (IDE) au lieu de `vda` (%%VirtIO|virtio%%), permettant à Windows de démarrer sans pilotes %%VirtIO|virtio%% au départ. Ce disque temporaire sera supprimé après l'installation du pilote.
  :::

  1. Reinstall the %%VirtIO|virtio%% drivers from the ISO.
  2. Check for Windows updates, which may provide newer drivers.
  3. Visitez la page [Red Hat VirtIO Drivers](https://docs.fedoraproject.org/en-US/quick-docs/creating-windows-virtual-machines-using-virtio-drivers/) pour les dernières versions.
     :::
</details>
