---
sidebar_position: 2
sidebar_label: Arrêts imprévus
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import UncleanShutdownsPower from './partials/unclean-shutdowns/unexpected-power-loss.mdx';
import UncleanShutdownsFlash from './partials/unclean-shutdowns/flash-drive-failure.mdx';
import UncleanShutdownsTerminal from './partials/unclean-shutdowns/open-terminal-sessions.mdx';

# Arrêts imprévus

Un arrêt inopiné se produit lorsque Unraid détecte que le %%array|array%% n'a pas été correctement arrêté avant que le système ne s'éteigne. Cette situation peut déclencher un %%parity check|parity-check%% automatique lors du prochain démarrage pour garantir l'intégrité des données.

:::important[Recommendations pour prévenir les arrêts non propres]
Prendre des mesures proactives peut vous aider à éviter ou à identifier les arrêts imprévus :

- **Utilisez un onduleur** : Gardez votre serveur connecté à un appareil d'alimentation sans interruption (UPS) et configurez-le pour initier un arrêt contrôlé lorsque l'alimentation de la batterie est faible.
- **Tentez un arrêt en douceur :** Si votre serveur ne répond pas, appuyez brièvement sur le bouton d'alimentation pour initier un arrêt sécurisé. Ne maintenez pas le bouton enfoncé, car cela provoquerait une coupure d'alimentation brutale et entraînerait un arrêt inopiné.
- **Activez la journalisation persistante :** Allez dans ***Paramètres → Serveur Syslog*** pour activer la journalisation qui persiste après un redémarrage. Voir [Journalisation persistante (serveur Syslog)](../diagnostics/capture-diagnostics-and-logs.mdx#persistent-logs-syslog-server) pour plus de détails.
- **Joindre les diagnostics pour obtenir de l'aide :** Si un arrêt inopiné se produit, Unraid essaiera de sauvegarder les diagnostics dans `/log/diagnostics.zip` sur votre périphérique flash. Joignez ce fichier aux publications sur le forum lorsque vous demandez de l'aide.
:::

:::tip[UPS meilleures pratiques de configuration]
Un onduleur bien configuré est votre meilleure défense contre les arrêts imprévus dus à une perte d'alimentation.

- **Connectez l'onduleur via USB** à votre serveur Unraid.
- **Activez le support de l'onduleur** dans ***Paramètres → Paramètres de l'onduleur***.
- **Configurer les délais d'arrêt :** Configurez l'onduleur pour déclencher un arrêt contrôlé avant que la batterie ne soit faible. Ajustez les seuils de « temps d'exécution restant de la batterie » ou « niveau de charge de la batterie » pour laisser suffisamment de temps à Unraid pour [arrêter le %%array|array%%](../../using-unraid-to/manage-storage/array-configuration.mdx#startstop-the-array) et pour éteindre en toute sécurité.
- **Testez votre configuration :** Simulez une perte de puissance pour garantir que l'onduleur et Unraid réagissent correctement.

Consultez le [plugin NUT](https://unraid.net/community/apps/c/plugins/p4?srsltid=AfmBOop675PrJQW4iqb4JBN3GyPpwDDiSmnZReq78t27XyxkFdMX8inO#:~:text=NUT%20%2D%20Network%20UPS%20Tools) pour une compatibilité plus étendue avec des modèles UPS plus avancés ou du matériel non supporté.
:::

## Événements qui causent des arrêts imprévus

Comprendre les principales causes des arrêts inopinés vous aide à les prévenir. Explorez les onglets ci-dessous pour plus de détails sur chaque scénario.

<Tabs>
  <TabItem value="puissance" label="Perte de puissance inattendue" default>
    <UncleanShutdownsPower />
  </TabItem>

  <TabItem value="flash" label="Défaillance du lecteur flash">
    <UncleanShutdownsFlash />
  </TabItem>

  <TabItem value="terminal" label="Ouvrir des sessions terminal">
    <UncleanShutdownsTerminal />
  </TabItem>
</Tabs>

---

## Configurer les délais d'arrêt

La configuration appropriée des délais d'arrêt est essentielle pour garantir que votre serveur Unraid peut arrêter tous les services efficacement, évitant ainsi les arrêts inopinés, notamment en cas de panne de courant ou de maintenance. Chaque composant de votre système - %%VM|vm%%s, conteneurs Docker, et le %%array|array%% global - a son propre paramètre de délai qui peut être ajusté.

### Paramètres de délai d'attente recommandés

| Paramètre                           | Par défaut | Minimum recommandé                                 | Où configurer                                             |
| ----------------------------------- | ---------- | -------------------------------------------------- | --------------------------------------------------------- |
| Délai d'arrêt de %%VM\|vm%%         | 60s        | 300s (5 min)                                       | ***Paramètres → Gestionnaire de VM → Arrêt VM (Avancé)*** |
| Délai d'arrêt des conteneurs Docker | 10s        | 30–60s                                             | ***Paramètres → Docker (Avancé)***                        |
| Délai d'arrêt général               | 90s        | 3 × délai de %%VM\|vm%% + délai de Docker + 15–30s | ***Paramètres → Paramètres disque → Délai d'arrêt***      |

### Délai des machines virtuelles

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Unraid arrête d'abord toutes les machines virtuelles configurées (%%VMs|vm%%) avant d'interrompre les conteneurs Docker ou l'%%array|array%% elle-même. Le délai d'arrêt de la VM détermine combien de temps Unraid attend que chaque %%VM|vm%% s'arrête correctement.

  <h4>Où définir</h4>

  - ***Paramètres → Gestionnaire de VM → Arrêt VM*** (vue Avancée activée)

  <h4>Considérer</h4>

  - %%VMs|vm%% sous Windows peuvent prendre plus de temps à s'arrêter, surtout si des mises à jour sont en attente ou si la %%VM|vm%% est en veille/hibernation.
  - Si le délai est trop court, les %%VMs|vm%% s'arrêteront de force, risquant une perte de données ou une corruption.

  <h4>Bonne pratique</h4>

  Réglez le délai sur au moins 300 secondes (5 minutes) pour les %%VMs|vm%% Windows. Planifiez les mises à jour pour qu'elles s'exécutent au démarrage, et non à l'arrêt, afin d'éviter les retards.
</details>

### Délai des conteneurs Docker

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Après les %%VMs|vm%%, Unraid arrête tous les conteneurs Docker en cours d'exécution. Le délai d'arrêt du conteneur Docker contrôle combien de temps Unraid attend pour que chaque conteneur se termine proprement.

  <h4>Où définir</h4>

  - ***Paramètres → Docker*** (vue avancée activée)

  <h4>Considérer</h4>

  - Les conteneurs sont arrêtés en parallèle.
  - Les conteneurs complexes, ou ceux avec de grandes bases de données, peuvent nécessiter plus de 10 secondes par défaut pour s'arrêter en toute sécurité.
  - Si le temps imparti expire, les conteneurs sont arrêtés de force.

  <h4>Bonne pratique</h4>
  Augmentez le délai à 30-60 secondes si vous exécutez des conteneurs Docker qui nécessitent un temps d'arrêt supplémentaire.
</details>

### Délai d'arrêt général

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Le délai d'arrêt global est le temps maximum qu'Unraid permet pour tous les processus d'arrêt - %%VM|vm%%s, Docker, et opérations sur les disques - avant de forcer un arrêt.

  <h4>Où définir</h4>

  - ***Paramètres → Paramètres disque → Délai d'arrêt***

  <h4>Comment calculer</h4>

  Additionnez vos délais %%VM|vm%% et Docker, puis ajoutez 15–30 secondes pour le démontage des disques et d'autres processus.

  - Exemple : `3 × délai d'arrêt ***VM*** + délai d'arrêt ***Docker*** + 15–30 secondes`

  <h4>Bonne pratique</h4>
  Réglez ce minuteur suffisamment haut pour couvrir votre scénario d'arrêt le plus lent, surtout si vous avez de nombreux lecteurs ou un grand %%array|array%%.
</details>

### Autonomie de la batterie UPS

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Votre UPS doit fournir suffisamment de temps de fonctionnement pour permettre à tous les délais d'arrêt de prendre fin avant que le serveur ne perde du courant.

  <h4>Où définir</h4>

  - ***Paramètres → Paramètres de l’onduleur*** (voir **Temps restant** avec tous les disques en rotation)

  <h4>Considérer</h4>

  - L'onduleur doit initier un arrêt suffisamment tôt pour permettre à la séquence d'arrêt complète de se terminer.
  - Si la batterie se décharge avant que l'arrêt ne soit terminé, vous risquez un arrêt imprévu et une possible perte de données.

  <h4>Bonne pratique</h4>

  Testez votre onduleur en simulant une panne de courant et en confirmant qu'Unraid s'arrête proprement avec du temps devant lui.
</details>
