---
sidebar_position: 2
sidebar_label: Unclean shutdowns
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import UncleanShutdownsPower from './partials/unclean-shutdowns/unexpected-power-loss.mdx';
import UncleanShutdownsFlash from './partials/unclean-shutdowns/flash-drive-failure.mdx';
import UncleanShutdownsTerminal from './partials/unclean-shutdowns/open-terminal-sessions.mdx';

# Unclean shutdowns

An unclean shutdown happens when Unraid detects that the %%array|array%% was not properly stopped before the system powered off. This situation can trigger an automatic %%parity check|parity-check%% during the next boot to ensure data integrity.

:::important[Recommendations to prevent unclean shutdowns]

- **Use a UPS:** Keep your server connected to an Uninterruptible Power Supply (UPS) and set it up to initiate a controlled shutdown when battery power runs low.
- **Attempt a graceful shutdown:** If your server is unresponsive, briefly press the power button to trigger a safe shutdown. Do not hold the button down, as this will force a hard power off and lead to an unclean shutdown.
- **Enable persistent logging:** Go to ***Settings → Syslog Server*** to activate logging that persists after a reboot. See [Persistent logs (Syslog server)](../diagnostics/capture-diagnostics-and-logs.mdx#persistent-logs-syslog-server) for more details.
- **Joindre les diagnostics pour obtenir de l'aide :** Si un arrêt inopiné se produit, Unraid essaiera de sauvegarder les diagnostics dans `/log/diagnostics.zip` sur votre périphérique flash. Joignez ce fichier aux publications sur le forum lorsque vous demandez de l'aide.
  :::

:::tip[UPS configuration best practices]

- **Connect the UPS via USB** to your Unraid server.
- **Enable UPS support** in ***Settings → UPS Settings***.
- **Configure shutdown timeouts:** Set the UPS to trigger a controlled shutdown before the battery runs low. Adjust the "Battery runtime left" or "Battery charge level" thresholds to provide enough time for Unraid to [stop the %%array|array%%](../../using-unraid-to/manage-storage/array-configuration.mdx#startstop-the-array) and power down safely.
- **Test your configuration:** Simulate a power loss to ensure the UPS and Unraid respond correctly.

Consultez le [plugin NUT](https://unraid.net/community/apps/c/plugins/p4?srsltid=AfmBOop675PrJQW4iqb4JBN3GyPpwDDiSmnZReq78t27XyxkFdMX8inO#:~:text=NUT%20%2D%20Network%20UPS%20Tools) pour une compatibilité plus étendue avec des modèles UPS plus avancés ou du matériel non supporté.
:::

## Events That Cause Unclean Shutdowns

Understanding the main triggers for unclean shutdowns helps you prevent them. Explore the tabs below for details on each scenario.

<Tabs>
  <TabItem value="puissance" label="Perte de puissance inattendue" default>
    <UncleanShutdownsPower />
  </TabItem>

  <TabItem value="flash" label="Défaillance du lecteur flash">
    <UncleanShutdownsFlash />
  </TabItem>

  <TabItem value="terminal" label="Ouvrir des sessions terminal">
    <UncleanShutdownsTerminal />
  </TabItem>
</Tabs>

---

## Configuring shutdown timeouts

Properly configuring shutdown timeouts is essential to ensure your Unraid server can stop all services effectively, preventing unclean shutdowns, particularly during power loss or maintenance. Each component of your system - %%VM|vm%%s, Docker containers, and the overall %%array|array%% - has its own timeout setting that can be adjusted.

### Recommended timeout settings

| Paramètre                     | Default | Minimum recommandé                               | Où configurer                                        |
| ----------------------------- | ------- | ------------------------------------------------ | ---------------------------------------------------- |
| Délai d'arrêt de %%VM\|vm%%   | 60s     | 300s (5 min)                                     | ***Settings → VM Manager → VM Shutdown (Advanced)*** |
| Docker container stop timeout | 10s     | 30–60s                                           | ***Paramètres → Docker (Avancé)***                   |
| Délai d'arrêt général         | 90s     | 3 × %%VM\|vm%% timeout + Docker timeout + 15–30s | ***Settings → Disk Settings → Shutdown time-out***   |

### Virtual machines timeout

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Unraid arrête d'abord toutes les machines virtuelles configurées (%%VMs|vm%%) avant d'interrompre les conteneurs Docker ou l'%%array|array%% elle-même. Le délai d'arrêt de la VM détermine combien de temps Unraid attend que chaque %%VM|vm%% s'arrête correctement.

  <h4>Où définir</h4>

  - ***Settings → VM Manager → VM Shutdown*** (enable Advanced view)

  <h4>Considérer</h4>

  - Windows %%VMs|vm%% may take longer to shut down, especially if updates are pending or the %%VM|vm%% is in sleep/hibernation.
  - If the timeout is too short, %%VMs|vm%% will be force-stopped, risking data loss or corruption.

  <h4>Bonne pratique</h4>

  Réglez le délai sur au moins 300 secondes (5 minutes) pour les %%VMs|vm%% Windows. Planifiez les mises à jour pour qu'elles s'exécutent au démarrage, et non à l'arrêt, afin d'éviter les retards.
</details>

### Docker containers timeout

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Après les %%VMs|vm%%, Unraid arrête tous les conteneurs Docker en cours d'exécution. Le délai d'arrêt du conteneur Docker contrôle combien de temps Unraid attend pour que chaque conteneur se termine proprement.

  <h4>Où définir</h4>

  - ***Settings → Docker*** (enable Advanced view)

  <h4>Considérer</h4>

  - Containers are stopped in parallel.
  - Complex containers, or those with large databases, may need more than the default 10 seconds to shut down safely.
  - If the timer expires, containers are force-stopped.

  <h4>Bonne pratique</h4>
  Augmentez le délai à 30-60 secondes si vous exécutez des conteneurs Docker qui nécessitent un temps d'arrêt supplémentaire.
</details>

### General shutdown timer

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Le délai d'arrêt global est le temps maximum qu'Unraid permet pour tous les processus d'arrêt - %%VM|vm%%s, Docker, et opérations sur les disques - avant de forcer un arrêt.

  <h4>Où définir</h4>

  - ***Settings → Disk Settings → Shutdown time-out***

  <h4>Comment calculer</h4>

  Additionnez vos délais %%VM|vm%% et Docker, puis ajoutez 15–30 secondes pour le démontage des disques et d'autres processus.

  - Example: `3 × ***VM Shutdown timeout*** + ***Docker stop timeout*** + 15–30 seconds`

  <h4>Bonne pratique</h4>
  Réglez ce minuteur suffisamment haut pour couvrir votre scénario d'arrêt le plus lent, surtout si vous avez de nombreux lecteurs ou un grand %%array|array%%.
</details>

### UPS battery life

<details>
  <summary><strong>Cliquer pour développer/réduire</strong></summary>

  Votre UPS doit fournir suffisamment de temps de fonctionnement pour permettre à tous les délais d'arrêt de prendre fin avant que le serveur ne perde du courant.

  <h4>Où définir</h4>

  - ***Settings → UPS Settings*** (see **Runtime left** with all disks spun up)

  <h4>Considérer</h4>

  - The UPS should trigger a shutdown early enough to allow the full shutdown sequence to complete.
  - If the battery runs out before shutdown completes, you risk an unclean shutdown and possible data loss.

  <h4>Bonne pratique</h4>

  Testez votre onduleur en simulant une panne de courant et en confirmant qu'Unraid s'arrête proprement avec du temps devant lui.
</details>
