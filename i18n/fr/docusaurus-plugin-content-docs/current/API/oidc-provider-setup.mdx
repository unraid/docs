---
title: Configuration du fournisseur OIDC
description: Configurez des fournisseurs OIDC (OpenID Connect) pour l'authentification SSO dans l'API Unraid
sidebar_position: 3
---

# Configuration du fournisseur OIDC

:::info[What Qu'est-ce que l'OIDC?]

Ce guide vous guide √† travers la configuration des fournisseurs OIDC (OpenID Connect) pour l'authentification SSO dans l'API Unraid en utilisant l'interface web.

:::

Ce guide vous guide √† travers la configuration des fournisseurs OIDC (OpenID Connect) pour l'authentification SSO dans l'API Unraid en utilisant l'interface web.

## üöÄ D√©marrage rapide

<details open>
  <summary><strong>Acc√©der aux param√®tres OIDC</strong></summary>

  1. Acc√©dez √† l'interface web de votre serveur Unraid
  2. Allez √† **Param√®tres** ‚Üí **Acc√®s √† la gestion** ‚Üí **API** ‚Üí **OIDC**
  3. Vous verrez des onglets pour diff√©rents fournisseurs - cliquez sur le bouton **+** pour ajouter un nouveau fournisseur
</details>

### Aper√ßu de l'interface des fournisseurs OIDC

![Page de connexion avec options SSO](/img/api/sso-with-options.png)
*Page de connexion affichant un formulaire de connexion traditionnel avec des options SSO - boutons "Connexion avec Unraid.net" et "Connexion avec Google"*

L'interface comprend :

- **Onglets de fournisseur** : Chaque fournisseur configur√© (Unraid.net, Google, etc.) appara√Æt comme un onglet
- **Bouton Ajouter un fournisseur** : Cliquez sur le bouton **+** pour ajouter de nouveaux fournisseurs
- **Mode de l'autorisation** : Basculer entre les modes "simple" et "avanc√©"
- **Section d'autorisation simple** : Configurer les domaines d'email autoris√©s et les adresses sp√©cifiques
- **Boutons Ajouter √©l√©ment** : Cliquez pour ajouter plusieurs r√®gles d'autorisation

## Comprendre les modes d'autorisation

L'interface propose deux modes d'autorisation :

### Mode simple (recommand√©)

**Quand utiliser le mode simple :**

- Autoriser des domaines d'email sp√©cifiques (e.g., @company.com)
- Autoriser des adresses email sp√©cifiques
- Configurer qui peut acc√©der √† votre serveur Unraid avec une configuration minimale

**Quand utiliser le mode simple :**

- Vous souhaitez autoriser tous les utilisateurs de votre domaine d'entreprise
- Vous avez une petite liste de utilisateurs sp√©cifiques
- Vous √™tes d√©butant dans la configuration OIDC

<details>
  <summary><strong>Mode avanc√©</strong></summary>

  Le mode avanc√© offre un contr√¥le granulaire utilisant des r√®gles bas√©es sur les assertions. Vous pouvez :

  - Cr√©er des r√®gles d'autorisation complexes bas√©es sur les revendications JWT
  - Utiliser des op√©rateurs comme √©quivaut, contient, termine par, commence par
  - Combiner plusieurs conditions avec la logique OU/ET
  - Choisir si TOUTE r√®gle doit passer (mode OU) ou si TOUTES les r√®gles doivent passer (mode ET)

  **Quand utiliser le mode avanc√© :**

  - Vous devez v√©rifier les appartenances √† des groupes
  - Vous souhaitez v√©rifier plusieurs revendications (e.g., domaine de l'email ET statut v√©rifi√©)
  - Vous avez des exigences d'autorisation complexes
  - Vous avez besoin d'un contr√¥le minutieux sur la fa√ßon dont les r√®gles sont √©valu√©es
</details>

## Exemples de mode simple

![Configuration des r√®gles d'autorisation](/img/api/advanced-rules.png)
*R√®gles avanc√©es d'autorisation montrant la configuration des revendications JWT avec l'op√©rateur termine par pour le contr√¥le d'acc√®s bas√© sur le domaine*

### Exemples de mode simple

#### Autoriser le domaine de l'entreprise

Dans l'autorisation simple :

- **Adresses email sp√©cifiques** : Ajouter des emails individuels
- Cliquez sur **Ajouter un √©l√©ment** pour ajouter plusieurs adresses

#### Autoriser des utilisateurs sp√©cifiques

- **Adresses email sp√©cifiques** : Ajouter des emails individuels
- Cliquez sur **Ajouter un √©l√©ment** pour ajouter plusieurs adresses

<details>
  <summary><strong>Exemples de mode avanc√©</strong></summary>

  #### Mode des r√®gles d'autorisation

  Lorsque vous utilisez plusieurs r√®gles, vous pouvez choisir comment elles sont √©valu√©es :

  - **Mode OU** (par d√©faut) : L'utilisateur est autoris√© si TOUTE r√®gle passe
  - **Mode ET** : L'utilisateur est autoris√© uniquement si TOUTES les r√®gles passent

  #### Domaine d'email avec v√©rification (mode ET)

  Pour exiger √† la fois le domaine de l'email ET la v√©rification :

  1. R√©glez **Mode R√®gle d'Autorisation** sur `ET`
  2. Ajouter deux r√®gles :
     - R√®gle 1 :
       - **Revendication** : `email`
       - **Op√©rateur** : `termine par`
       - **Valeur** : `@company.com`
     - R√®gle 2 :
       - **Revendication** : `email_verified`
       - **Op√©rateur** : `√©quivaut`
       - **Valeur** : `true`

  Cela assure que les utilisateurs doivent avoir √† la fois un email d'entreprise ET une adresse email v√©rifi√©e.

  #### Acc√®s bas√© sur les groupes (mode OU)

  Pour autoriser l'acc√®s √† plusieurs groupes :

  1. R√©glez **Mode R√®gle d'Autorisation** sur `OU` (par d√©faut)
  2. Ajouter des r√®gles pour chaque groupe :
     - **Revendication** : `groups`
     - **Op√©rateur** : `contient`
     - **Valeur** : `admins`
       Ou ajoutez une autre r√®gle :
     - **Revendication** : `groups`
     - **Op√©rateur** : `contient`
     - **Valeur** : `d√©veloppeurs`

  Les utilisateurs dans le groupe `admins` OU `d√©veloppeurs` seront autoris√©s.

  #### Domaines multiples

  - **Revendication** : `email`
  - **Op√©rateur** : `termine par`
  - **Valeurs** : Ajouter plusieurs domaines (par ex., `company.com`, `subsidiary.com`)

  #### Autorisation complexe (mode ET)

  Pour une s√©curit√© stricte n√©cessitant plusieurs conditions :

  1. R√©glez **Mode R√®gle d'Autorisation** sur `ET`
  2. Ajouter plusieurs r√®gles qui DOIVENT TOUTES passer :
     - L'email doit provenir du domaine de l'entreprise
     - L'email doit √™tre v√©rifi√©
     - L'utilisateur doit √™tre dans un groupe sp√©cifique
     - Le compte doit avoir une authentification √† deux facteurs activ√©e (si la r√©clamation est disponible)
</details>

<details>
  <summary><strong>D√©tails de l'interface de configuration</strong></summary>

  ### Onglets des fournisseurs

  - Chaque fournisseur configur√© appara√Æt comme un onglet en haut
  - Cliquez sur un onglet pour basculer entre les configurations des fournisseurs
  - Le bouton **+** √† droite ajoute un nouveau fournisseur

  ### Menu d√©roulant Mode d'Autorisation

  - **simple**: Id√©al pour l'autorisation bas√©e sur email (recommand√© pour la plupart des utilisateurs)
  - **avanc√©**: Pour des r√®gles complexes bas√©es sur les assertions √† l'aide de revendications JWT

  ### Champs d'Autorisation Simple

  Quand le mode "simple" est s√©lectionn√©, vous verrez :

  - **Domaines d'email autoris√©s** : Entrez des domaines sans @ (e.g., `company.com`)
    - Texte d'aide : "Les utilisateurs avec des emails se terminant par ces domaines peuvent se connecter"
  - **Adresses email sp√©cifiques** : Ajouter des adresses email individuelles
    - Texte d'aide : "Seules ces adresses email exactes peuvent se connecter"
  - **Boutons Ajouter un √©l√©ment** pour ajouter plusieurs entr√©es

  ### Champs d'Autorisation Avanc√©e

  Quand le mode "avanc√©" est s√©lectionn√©, vous verrez :

  - **Mode R√®gle d'Autorisation** : Choisissez `OU` (toute r√®gle passe) ou `ET` (toutes les r√®gles doivent passer)
  - **R√®gles d'Autorisation** : Ajouter plusieurs r√®gles bas√©es sur les revendications
  - **Pour chaque r√®gle** :
    - **Revendication** : La revendication JWT √† v√©rifier
    - **Op√©rateur** : Comment comparer (√©quivaut, contient, termine par, commence par)
    - **Valeur** : √Ä quoi appariement

  ### √âl√©ments suppl√©mentaires de l'interface

  - **Activer le bac √† sable d√©veloppeur** : Basculer pour activer le bac √† sable GraphQL sur `/graphql`
  - L'interface utilise un th√®me sombre pour une meilleure visibilit√©
  - Les indicateurs de validation des champs aident √† garantir une configuration correcte
</details>

### URI de redirection requis

:::caution[Important Configuration]

Tous les fournisseurs doivent √™tre configur√©s avec ce format exact d'URI de redirection :

:::

```bash
http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback
```

:::tip

Remplacez `YOUR_UNRAID_IP` par l'adresse IP r√©elle de votre serveur (par exemple, `192.168.1.100` ou `tower.local`).

:::

### ‚úÖ Tester votre configuration

![Page de connexion avec boutons SSO](/img/api/sso-with-options.png)
*Page de connexion Unraid affichant √† la fois l'authentification par nom d'utilisateur/mot de passe traditionnel et les options SSO avec des boutons de fournisseur personnalis√©s*

- Enregistrez votre configuration de fournisseur
- D√©connectez-vous (si connect√©)

**‚ö†Ô∏è Note de s√©curit√©** : Utilisez toujours le format URL de base lorsque possible. Le syst√®me ajoute automatiquement `/.well-known/openid-configuration` pour la d√©couverte OIDC. Utiliser directement l'URL compl√®te de d√©couverte d√©sactive les v√©rifications importantes de validation de l'√©metteur et n'est pas recommand√© par la sp√©cification OpenID Connect.

**Exemples d'URL de base correctes :**

- Google : `https://accounts.google.com`
- Microsoft/Azure : `https://login.microsoftonline.com/YOUR_TENANT_ID/v2.0`
- Keycloak : `https://keycloak.example.com/realms/YOUR_REALM`
- Authelia : `https://auth.yourdomain.com`

## ‚úÖ Tester votre configuration

![Page de connexion avec boutons SSO](/img/api/sso-with-options.png)
*Page de connexion Unraid affichant √† la fois l'authentification par nom d'utilisateur/mot de passe traditionnel et les options SSO avec des boutons de fournisseur personnalis√©s*

1. En mode simple : V√©rifiez que les domaines d'email sont correctement saisis (sans le @)
2. En mode avanc√© :
3. Activez la journalisation du d√©bogage pour voir les revendications r√©elles et l'√©valuation des r√®gles
4. Votre bouton de fournisseur configur√© devrait appara√Ætre
5. Cliquez pour tester le processus de connexion

## "URI de redirection invalide"

### Probl√®mes courants

#### Impossible de voir le bouton de connexion

- V√©rifiez qu'au moins une r√®gle d'autorisation est configur√©e
- V√©rifiez que le fournisseur est activ√©/enregistr√©

#### Mode D√©bogage

- En mode simple : V√©rifiez que les domaines d'email sont correctement saisis (sans le @)
- En mode avanc√© :
  - V√©rifiez que les noms de revendications correspondent exactement √† ce que votre fournisseur envoie
  - Assurez-vous que le Mode d'Autorisation est correctement configur√© (OU versus ET)
  - Assurez-vous que toutes les revendications requises sont pr√©sentes dans le jeton
- Activez la journalisation du d√©bogage pour voir les revendications r√©elles et l'√©valuation des r√®gles

#### "URI de redirection invalide"

- Assurez-vous que l'URI de redirection dans votre fournisseur correspond exactement
- Incluez le port correct si vous utilisez une configuration non standard
- V√©rifiez que le protocole de l'URI de redirection correspond √† la configuration de votre serveur (HTTP ou HTTPS)

#### Impossible de voir le bouton de connexion

- R√©clamations re√ßues du fournisseur
- √âvaluation des r√®gles d'autorisation

### Mode D√©bogage

Pour r√©soudre les probl√®mes :

1. Activer la journalisation du d√©bogage :

```bash
LOG_LEVEL=debug unraid-api start --debug
```

2. V√©rifiez les journaux pour :

- R√©clamations re√ßues du fournisseur
- √âvaluation des r√®gles d'autorisation
- Erreurs de validation de jeton

## üîê Meilleures pratiques de s√©curit√©

1. **Utilisez le mode simple pour l'autorisation** - Pr√©voit des configurations trop permissives et r√©duit les risques de mauvaise configuration
2. **Soyez sp√©cifique avec l'autorisation** - N'utilisez pas de r√®gles trop larges
3. **Faites tourner les secrets r√©guli√®rement** - Mettez √† jour les secrets clients p√©riodiquement
4. **Testez minutieusement** - V√©rifiez que seuls les utilisateurs pr√©vus peuvent acc√©der

## üí° Besoin d'aide¬†?

- Consultez la documentation OIDC du fournisseur
- Examinez les journaux API d'Unraid pour des messages d'erreur d√©taill√©s
- Assurez-vous que votre fournisseur prend en charge la d√©couverte standard OIDC
- V√©rifiez la connectivit√© r√©seau entre Unraid et le fournisseur

## üè¢ Configuration sp√©cifique au fournisseur

### Fournisseur Unraid.net

Le fournisseur Unraid.net est int√©gr√© et pr√©configur√©. Vous devez uniquement configurer les r√®gles d'autorisation dans l'interface.

**Configuration** :

- **URL de l'√©metteur** : `https://accounts.google.com`
- **ID/Secret Client** : De vos identifiants de client OAuth 2.0
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

:::tip[Redirect Exigences de domaine]

**Faites correspondre le protocole √† la configuration de votre serveur :** Utilisez `http://` si vous acc√©dez √† votre serveur Unraid sans SSL/TLS (typique pour un acc√®s r√©seau local). Utilisez `https://` si vous avez configur√© SSL/TLS sur votre serveur. Certains fournisseurs OIDC (comme Google) requi√®rent HTTPS et n'accepteront pas d'URI de redirection HTTP.

:::

Pour les domaines Google Workspace, utilisez le mode avanc√© avec la revendication `hd` pour restreindre l'acc√®s au domaine de votre organisation.

### Authelia

<details>
  <summary><strong>üìã √âtapes de configuration</strong></summary>

  Configurez des identifiants OAuth 2.0 dans [le Google Cloud Console](https://console.cloud.google.com/)¬†:

  1. Allez dans **APIs & Services** ‚Üí **Informations d'identification**
  2. Cliquez sur **Cr√©er des identifiants** ‚Üí **ID client OAuth**
  3. Choisissez **Application Web** comme type d'application
  4. Ajoutez votre URI de redirection √† **URIs de redirection autoris√©s**
  5. Configurez l'√©cran de consentement OAuth si vous y √™tes invit√©
</details>

**Configuration** :

- **URL de l'√©metteur** : `https://auth.votredomaine.com`
- **ID client** : `unraid-api` (ou tel que configur√© dans Authelia)
- **Port√©es requises** : `openid`, `profile`, `email`
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

:::warning[Google Exigences de domaine]

**Google requiert des noms de domaine valides pour les URI de redirection OAuth.** Les adresses IP locales et les domaines `.local` ne sont pas accept√©s. Pour utiliser Google OAuth avec votre serveur Unraid, vous aurez besoin :

- **Option 1 : Proxy inverse** - Configurez un proxy inverse (comme NGINX Proxy Manager ou Traefik) avec un nom de domaine valide pointant vers votre API Unraid
- **Option 2 : Tailscale** - Utilisez Tailscale pour obtenir un domaine `*.ts.net` valide que Google acceptera
- **Option 3 : DNS dynamique** - Utilisez un service DDNS pour obtenir un nom de domaine public pour votre serveur

N'oubliez pas de mettre √† jour votre URI de redirection √† la fois dans le Google Cloud Console et dans votre configuration OIDC Unraid pour utiliser le domaine valide.

:::

Les r√®gles d'autorisation peuvent √™tre configur√©es dans l'interface en utilisant des domaines email ou des revendications avanc√©es.

### Keycloak

Configurez le client OIDC dans votre `configuration.yml` d'Authelia avec l'ID client `unraid-api` et g√©n√©rez un secret hach√© en utilisant la commande hash-password d'Authelia.

**Configuration** :

- **URL de l'√©metteur** : `https://keycloak.exemple.com/realms/YOUR_REALM`
- **ID client** : `unraid-api` (ou tel que configur√© dans Keycloak)
- **Secret du client** : Depuis l'onglet Credentials de Keycloak
- **Port√©es requises** : `openid`, `profile`, `email`
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Pour l'autorisation bas√©e sur les r√¥les, utilisez le mode avanc√© avec les revendications `realm_access.roles` ou `resource_access`.

### Authentik

Cr√©ez un nouveau fournisseur OAuth2/OpenID dans Authentik, puis cr√©ez une application et liez-la au fournisseur.

**Configuration** :

- **URL de l'√©metteur** : `https://login.microsoftonline.com/YOUR_TENANT_ID/v2.0`
- **ID client** : Depuis la configuration du fournisseur Authentik
- **Secret du client** : Depuis la configuration du fournisseur Authentik
- **Port√©es requises** : `openid`, `profile`, `email`
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Les r√®gles d'autorisation peuvent √™tre configur√©es dans l'interface.

### Okta

Cr√©ez une nouvelle application Web OIDC dans la console d'administration Okta et assignez des utilisateurs ou des groupes appropri√©s.

**Configuration** :

- **URL de l'√©metteur** : `https://YOUR_DOMAIN.okta.com`
- **ID client** : `unraid-api` (ou tel que configur√© dans Keycloak)
- **Secret du client** : Depuis la configuration de l'application Okta
- **Port√©es requises** : `openid`, `profile`, `email`
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Les r√®gles d'autorisation peuvent √™tre configur√©es dans l'interface en utilisant des domaines email ou des revendications avanc√©es.

### Authentik

Cr√©ez un nouveau fournisseur OAuth2/OpenID dans Authentik, puis cr√©ez une application et liez-la au fournisseur.

**Configuration** :

- **URL de l'√©metteur** : `https://authentik.exemple.com/application/o/<application_slug>/`
- **ID client** : Depuis la configuration du fournisseur Authentik
- **Secret du client** : Depuis la configuration du fournisseur Authentik
- **Port√©es requises** : `openid`, `profile`, `email`
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Les r√®gles d'autorisation peuvent √™tre configur√©es dans l'interface.

### Okta

Cr√©ez une nouvelle application Web OIDC dans la console d'administration Okta et assignez des utilisateurs ou des groupes appropri√©s.

**Configuration** :

- **URL de l'√©metteur** : `https://YOUR_DOMAIN.okta.com`
- **ID client** : Depuis la configuration de l'application Okta
- **Secret du client** : Depuis la configuration de l'application Okta
- **Port√©es requises** : `openid`, `profile`, `email`
- **URI de redirection** : `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Les r√®gles d'autorisation peuvent √™tre configur√©es dans l'interface.
