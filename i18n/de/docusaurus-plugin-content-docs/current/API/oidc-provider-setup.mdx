---
title: OIDC-Anbieter-Einrichtung
description: Konfigurieren Sie OIDC (OpenID Connect)-Anbieter f√ºr die SSO-Authentifizierung in der Unraid-API
sidebar_position: 3
---

# OIDC-Anbieter-Einrichtung

:::info[What Was ist OIDC?]

Diese Anleitung f√ºhrt Sie durch die Konfiguration von OIDC (OpenID Connect)-Anbietern f√ºr die SSO-Authentifizierung in der Unraid-API √ºber die Weboberfl√§che.

:::

Diese Anleitung f√ºhrt Sie durch die Konfiguration von OIDC (OpenID Connect)-Anbietern f√ºr die SSO-Authentifizierung in der Unraid-API √ºber die Weboberfl√§che.

## üöÄ Schnellstart

<details open>
  <summary><strong>Zu den OIDC-Einstellungen gelangen</strong></summary>

  1. Navigieren Sie zur Weboberfl√§che Ihres Unraid-Servers
  2. Gehen Sie zu **Einstellungen** ‚Üí **Verwaltungszugriff** ‚Üí **API** ‚Üí **OIDC**
  3. Sie sehen Registerkarten f√ºr verschiedene Anbieter - klicken Sie auf die **+**-Schaltfl√§che, um einen neuen Anbieter hinzuzuf√ºgen
</details>

### √úberblick √ºber die OIDC-Anbieteroberfl√§che

![Login-Seite mit SSO-Optionen](/img/api/sso-with-options.png)
*Login-Seite zeigt traditionelles Login-Formular mit SSO-Optionen - "Mit Unraid.net anmelden" und "Mit Google anmelden" Schaltfl√§chen*

Die Oberfl√§che umfasst:

- **Anbieter-Registerkarten**: Jeder konfigurierte Anbieter (Unraid.net, Google usw.) erscheint als Registerkarte.
- **Anbieter hinzuf√ºgen Schaltfl√§che**: Klicken Sie auf die **+** Schaltfl√§che, um neue Anbieter hinzuzuf√ºgen
- **Autorisierungsmodus Dropdown**: Umschalten zwischen "einfachen" und "erweiterten" Modi
- **Einfache Autorisierungssektion**: Konfigurieren Sie erlaubte E-Mail-Domains und spezifische Adressen
- **Element hinzuf√ºgen Schaltfl√§chen**: Klicken Sie, um mehrere Autorisierungsregeln hinzuzuf√ºgen

## Autorisierungsmodi verstehen

Die Oberfl√§che bietet zwei Autorisierungsmodi:

### Einfacher Modus (Empfohlen)

**Wann sollte der einfache Modus verwendet werden:**

- Spezielle E-Mail-Domains zulassen (z.B. @company.com)
- Spezielle E-Mail-Adressen zulassen
- Festlegen, wer mit minimalem Setup auf Ihren Unraid-Server zugreifen kann

**Wann sollte der einfache Modus verwendet werden:**

- Sie m√∂chten alle Benutzer von Ihrer Unternehmensdomain zulassen
- Sie haben eine kleine Liste spezifischer Benutzer
- Sie sind neu in der OIDC-Konfiguration

<details>
  <summary><strong>Erweiterter Modus</strong></summary>

  Der erweiterte Modus bietet granulare Kontrolle mit regelbasierten Anspr√ºchen.

  - Komplexe Autorisierungsregeln basierend auf JWT-Anspr√ºchen erstellen
  - Operatoren wie gleich, enth√§lt, endetMit, beginntMit verwenden
  - Mehrere Bedingungen mit ODER/UND Logik kombinieren
  - W√§hlen, ob IRGENDEINE Regel bestehen muss (ODER-Modus) oder ALLE Regeln bestehen m√ºssen (UND-Modus)

  **Wann sollte der erweiterte Modus verwendet werden:**

  - Sie m√ºssen Gruppenmitgliedschaften √ºberpr√ºfen
  - Mehrfache Anspr√ºche verifizieren wollen (z.B. E-Mail-Domain UND verifizierter Status)
  - Sie haben komplexe Autorisierungsanforderungen
  - Ben√∂tigen eine feingranulare Kontrolle dar√ºber, wie Regeln bewertet werden
</details>

## Beispiele f√ºr den einfachen Modus

![Konfiguration von Autorisierungsregeln](/img/api/advanced-rules.png)
*Erweiterte Autorisierungsregeln zeigen die JWT-Anspruchskonfiguration mit E-Mail endetMit-Operator f√ºr dom√§nenbasierten Zugriffskontrolle*

### Beispiele f√ºr den einfachen Modus

#### Unternehmensdomain zulassen

Im einfachen Autorisierungsmodus:

- **Spezifische E-Mail-Adressen**: Einzelne E-Mails hinzuf√ºgen
- Klicken Sie auf **Element hinzuf√ºgen**, um mehrere Adressen hinzuzuf√ºgen

#### Spezielle Benutzer zulassen

- **Spezifische E-Mail-Adressen**: Einzelne E-Mails hinzuf√ºgen
- Klicken Sie auf **Element hinzuf√ºgen**, um mehrere Adressen hinzuzuf√ºgen

<details>
  <summary><strong>Beispiele f√ºr den erweiterten Modus</strong></summary>

  #### Autorisierungsregelmodus

  Wenn mehrere Regeln verwendet werden, k√∂nnen Sie w√§hlen, wie sie bewertet werden:

  - **ODER-Modus** (Standard): Benutzer wird autorisiert, wenn IRGENDEINE Regel besteht
  - **UND-Modus**: Benutzer wird nur autorisiert, wenn ALLE Regeln bestehen

  #### E-Mail-Domain mit Verifizierung (UND-Modus)

  Um sowohl E-Mail-Domain als auch Verifizierung zu verlangen:

  1. Setzen Sie **Autorisierungsregelmodus** auf `UND`
  2. Zwei Regeln hinzuf√ºgen:
     - Regel 1:
       - **Anspruch**: `email`
       - **Operator**: `endsWith`
       - **Wert**: `@company.com`
     - Regel 2:
       - **Anspruch**: `email_verified`
       - **Operator**: `equals`
       - **Wert**: `true`

  Dies stellt sicher, dass Benutzer sowohl √ºber eine Unternehmens-E-Mail als auch eine verifizierte E-Mail-Adresse verf√ºgen m√ºssen.

  #### Gruppenbasierter Zugriff (ODER-Modus)

  Um den Zugriff auf mehrere Gruppen zu erlauben:

  1. Setzen Sie **Autorisierungsregelmodus** auf `ODER` (Standard)
  2. F√ºgen Sie Regeln f√ºr jede Gruppe hinzu:
     - **Anspruch**: `groups`
     - **Operator**: `contains`
     - **Wert**: `admins`
       Oder eine andere Regel hinzuf√ºgen:
     - **Anspruch**: `groups`
     - **Operator**: `contains`
     - **Wert**: `developers`

  Benutzer in der `admins` ODER `developers` Gruppe werden autorisiert.

  #### Mehrere Domains

  - **Anspruch**: `email`
  - **Operator**: `endsWith`
  - **Werte**: Mehrere Domains hinzuf√ºgen (z.B. `company.com`, `subsidiary.com`)

  #### Komplexe Autorisierung (UND-Modus)

  F√ºr strenge Sicherheit, die mehrere Bedingungen erfordert:

  1. Setzen Sie **Autorisierungsregelmodus** auf `UND`
  2. F√ºgen Sie mehrere Regeln hinzu, die ALLE bestehen m√ºssen:
     - E-Mail muss von der Unternehmensdomain stammen
     - E-Mail muss verifiziert sein
     - Benutzer muss in einer spezifischen Gruppe sein
     - Konto muss 2FA aktiviert haben (wenn Anspruch verf√ºgbar)
</details>

<details>
  <summary><strong>Details zur Konfigurationsoberfl√§che</strong></summary>

  ### Anbieter-Registerkarten

  - Jeder konfigurierte Anbieter erscheint als Registerkarte oben
  - Klicken Sie auf eine Registerkarte, um zwischen Anbieter-Konfigurationen zu wechseln
  - Mit der **+** Schaltfl√§che rechts wird ein neuer Anbieter hinzugef√ºgt

  ### Autorisierungsmodus Dropdown

  - **einfach**: Am besten f√ºr E-Mail-basierte Autorisierung (empfohlen f√ºr die meisten Benutzer)
  - **erweitert**: F√ºr komplexe, anspruchsbasierte Regeln mit JWT-Anspr√ºchen

  ### Einfache Autorisierungsfelder

  Wenn der "einfache" Modus ausgew√§hlt ist, sehen Sie:

  - **Erlaubte E-Mail-Domains**: Geben Sie Domains ohne @ ein (z.B. `company.com`)
    - Hilfstext: "Benutzer mit E-Mails, die in diesen Domains enden, k√∂nnen sich einloggen"
  - **Spezifische E-Mail-Adressen**: F√ºgen Sie einzelne E-Mail-Adressen hinzu
    - Hilfstext: "Nur diese exakten E-Mail-Adressen k√∂nnen sich einloggen"
  - **Element hinzuf√ºgen**-Schaltfl√§chen, um mehrere Eintr√§ge hinzuzuf√ºgen

  ### Erweiterte Autorisierungsfelder

  Wenn der "erweiterte" Modus ausgew√§hlt ist, sehen Sie:

  - **Autorisierungsregelmodus**: W√§hlen `ODER` (jede Regel besteht) oder `UND` (alle Regeln m√ºssen bestehen)
  - **Autorisierungsregeln**: F√ºgen Sie mehrere anspruchsbasierte Regeln hinzu
  - **F√ºr jede Regel**:
    - **Anspruch**: Der JWT-Anspruch, der √ºberpr√ºft werden soll
    - **Operator**: Wie verglichen werden soll (equals, contains, endsWith, startsWith)
    - **Wert**: Gegen was abgeglichen werden soll

  ### Zus√§tzliche Schnittstellenelemente

  - **Entwickler-Sandbox aktivieren**: Umschalten, um die GraphQL-Sandbox unter `/graphql` zu aktivieren
  - Die Schnittstelle verwendet ein dunkles Thema f√ºr bessere Sichtbarkeit
  - Feldvalidierungsanzeigen helfen, die korrekte Konfiguration sicherzustellen
</details>

### Erforderliche Redirect-URI

:::caution[Important Konfiguration]

Alle Anbieter m√ºssen mit diesem genauen Redirect-URI-Format konfiguriert werden:

:::

```bash
http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback
```

:::tip

Ersetzen Sie `YOUR_UNRAID_IP` durch Ihre tats√§chliche Server-IP-Adresse (z.B. `192.168.1.100` oder `tower.local`).

:::

### ‚úÖ Konfiguration testen

![Login-Seite mit SSO-Schaltfl√§chen](/img/api/sso-with-options.png)
*Unraid-Login-Seite, die sowohl die traditionelle Benutzername/Passwort-Authentifizierung als auch SSO-Optionen mit angepassten Anbieterschaltfl√§chen anzeigt*

- Speichern Sie Ihre Anbieter-Konfiguration
- Melden Sie sich ab (falls angemeldet)

**‚ö†Ô∏è Sicherheitshinweis**: Verwenden Sie immer das Basis-URL-Format, wenn m√∂glich. Das System f√ºgt automatisch `/.well-known/openid-configuration` zur OIDC-Erkennung hinzu. Die direkte Verwendung der vollst√§ndigen Erkennungs-URL deaktiviert wichtige √úberpr√ºfungen des Ausstellungsortes und wird von der OpenID Connect-Spezifikation nicht empfohlen.

**Beispiele f√ºr korrekte Basis-URLs:**

- Google: `https://accounts.google.com`
- Microsoft/Azure: `https://login.microsoftonline.com/IHR_TENANT_ID/v2.0`
- Keycloak: `https://keycloak.example.com/realms/IHR_REALM`
- Authelia: `https://auth.ihredomain.com`

## ‚úÖ Konfiguration testen

![Login-Seite mit SSO-Schaltfl√§chen](/img/api/sso-with-options.png)
*Unraid-Login-Seite, die sowohl die traditionelle Benutzername/Passwort-Authentifizierung als auch SSO-Optionen mit angepassten Anbieterschaltfl√§chen anzeigt*

1. Im einfachen Modus: √úberpr√ºfen, ob E-Mail-Domains korrekt eingegeben sind (ohne @)
2. Im erweiterten Modus:
3. Aktivieren Sie das Debug-Logging, um tats√§chliche Anspr√ºche und Regelbewertungen anzuzeigen
4. Ihre konfigurierte Anbieterschaltfl√§che sollte angezeigt werden
5. Klicken Sie, um den Anmeldevorgang zu testen

## "Ung√ºltige Redirect-URI"

### H√§ufige Probleme

#### Anmeldeschaltfl√§che nicht sichtbar

- √úberpr√ºfen Sie, ob mindestens eine Autorisierungsregel konfiguriert ist
- Stellen Sie sicher, dass der Anbieter aktiviert/gespeichert ist

#### Debug-Modus

- Im einfachen Modus: √úberpr√ºfen, ob E-Mail-Domains korrekt eingegeben sind (ohne @)
- Im erweiterten Modus:
  - √úberpr√ºfen Sie, ob Anspruchsnamen exakt dem entsprechen, was Ihr Anbieter sendet
  - Pr√ºfen, ob der Autorisierungsregelmodus korrekt eingestellt ist (ODER vs UND)
  - Stellen Sie sicher, dass alle erforderlichen Anspr√ºche im Token vorhanden sind
- Aktivieren Sie das Debug-Logging, um tats√§chliche Anspr√ºche und Regelbewertungen anzuzeigen

#### "Ung√ºltige Redirect-URI"

- Stellen Sie sicher, dass die Redirect-URI in Ihrem Anbieter exakt √ºbereinstimmt
- Geben Sie den korrekten Port an, wenn eine nicht standardm√§√üige Konfiguration verwendet wird
- √úberpr√ºfen Sie, ob das Protokoll der Redirect-URI mit der Konfiguration Ihres Servers (HTTP oder HTTPS) √ºbereinstimmt

#### Anmeldeschaltfl√§che nicht sichtbar

- Erhaltene Anspr√ºche vom Anbieter
- Berechtigungsrichtlinienbewertung

### Debug-Modus

Um Probleme zu beheben:

1. Aktivieren Sie das Debug-Logging:

```bash
LOG_LEVEL=debug unraid-api start --debug
```

2. Protokolle √ºberpr√ºfen auf:

- Erhaltene Anspr√ºche vom Anbieter
- Berechtigungsrichtlinienbewertung
- Token-Validierungsfehler

## üîê Sicherheits-Best-Practices

1. **Einfache Methode f√ºr die Autorisierung verwenden** - Verhindert zu einladende Konfigurationen und reduziert Fehlkonfigurationsrisiken
2. **Sei spezifisch bei der Autorisierung** - Verwende keine allzu breiten Regeln
3. **Geheimnisse regelm√§√üig rotieren** - Aktualisiere die Client-Geheimnisse regelm√§√üig
4. **Gr√ºndlich testen** - Verifizieren, dass nur beabsichtigte Benutzer Zugang haben

## üí° Brauchst du Hilfe?

- √úberpr√ºfen Sie die OIDC-Dokumentation des Anbieters
- √úberpr√ºfen Sie die Unraid-API-Protokolle auf detaillierte Fehlermeldungen
- Stellen Sie sicher, dass Ihr Anbieter den OIDC-Standard unterst√ºtzt.
- √úberpr√ºfen Sie die Netzwerkverbindung zwischen Unraid und dem Anbieter

## üè¢ Anbieter-spezifische Einrichtung

### Unraid.net Anbieter

Der Unraid.net-Anbieter ist vorinstalliert und vorkonfiguriert. Sie m√ºssen nur Autorisierungsregeln in der Oberfl√§che konfigurieren.

**Konfiguration:**

- **Issuer URL**: `https://accounts.google.com`
- **Client-ID/Secret**: Von Ihren OAuth 2.0-Client-Anmeldedaten
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

:::tip[Redirect Domain-Anforderungen]

**Passen Sie das Protokoll an Ihre Serverkonfiguration an:** Verwenden Sie `http://`, wenn Sie auf Ihren Unraid-Server ohne SSL/TLS zugreifen (typisch f√ºr den Zugriff im lokalen Netzwerk). Verwenden Sie `https://`, wenn Sie SSL/TLS auf Ihrem Server konfiguriert haben. Einige OIDC-Anbieter (wie Google) erfordern HTTPS und akzeptieren keine HTTP-Redirect-URIs.

:::

F√ºr Google Workspace-Domains verwenden Sie die erweiterte Methode mit dem `hd`-Anspruch, um den Zugang auf die Domain Ihrer Organisation zu beschr√§nken.

### Authelia

<details>
  <summary><strong>üìã Einrichtungs-Schritte</strong></summary>

  Richten Sie OAuth 2.0-Anmeldedaten in der [Google Cloud Console](https://console.cloud.google.com/) ein:

  1. Gehen Sie zu **APIs & Dienste** ‚Üí **Anmeldedaten**
  2. Klicken Sie auf **Anmeldedaten erstellen** ‚Üí **OAuth Client-ID**
  3. W√§hlen Sie **Webanwendung** als Anwendungstyp aus
  4. F√ºgen Sie Ihre Redirect-URI zu **Autorisierte Redirect-URIs** hinzu
  5. Konfigurieren Sie den OAuth-Zustimmungsbildschirm, wenn Sie dazu aufgefordert werden
</details>

**Konfiguration:**

- **Issuer URL**: `https://auth.yourdomain.com`
- **Client-ID**: `unraid-api` (oder wie in Authelia konfiguriert)
- **Erforderliche Scopes**: `openid`, `profile`, `email`
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

:::warning[Google Domain-Anforderungen]

**Google erfordert g√ºltige Domainnamen f√ºr OAuth Redirect-URIs.** Lokale IP-Adressen und `.local` Domains werden nicht akzeptiert. Um Google OAuth mit Ihrem Unraid-Server zu verwenden, ben√∂tigen Sie:

- **Option 1: Reverse Proxy** - Richten Sie einen Reverse Proxy (wie NGINX Proxy Manager oder Traefik) mit einem g√ºltigen Domainnamen ein, der auf Ihre Unraid-API zeigt
- **Option 2: Tailscale** - Verwenden Sie Tailscale, um eine g√ºltige `*.ts.net` Domain zu erhalten, die Google akzeptiert
- **Option 3: Dynamisches DNS** - Verwenden Sie einen DDNS-Dienst, um einen √∂ffentlichen Domainnamen f√ºr Ihren Server zu erhalten

Vergessen Sie nicht, Ihre Redirect-URI sowohl in der Google Cloud Console als auch in Ihrer Unraid OIDC-Konfiguration zu aktualisieren, um die g√ºltige Domain zu verwenden.

:::

Berechtigungsrichtlinien k√∂nnen in der Schnittstelle mit E-Mail-Domains oder erweiterten Anspr√ºchen konfiguriert werden.

### Keycloak

Konfigurieren Sie den OIDC-Client in Ihrer Authelia `configuration.yml` mit der Client-ID `unraid-api` und generieren Sie ein gehashtes Geheimnis mit dem Authelia-Befehl hash-password.

**Konfiguration:**

- **Issuer URL**: `https://keycloak.example.com/realms/YOUR_REALM`
- **Client-ID**: `unraid-api` (oder wie in Keycloak konfiguriert)
- **Client-Secret**: Aus dem Credentials-Tab von Keycloak
- **Erforderliche Scopes**: `openid`, `profile`, `email`
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

F√ºr rollenbasierte Autorisierung verwenden Sie die erweiterte Methode mit dem `realm_access.roles`- oder `resource_access`-Anspruch.

### Authentik

Erstellen Sie einen neuen OAuth2/OpenID-Anbieter in Authentik und erstellen Sie eine Anwendung, die mit dem Anbieter verkn√ºpft ist.

**Konfiguration:**

- **Issuer URL**: `https://login.microsoftonline.com/YOUR_TENANT_ID/v2.0`
- **Client-ID**: Aus der Authentik-Anbieter-Konfiguration
- **Client-Secret**: Aus der Authentik-Anbieter-Konfiguration
- **Erforderliche Scopes**: `openid`, `profile`, `email`
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Berechtigungsrichtlinien k√∂nnen in der Schnittstelle konfiguriert werden.

### Okta

Erstellen Sie eine neue OIDC-Webanwendung in der Okta-Admin-Konsole und weisen Sie entsprechende Benutzer oder Gruppen zu.

**Konfiguration:**

- **Issuer URL**: `https://YOUR_DOMAIN.okta.com`
- **Client-ID**: `unraid-api` (oder wie in Keycloak konfiguriert)
- **Client-Secret**: Aus der Okta-Anwendungskonfiguration
- **Erforderliche Scopes**: `openid`, `profile`, `email`
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Berechtigungsrichtlinien k√∂nnen in der Schnittstelle mit E-Mail-Domains oder erweiterten Anspr√ºchen konfiguriert werden.

### Authentik

Erstellen Sie einen neuen OAuth2/OpenID-Anbieter in Authentik und erstellen Sie eine Anwendung, die mit dem Anbieter verkn√ºpft ist.

**Konfiguration:**

- **Issuer URL**: `https://authentik.example.com/application/o/<application_slug>/`
- **Client-ID**: Aus der Authentik-Anbieter-Konfiguration
- **Client-Secret**: Aus der Authentik-Anbieter-Konfiguration
- **Erforderliche Scopes**: `openid`, `profile`, `email`
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Berechtigungsrichtlinien k√∂nnen in der Schnittstelle konfiguriert werden.

### Okta

Erstellen Sie eine neue OIDC-Webanwendung in der Okta-Admin-Konsole und weisen Sie entsprechende Benutzer oder Gruppen zu.

**Konfiguration:**

- **Issuer URL**: `https://YOUR_DOMAIN.okta.com`
- **Client-ID**: Aus der Okta-Anwendungskonfiguration
- **Client-Secret**: Aus der Okta-Anwendungskonfiguration
- **Erforderliche Scopes**: `openid`, `profile`, `email`
- **Redirect-URI**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Berechtigungsrichtlinien k√∂nnen in der Schnittstelle konfiguriert werden.
