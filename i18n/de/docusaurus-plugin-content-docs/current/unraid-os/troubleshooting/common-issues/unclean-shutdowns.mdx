---
sidebar_position: 2
sidebar_label: Unclean shutdowns
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import UncleanShutdownsPower from './partials/unclean-shutdowns/unexpected-power-loss.mdx';
import UncleanShutdownsFlash from './partials/unclean-shutdowns/flash-drive-failure.mdx';
import UncleanShutdownsTerminal from './partials/unclean-shutdowns/open-terminal-sessions.mdx';

# Unclean shutdowns

An unclean shutdown happens when Unraid detects that the %%array|array%% was not properly stopped before the system powered off. This situation can trigger an automatic %%parity check|parity-check%% during the next boot to ensure data integrity.

:::important[Recommendations to prevent unclean shutdowns]

- **Use a UPS:** Keep your server connected to an Uninterruptible Power Supply (UPS) and set it up to initiate a controlled shutdown when battery power runs low.
- **Attempt a graceful shutdown:** If your server is unresponsive, briefly press the power button to trigger a safe shutdown. Do not hold the button down, as this will force a hard power off and lead to an unclean shutdown.
- **Enable persistent logging:** Go to ***Settings → Syslog Server*** to activate logging that persists after a reboot. See [Persistent logs (Syslog server)](../diagnostics/capture-diagnostics-and-logs.mdx#persistent-logs-syslog-server) for more details.
- **Diagnosen anhängen, um Unterstützung zu erhalten:** Bei einem nicht ordnungsgemäßen Herunterfahren versucht Unraid, Diagnosen in `/log/diagnostics.zip` auf Ihrem Flash-Gerät zu speichern. Fügen Sie diese Datei Forenbeiträgen hinzu, wenn Sie Hilfe suchen.
  :::

:::tip[UPS configuration best practices]

- **Connect the UPS via USB** to your Unraid server.
- **Enable UPS support** in ***Settings → UPS Settings***.
- **Configure shutdown timeouts:** Set the UPS to trigger a controlled shutdown before the battery runs low. Adjust the "Battery runtime left" or "Battery charge level" thresholds to provide enough time for Unraid to [stop the %%array|array%%](../../using-unraid-to/manage-storage/array-configuration.mdx#startstop-the-array) and power down safely.
- **Test your configuration:** Simulate a power loss to ensure the UPS and Unraid respond correctly.

Schauen Sie sich das [NUT-Plugin](https://unraid.net/community/apps/c/plugins/p4?srsltid=AfmBOop675PrJQW4iqb4JBN3GyPpwDDiSmnZReq78t27XyxkFdMX8inO#:~:text=NUT%20%2D%20Network%20UPS%20Tools) für breitere Kompatibilität mit fortschrittlicheren USV-Modellen oder nicht unterstützter Hardware an.
:::

## Events That Cause Unclean Shutdowns

Understanding the main triggers for unclean shutdowns helps you prevent them. Explore the tabs below for details on each scenario.

<Tabs>
  <TabItem value="leistung" label="Unerwarteter Stromausfall" default>
    <UncleanShutdownsPower />
  </TabItem>

  <TabItem value="Blitz" label="Fehler des Flash-Laufwerks">
    <UncleanShutdownsFlash />
  </TabItem>

  <TabItem value="terminal" label="Terminalsitzungen öffnen">
    <UncleanShutdownsTerminal />
  </TabItem>
</Tabs>

---

## Configuring shutdown timeouts

Properly configuring shutdown timeouts is essential to ensure your Unraid server can stop all services effectively, preventing unclean shutdowns, particularly during power loss or maintenance. Each component of your system - %%VM|vm%%s, Docker containers, and the overall %%array|array%% - has its own timeout setting that can be adjusted.

### Recommended timeout settings

| Einstellung                                  | Default | Empfohlene Mindestdauer                          | Wo einstellen                                        |
| -------------------------------------------- | ------- | ------------------------------------------------ | ---------------------------------------------------- |
| %%VM\|vm%% Herunterfahren-Zeitüberschreitung | 60s     | 300s (5 Min)                                     | ***Settings → VM Manager → VM Shutdown (Advanced)*** |
| Docker container stop timeout                | 10s     | 30–60s                                           | ***Einstellungen → Docker (Erweitert)***             |
| Allgemeiner Shutdown-Timeout                 | 90s     | 3 × %%VM\|vm%% timeout + Docker timeout + 15–30s | ***Settings → Disk Settings → Shutdown time-out***   |

### Virtual machines timeout

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Unraid fährt zuerst alle konfigurierten virtuellen Maschinen (%%VMs|vm%%) herunter, bevor es Docker-Container oder das %%array|array%% selbst stoppt. Die VM-Shutdown-Zeitüberschreitung bestimmt, wie lange Unraid auf das ordnungsgemäße Herunterfahren jeder %%VM|vm%% wartet.

  <h4>Wo festlegen</h4>

  - ***Settings → VM Manager → VM Shutdown*** (enable Advanced view)

  <h4>Betrachten</h4>

  - Windows %%VMs|vm%% may take longer to shut down, especially if updates are pending or the %%VM|vm%% is in sleep/hibernation.
  - If the timeout is too short, %%VMs|vm%% will be force-stopped, risking data loss or corruption.

  <h4>Best Practice</h4>

  Stellen Sie die Zeitüberschreitung auf mindestens 300 Sekunden (5 Minuten) für Windows-%%VMs|vm%%. Planen Sie Updates so, dass sie beim Start und nicht beim Herunterfahren ausgeführt werden, um Verzögerungen zu vermeiden.
</details>

### Docker containers timeout

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Nach den %%VMs|vm%% stoppt Unraid alle laufenden Docker-Container. Der Docker-Container-Stop-Timeout steuert, wie lange Unraid auf das ordnungsgemäße Beenden jedes Containers wartet.

  <h4>Wo festlegen</h4>

  - ***Settings → Docker*** (enable Advanced view)

  <h4>Betrachten</h4>

  - Containers are stopped in parallel.
  - Complex containers, or those with large databases, may need more than the default 10 seconds to shut down safely.
  - If the timer expires, containers are force-stopped.

  <h4>Best Practice</h4>
  Erhöhen Sie das Timeout auf 30–60 Sekunden, wenn Sie Docker-Container betreiben, die zusätzliche Shutdown-Zeit benötigen.
</details>

### General shutdown timer

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Der allgemeine Herunterfahr-Timeout ist die maximale Zeit, die Unraid für alle Herunterfahrprozesse - %%VM|vm%%s, Docker und Festplattenvorgänge - gewährt, bevor ein erzwungenes Herunterfahren durchgeführt wird.

  <h4>Wo festlegen</h4>

  - ***Settings → Disk Settings → Shutdown time-out***

  <h4>Wie berechnen</h4>

  Addieren Sie Ihre %%VM-%% und Docker-Timeouts, dann 15–30 Sekunden für das Unmounten von Laufwerken und andere Prozesse.

  - Example: `3 × ***VM Shutdown timeout*** + ***Docker stop timeout*** + 15–30 seconds`

  <h4>Beste Praxis</h4>
  Stellen Sie diesen Timer hoch genug ein, um Ihr langsamstes Herunterszenario abzudecken, insbesondere wenn Sie viele Laufwerke oder ein großes %%array|array%% haben.
</details>

### UPS battery life

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Ihre USV muss genügend Laufzeit bieten, um alle Shutdown-Timer ablaufen zu lassen, bevor der Server keinen Strom mehr hat.

  <h4>Wo festlegen</h4>

  - ***Settings → UPS Settings*** (see **Runtime left** with all disks spun up)

  <h4>Betrachten</h4>

  - The UPS should trigger a shutdown early enough to allow the full shutdown sequence to complete.
  - If the battery runs out before shutdown completes, you risk an unclean shutdown and possible data loss.

  <h4>Best Practice</h4>

  Testen Sie Ihre USV, indem Sie einen Stromausfall simulieren und bestätigen, dass Unraid mit genügend Zeit sauber herunterfährt.
</details>
