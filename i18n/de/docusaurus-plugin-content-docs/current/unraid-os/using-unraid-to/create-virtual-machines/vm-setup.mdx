---
sidebar_position: 2
sidebar_label: VM-Einrichtung
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# VM-Einrichtung

Setting up a %%VM|vm%% on Unraid is a flexible way to run full operating systems - such as Windows, Linux, or other platforms - alongside your containers and native apps. Whether you want to test new software, run legacy applications, host a desktop environment, or utilize hardware passthrough for gaming or creative work, Unraid's **VM Manager** makes the process approachable for all skill levels.

:::tip[New in Unraid 7.0]

Unraid 7.x brings significant enhancements to %%VMs|vm%%, including:

- %%VM|vm%%-Klone und -Snapshots
- Benutzerdefinierte %%VM|vm%%-Vorlagen
- Inline-XML-Bearbeitung/Ansicht
- Erweiterte Funktionen für GPU-Sharing und -Passthrough

Schauen Sie sich den Abschnitt [%%VM|vm%%-Manager-Funktionen](#neues-in-unraid-7x-vm-manager) für weitere Details an.

:::

Mit vorbereitetem System und festgelegten Präferenzen können Sie mithilfe des %%WebGUI|web-gui%% eine neue %%virtuelle Maschine (VM)|vm%% erstellen.

## Erstellen Ihrer eigenen virtuellen Maschinen

With your system prepared and preferences set, you can create a new %%VM|vm%% using the %%WebGUI|web-gui%%.

:::note[Before Sie beginnen]

- Klicken Sie auf **VM hinzufügen** auf der Seite **Virtuelle Maschinen**.
- Laden Sie Ihr Betriebssystem-Installations-ISO und für Windows %%VMs|vm%% die neuesten %%VirtIO|virtio%%-Treiber-ISOs in den `isos` Share hoch.
- Entscheiden Sie, ob Sie %%GPU-Passthrough|gpu-passthrough%% oder %%VNC|vnc-session%% für die Grafik verwenden möchten.

:::

Zum Erstellen einer grundlegenden %%VM|vm%%:

1. Klicken Sie auf **VM hinzufügen** auf der Seite **Virtuelle Maschinen**.
2. Setzen Sie die **Vorlage** auf **Benutzerdefiniert** oder wählen Sie eine vordefinierte OS-Vorlage für gängige Distributionen.
3. Geben Sie einen **Namen** und optional eine **Beschreibung** für Ihre %%VM|vm%% ein.
4. Aktivieren Sie **Autostart**, wenn Sie möchten, dass die %%VM|vm%% automatisch mit dem %%array|array%% gestartet wird.
5. Wählen Sie den Typ des **Betriebssystems** aus. Dadurch wird auch das %%VM|vm%%-Symbol angepasst.
6. Weisen Sie der %%VM|vm%% **CPU-Kerne** zu. Sie können bis zu der Anzahl der auf Ihrem Host verfügbaren physischen Kerne zuweisen.
7. Legen Sie den **Initialspeicher** (RAM) für die %%VM|vm%% fest. Konsultieren Sie die Dokumentation Ihres Gastbetriebssystems für empfohlene Werte.
8. Wählen Sie das **OS-Installations-ISO** aus Ihrer **isos** Freigabe.
9. Konfigurieren Sie den **primären vDisk** (Ort, Größe und Typ).
   - Die primäre %%vDisk|vdisk%% speichert das Betriebssystem der VM.
   - Fügen Sie bei Bedarf zusätzliche %%vDisks|vdisk%% mithilfe des Pluszeichens hinzu.
10. Wählen Sie eine **Grafikkarte**:
    - Wählen Sie %%VNC|vnc-session%% für den Fernzugriff oder eine physische GPU für Passthrough.
    - Weisen Sie eine USB-Tastatur/Maus zu, wenn eine physische GPU verwendet wird.
    - Legen Sie ein %%VNC|vnc-session%%-Passwort fest, falls gewünscht.
11. Weisen Sie eine **Soundkarte** zu (optional, aber erforderlich für HDMI-Audio über GPU).
12. Weisen Sie bei Bedarf **USB-Geräte** zu.
    - Geräte müssen vor dem Start der %%VM|vm%% angeschlossen werden (USB-Hotplug wird nicht unterstützt).
    - Das Unraid-USB-Flash-Gerät steht nicht zur Zuweisung zur Verfügung.
13. Klicken Sie auf **VM erstellen**. Die %%VM|vm%% startet automatisch, es sei denn, Sie deaktivieren **VM nach Erstellung starten**.

---

## Benutzerdefinierte VM-Vorlagen

Unraid 7.1+ führt Benutzer-%%VM|vm%%-Vorlagen ein, die das Speichern und Wiederverwenden Ihrer benutzerdefinierten %%VM|vm%%-Konfigurationen erleichtern. Benutzer-Vorlagen vereinfachen die %%VM|vm%%-Bereitstellung und sorgen für Konsistenz in den Setups.

Erstellen einer Benutzervorlage:

1. Bearbeiten Sie die %%VM|vm%%, die Sie als Vorlage speichern möchten.
2. Wählen Sie **Vorlage erstellen/ändern** und geben Sie einen Namen ein.
3. Ihre Vorlage ist jetzt im Bereich Benutzervorlagen auf dem **VM hinzufügen**-Bildschirm verfügbar.

Um eine Benutzervorlage zu verwenden:

- On the **VMs** page, click **Add VM** and select your template from the **User Templates** section.

Import/Export:

- Bewegen Sie den Mauszeiger über eine Benutzervorlage und klicken Sie auf den Pfeil, um sie auf Ihren Server zu exportieren oder herunterzuladen.
- Verwenden Sie auf einem anderen Unraid-System **Import aus Datei** oder **Hochladen**, um die Vorlage hinzuzufügen.

---

## Neu in Unraid 7.x: VM-Manager

Unraid 7.x introduces a range of powerful enhancements to the **%%VM|vm%% Manager**, streamlining the process of running and managing %%VMs|vm%%. These features cater to beginners and advanced users, making deploying, customizing, and optimizing your %%VMs|vm%% simpler.

:::tip\[Highlights]

- Sparen Sie Zeit mit %%VM|vm%%-Klone, Snapshots und wiederverwendbaren Vorlagen
- Optimieren Sie Leistung und Kompatibilität mit erweiterten Passthrough- und Speicheroptionen
- Genießen Sie verbesserte Sichtbarkeit und Kontrolle mit Nutzungsstatistiken und Inline-`XML`-Bearbeitung

:::

<details>
  <summary><strong>Erweiterte Grafik- und GPU-Sharing-Optionen</strong></summary>

  - **%%VM|vm%% clones & [snapshots](#vm-snapshots):** Duplicate %%VMs|vm%% or quickly save/restore their state for testing or backup.
  - **User %%VM|vm%% templates:** Save your custom %%VM|vm%% configurations and deploy new %%VMs|vm%% with just a few clicks.
  - **Inline-XML-Ansicht/Bearbeitung**: Betrachten oder kopieren Sie das vom %%WebGUI|web-gui%% generierte `XML` sofort; wechseln Sie in den `XML`-Modus für erweiterte Bearbeitungen.
  - **Autostart deaktivieren:** Wählen Sie aus, welche %%VMs|vm%% automatisch mit Ihrem %%array|array%% starten.
  - Timer/Offset-Konfigurationsoptionen
</details>

<details>
  <summary><strong>Workflow-Verbesserungen</strong></summary>

  - **PCI-Multifunktion/andere**: Weisen Sie komplexe PCI-Geräte oder Gruppen für fortgeschrittene Passthrough-Szenarien zu.
  - **%%QEMU|qemu%%-Befehlszeilen-Passthrough**: Fügen Sie benutzerdefinierte %%QEMU|qemu%%-Argumente für eine Expertenstufe %%VM|vm%%-Feinabstimmung hinzu.
  - **Speicherüberschreibung**: Geben Sie den Speicherort für jeden virtuellen %%Disk|vdisk%% der VM an.
  - **SSD-Flag & Unmap**: Optimieren Sie die %%vDisk|vdisk%%-Leistung für SSDs und aktivieren Sie Discard/Unmap-Unterstützung.
  - **`SR-IOV` für Intel-iGPU**: Teilen Sie integrierte Intel-Grafiken zwischen mehreren %%VMs|vm%%.
  - **VM-Namen-Validierung für ZFS**: Verhindern Sie die Verwendung unzulässiger Zeichen in %%VM|vm%%-Namen für [%%ZFS|zfs%%-Pools](../../advanced-configurations/optimize-storage/zfs-storage.mdx).
</details>

<details>
  <summary><strong>Erweiterte Hardware- und Speicheroptionen</strong></summary>

  - **`VirGL` & `QXL` virtuelle GPUs**: Teilen Sie Intel/AMD-GPUs zwischen mehreren Linux-%%VMs|vm%% oder nutzen Sie `QXL` für Multi-Screen/Memory-Optionen.
  - **%%CPU-Pinning|cpu-pinning%% optional**: Lassen Sie Unraid die CPU-Zuteilung automatisch verwalten oder pinnen Sie Kerne manuell nach Bedarf.
</details>

<details>
  <summary><strong>Erweiterte Grafik- und GPU-Sharing-Optionen</strong></summary>

  - View all graphics cards and %%VM|vm%%-assigned IP addresses in the %%VM|vm%% tab
  - Unterstützung für %%QEMU|qemu%% PPC64-Ziel und `qemu:override`
  - Hypervclock-Unterstützung für Windows-%%VMs|vm%%
  - „Wanderbar“ an/aus für die emulierte CPU
  - Timer/Offset-Konfigurationsoptionen
  - Keine Keymap/nogpu-Optionen für spezifische Anwendungsfälle verfügbar
  - Verbesserte Auswahl und Bearbeitung von %%VM|vm%%-Icons
  - Warnungen bei der Zuweisung der primären GPU als Passthrough (kann `vBIOS` erfordern)
  - Starten Sie Unraid-%%VMs|vm%% im GUI-Modus mit dem `QXL`-Videotreiber
  - Verschiedene Lösungen für Pfad- und Icon-Probleme in `XML`-Ansicht
</details>

---

## VM snapshots

VM snapshots allow you to save the current state of your %%VM|vm%% at a specific point in time. You can revert to that state if something goes wrong or use snapshots to test changes safely. This is particularly useful before installing new software, making configuration changes, or performing system updates.

:::info[How VM snapshots work]

When you create a snapshot, Unraid generates an "overlay file" that captures all changes made to your VM after that point. You can think of it like this:

- **Original VM disk**: This represents your VM's current state (similar to a photograph).
- **Snapshot overlay**: This is a separate file that records all changes made after the snapshot (like a list of edits).
- **VM continues running**: Your VM uses both the original disk and the overlay file together.

This setup allows you to create multiple snapshots, with each one generating its own overlay file. This means you can easily revert to any previous state.

**Example scenario:**

1. You create a snapshot called "Clean Windows Install."
2. You install some software and make changes.
3. You create another snapshot called "After Software Install."
4. You can now revert to either the clean install or the state after the software installation.
5. You can also use Block Commit or Block Pull to make changes permanent.

:::

<Tabs>
  <TabItem value="erstellen" label="Creating snapshots" default>
    To create a snapshot of your %%VM|vm%%:

    1. Go to the **VMs** page in the %%WebGUI|web-gui%%.
    2. Click on the %%VM|vm%% name to expand its details.
    3. Look for the **Snapshots** section and click **Create Snapshot**.
    4. Enter a descriptive name for your snapshot (for example, "Before Windows Update" or "Clean Install State").
    5. **Memory dump option**: In current Unraid builds, the "Memory dump" checkbox is not preselected by default. Checking it includes the %%VM|vm%%'s RAM for a full memory-backed snapshot (captures the live running state, but is larger and slower to create/restore). Leaving it unchecked creates a disk-only, crash-consistent snapshot (smaller and faster, but any unsaved in-memory data will be lost). Choose based on whether you need full live state preservation or just disk recovery.
    6. Click **Create** to save the snapshot.

    :::tip[Best Praktiken]

    - Create snapshots before making significant changes to your %%VM|vm%%.
    - Use descriptive names that help you remember what the snapshot contains.
    - Choose Memory dump based on your needs: enable it for full live state preservation, or leave it off for faster disk-only recovery.
    - Keep snapshots for important milestones, but delete old ones to save storage space.

    :::
  </TabItem>

  <TabItem value="verwalten" label="Managing snapshots">
    Once you have snapshots, you can see them listed in the %%VM|vm%%'s details section. Each snapshot shows:

    - **Name**: The name you gave the snapshot.
    - **Date**: When the snapshot was created.
    - **Size**: How much storage space it uses.

    To manage snapshots:

    1. Wechseln Sie zur Registerkarte **VMs** im %%WebGUI|web-gui%%.
    2. Click on the %%VM|vm%% name to expand its details.
    3. Navigate to the **Snapshots** section.
    4. Use the available buttons for **Revert**, **Block Commit**, **Block Pull**, or **Remove**.

    :::tip
    **Revert snapshot**: This restores your %%VM|vm%% to exactly how it was when you created the snapshot. Any changes made after the snapshot will be lost. The VM will use the original disk file as if the snapshot never existed.

    **Block Commit**: This process copies all changes from the snapshot overlay back into the original %%VM|vm%% disk file. By default, it shows "Pivot" and "Delete" options selected:

    - **Pivot**: This option switches your VM from using the overlay file back to using the original disk file. After the commit, your VM will use the original disk (which now contains the changes) instead of the overlay file.

    - **Delete**: This option removes the snapshot overlay file after the changes have been committed to the original disk.

    - **Together ("Pivot" + "Delete")**:
      - **With both selected**: Changes are committed to the original file, your VM switches back to using the original disk, and the overlay file is deleted. This is the most common choice.
      - **With both unchecked**: Changes are committed to the original file, but your VM continues using the overlay file, and the overlay file remains to capture future changes.

    Use Block Commit when you are satisfied with the changes and want to make them permanent.

    **Block Pull**: This merges the original disk data into the snapshot overlay file, making the overlay file complete and independent. Your VM continues using the overlay file, but it no longer depends on the original disk. Use this when you want to keep your current state and make the snapshot permanent.

    **Remove snapshot**: This simply deletes the snapshot overlay file without affecting your %%VM|vm%%. Your %%VM|vm%% continues using the original disk file, and any changes made after the snapshot are lost.

    :::
  </TabItem>

  <TabItem value="revert" label="Reverting to snapshots">
    If you need to go back to a previous state:

    1. Stop the %%VM|vm%% if it's currently running.
    2. Wechseln Sie zur Registerkarte **VMs** im %%WebGUI|web-gui%%.
    3. Click on the %%VM|vm%% name to expand its details.
    4. Navigate to the **Snapshots** section.
    5. Find the snapshot you want to restore and click the **Revert** button.
    6. Confirm that you want to revert (this will lose any changes made after the snapshot).
    7. Start your %%VM|vm%% - it will now be exactly as it was when you created the snapshot.

    :::caution[Data loss warning]

    Reverting to a snapshot permanently deletes any changes made after that snapshot was created. Make sure you really want to lose those changes before reverting.

    :::
  </TabItem>
</Tabs>

### Snapshot storage

Snapshots use storage space on your system. Each snapshot saves only the differences between the current state and the snapshot state; however, these differences can still accumulate over time.

Here are some points to consider:

- **QCOW2 disks** support snapshots and work well with this feature.
- **Storage location**: Snapshots are stored with your %%VM|vm%% files, so make sure you have enough space on your %%cache pools|cache-pool%% or %%array|array%%.

**Snapshot storage location:**

- Snapshot metadata is stored in `/etc/libvirt/qemu/snapshotdb/VM_name/`.
- Actual snapshot data is stored alongside your %%VM|vm%% files on %%cache pools|cache-pool%% or %%array|array%%.

:::info[Advanced snapshot concepts]

For more detailed technical information about how VM snapshots work, including block diagrams and advanced scenarios with multiple snapshots, see the [QEMU snapshots documentation](https://kashyapc.fedorapeople.org/virt/lc-2012/snapshots-handout.html).

:::

:::tip[Common use cases]

- **Before system updates**: Create a snapshot before installing Windows updates or Linux package updates. If something goes wrong, you can quickly revert to a previous version.
- **Testing software**: Install new applications or make configuration changes. If you're not satisfied with the results, revert to your clean %%VM|vm%% snapshots from before the changes.
- **Development work**: Create snapshots at different stages of your project. This lets you experiment freely and return to known good states.
- **Backup strategy**: While not a replacement for proper backups, snapshots provide quick recovery for recent changes.

:::

---

## Verwendung von virtuellen GPUs und GPU-Sharing

Unraid unterstützt jetzt fortgeschrittenes GPU-Sharing über `VirGL` und `QXL` für Linux-%%VMs|vm%% (und einige Nvidia-GPUs mit dem `Nouveau`-Treiber).

- Um `VirGL` zu verwenden: Stellen Sie **Grafikkarte** auf **Virtuell** und **VM-Konsolen-Video-Treiber** auf **VirtIO(3D)** ein.
- Um `QXL` zu verwenden: Stellen Sie **Grafikkarte** auf **Virtuell** und **VM-Konsolen-Video-Treiber** auf **`QXL` (beste)**.
- `VirGL` gibt kein Bild an einen physischen Monitor aus und ist nicht kompatibel mit Windows-%%VMs|vm%% oder Standard-Nvidia-Plugins.
- `QXL` unterstützt mehrere Bildschirme und konfigurierbaren Videospeicher.

---

## Erweiterte Optionen

<details>
  <summary>Erweitern Sie diesen Abschnitt, um Anleitungen zu erweiterten Optionen anzuzeigen</summary>

  Wechseln Sie auf der Seite **VM hinzufügen** zur **Erweiterten Ansicht**, um auf zusätzliche Einstellungen zuzugreifen.

  Hier sind die wichtigsten erweiterten Optionen, in fokussierte Abschnitte unterteilt:

  **CPU-Modus:**

  - **Host-Passthrough**: Stellt alle Host-CPU-Funktionen der %%VM|vm%% zur Verfügung, um maximale Leistung zu erzielen.
  - **Emuliert**: Verwendet ein generisches CPU-Modell, reduziert Kompatibilitätsprobleme, begrenzt jedoch die Leistung.

  **Memory-Ballooning:**

  - Legen Sie einen **Maximalspeicher**-Wert fest, um dynamische Speicherzuordnung (%%memory ballooning|memory-ballooning%%) zu ermöglichen.
  - Nicht verfügbar für %%VMs|vm%% mit zugewiesenen PCI-Geräten (z.B., %%GPU-Passthrough|gpu-passthrough%%).

  **Maschinentyp:**

  - **`i440fx`**: Standard für Windows-%%VMs|vm%%. Ändern Sie dies nur, wenn Sie Probleme mit %%GPU-Passthrough|gpu-passthrough%% haben.
  - **`Q35`**: Standard für Linux-%%VMs|vm%% und empfohlen für die meisten modernen Betriebssysteme, insbesondere mit %%GPU-Passthrough|gpu-passthrough%%.

  **BIOS-Typ:**

  - **SeaBIOS**: Traditionelles BIOS für ältere Betriebssysteme.
  - **OVMF**: %%UEFI|uefi%% BIOS erforderlich für Windows 8+, die meisten modernen Linux-Distros und %%GPU-Passthrough|gpu-passthrough%%.

  :::note
  Der BIOS-Typ kann nur beim Erstellen einer neuen %%VM|vm%% festgelegt werden.
  :::

  **Hyper-V-Erweiterungen:**

  - Für Windows-%%VMs|vm%% aktivieren Sie die Hyper-V-Erweiterungen zur Verbesserung der Kompatibilität und Leistung.

  **VirtIO-Treiber-ISO:**

  - Überschreiben Sie das Standard-%%VirtIO|virtio%%-ISO bei Bedarf, insbesondere für Tests oder bei Verwendung neuerer Treiber.

  **vDisk-Typ:**

  - **`RAW`**: Beste Leistung, weniger flexibel für Snapshots.
  - **`QCOW2`**: Unterstützt Snapshots, bietet aber etwas geringere Leistung.

  **VirtFS-Zuordnungen (Linux-VMs):**

  - Fügen Sie mehrere %%VirtFS|virtfs%%-(`9p`)-Freigaben für die Dateisystemintegration zwischen Host und Gast hinzu.
  - Siehe die [%%QEMU|qemu%% 9p-Dokumentation](http://wiki.qemu.org/Documentation/9psetup) für Details.

  **Netzwerkeinstellungen:**

  - Ändern Sie die **Netzwerk-MAC-Adresse** oder wählen Sie eine alternative **Netzwerkbrücke** aus.
  - Klicken Sie auf das Aktualisierungssymbol, um automatisch eine neue MAC-Adresse zu generieren.
  - Fügen Sie bei Bedarf zusätzliche virtuelle Netzwerkschnittstellen hinzu.
</details>

:::info[Troubleshooting tipps]

- Wenn Ihre %%VM|vm%% nicht startet, überprüfen Sie Ihre ISO- und %%vDisk|vdisk%%-Pfade.
- Für %%GPU-Passthrough|gpu-passthrough%%, stellen Sie sicher, dass Ihre Hardware und BIOS-Einstellungen %%IOMMU|iommu%%/VT-d/AMD-Vi unterstützen.
- Einige USB-Geräte funktionieren möglicherweise nicht zuverlässig mit Passthrough - testen Sie und konsultieren Sie das [Unraid-Forum](https://forums.unraid.net/) für gerätespezifische Ratschläge.

:::

---

## Binden von PCI-Geräten für Passthrough

Before you can assign a GPU or any PCI device to a %%VM|vm%%, it's important to "bind" the device to the **vfio-pci** driver. This process hides the device from Unraid and dedicates it solely to your %%VM|vm%%.

Um ein PCI-Gerät (GPU, USB-Controller, NVMe usw.) für das Passthrough zu binden:

1. Navigieren Sie zu ***Werkzeuge → Systemgeräte*** im %%WebGUI|web-gui%%.
2. Durchsuchen Sie die Liste aller erkannten PCI-Geräte und ihrer %%IOMMU|iommu%%-Gruppen.
3. Aktivieren Sie das Kästchen neben jedem Gerät, das Sie an **vfio-pci** binden möchten (um es vor Unraid zu verbergen).
   - Beachten Sie, dass bereits von Unraid verwendete Geräte (wie Festplattencontroller und Netzwerkkarten) nicht ausgewählt werden können.
   - Wenn Sie eine GPU auswählen, wählen Sie das zugehörige Soundgerät aus.
4. Klicken Sie auf **Ausgewählte an VFIO beim Booten binden**, um Ihre Änderungen zu speichern.
5. Starten Sie Ihren Server neu, damit das Binden wirksam wird.

:::caution

%%GPU-Passthrough|gpu-passthrough%% ermöglicht es Ihnen, eine physische Grafikkarte direkt einer %%virtuellen Maschine (VM)|vm%% zuzuweisen, wodurch nahezu native Leistung für Gaming, kreative Arbeit oder maschinelles Lernen bereitgestellt wird.

:::

Nach dem Binden werden gebundene Geräte im Dropdown-Menü **Andere PCI-Geräte** beim Bearbeiten oder Erstellen einer %%VM|vm%% angezeigt.

<details>
  <summary>Fehlerbehebung</summary>

  - Wenn Sie zuvor das `VFIO-PCI`-Konfigurations-Plug-in verwendet haben, deinstallieren Sie es - diese Funktionalität ist jetzt integriert.
  - Um alle Bindungen zurückzusetzen, löschen Sie `/boot/config/vfio-pci.cfg` und starten Sie Ihr System neu.
  - Nach dem Neustart verwenden Sie die Schaltfläche "**VFIO-PCI-Protokoll anzeigen**" auf der Seite **Systemgeräte** für erweiterte Fehlerbehebung.
  - Denken Sie daran, dass Unraid möglicherweise nicht ohne GUI startet, wenn Sie Ihre einzige GPU binden. Stellen Sie sicher, dass Sie dafür planen.
  - Für weitere Informationen, konsultieren Sie den [offiziellen Leitfaden im Unraid-Forum](https://forums.unraid.net/topic/93781-guide-bind-devices-to-vfio-pci-for-easy-passthrough-to-vms/).
</details>

---

## GPU-Passthrough für virtuelle Maschinen

%%GPU passthrough|gpu-passthrough%% allows you to assign a physical graphics card directly to a %%VM|vm%%, providing near-native performance for gaming, creative work, or machine learning.

:::info[Why GPU-Durchreichung verwenden?]

- **Leistung:** Direkter Hardwarezugriff für anspruchsvolle Anwendungen.
- **Kompatibilität:** Grafisch-intensive Workloads ausführen, die eine dedizierte GPU erfordern.
- **Flexibilität:** Verwandeln Sie Ihren Unraid-Server in eine vielseitige Workstation.

:::

<h4>Voraussetzungen</h4>

**Hardware:**

- CPU mit Intel VT-d oder AMD-Vi Unterstützung (%%IOMMU|iommu%% im BIOS aktiviert).
- GPU kompatibel mit Passthrough (siehe [community-getestete Hardware](https://docs.google.com/spreadsheets/d/1LnGpTrXalwGVNy0PWJDURhyxa3sgqkGXmvNCIvIMenk/edit#ggid=0)).
- Ein Motherboard, das PCIe-Geräte richtig isoliert.

Um ein ROM einzuspeisen:

- Unraid 6.9+ mit aktivierter Virtualisierung.
- %%OVMF|ovmf%% (%%UEFI|uefi%%) BIOS für %%VMs|vm%% (empfohlen gegenüber %%SeaBIOS|seabios%%).

To set up GPU passthrough:

1. Stellen Sie sicher, dass Ihre Hardware %%IOMMU|iommu%% unterstützt und im BIOS aktiviert ist.
2. Aktivieren Sie Virtualisierungsfunktionen im BIOS (Intel VT-x/VT-d oder AMD-v/AMD-vi).
3. Aktualisieren Sie Unraid auf die neueste stabile Version.
4. Weisen Sie die GPU der %%VM|vm%% im %%VM|vm%%-Erstellungs- oder Bearbeitungsbildschirm im Abschnitt Grafikkarte zu.
5. Weisen Sie eine USB-Tastatur und -Maus der %%VM|vm%% zu, wenn Sie %%GPU-Passthrough|gpu-passthrough%% verwenden.
6. Verwenden Sie %%OVMF|ovmf%% BIOS für die %%VM|vm%% für bessere Kompatibilität mit %%GPU-Passthrough|gpu-passthrough%%.
7. Starten Sie die %%VM|vm%% und überprüfen Sie, ob die GPU korrekt durchgereicht wird.

:::note

Einige GPUs erfordern möglicherweise zusätzliche Konfigurationen oder ROM-Injection für das ordnungsgemäße Passthrough.

:::

### Steckenbleiben in der UEFI-Shell

Einige GPUs, insbesondere bestimmte NVIDIA-Modelle, erfordern, dass eine ROM-Datei der VM manuell bereitgestellt wird, um ordnungsgemäß zu initialisieren. Dies ist häufig erforderlich, wenn die Onboard-Firmware der GPU standardmäßig nicht korrekt durchgereicht wird und Probleme wie schwarze Bildschirme oder der Ausfall beim Booten verursacht. Das manuelle Einfügen von ROM ist ein letzter Ausweg nach dem Versuch von BIOS- und VM-Konfigurationseinstellungen.

Um ein ROM einzuspeisen:

1. **GPU-ROM herunterladen:**
   - Besuchen Sie die [TechPowerUp VGA BIOS-Datenbank](https://www.techpowerup.com/vgabios/).
   - Suchen Sie Ihr GPU-Modell und laden Sie die korrekte ROM-Datei herunter.
   - Speichern Sie das ROM in Ihrem Unraid-`isos` oder `domains`-Freigabe.

2. **Bearbeiten Sie das %%VM|vm%%-XML:**
   - Stoppen Sie die %%VM|vm%% und öffnen Sie deren XML-Konfiguration (**XML bearbeiten** aus dem %%VM|vm%%-Kontextmenü).
   - Lokalisieren Sie den `<hostdev>`-Block der GPU und fügen Sie das `<rom>` Tag hinzu:

     ```xml

     <hostdev mode='subsystem' type='pci' managed='yes'>
       <driver name='vfio'/>
       <source>
         <address domain='0x0000' bus='0x02' slot='0x00' function='0x0'/>
       </source>
       <rom file='/mnt/user/isos/gpu_roms/your_gpu.rom'/> <!-- Update path -->
       <address type='pci' domain='0x0000' bus='0x00' slot='0x05' function='0x0'/>
     </hostdev>
     ```

3. **Speichern und testen:** Klicken Sie auf **Aktualisieren** und starten Sie die %%VM|vm%%.

---

## Häufige Probleme

This section covers advanced topics and solutions for common issues when managing %%VMs|vm%% on Unraid. Expand the sections below for step-by-step instructions and troubleshooting tips.

### Einen vDisk erweitern

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  If your %%VM|vm%% is running low on disk space, you can increase the size of its %%vDisk|vdisk%% directly from the %%WebGUI|web-gui%%.

  Um eine %%vDisk|vdisk%% zu erweitern:

  1. Wechseln Sie zur Registerkarte **VMs** im %%WebGUI|web-gui%%.
  2. Stellen Sie sicher, dass die %%VM|vm%% gestoppt ist.
  3. Klicken Sie auf den Namen der VM, um deren Details zu erweitern.
  4. Suchen Sie die %%vDisk|vdisk%%, die Sie erweitern möchten. Klicken Sie auf den Wert im Feld **Kapazität**, um ihn bearbeitbar zu machen.
  5. Geben Sie die neue gewünschte Größe ein (z.B. `100G` für 100 Gigabyte) und drücken Sie **Enter**.
  6. Die neue Kapazität ist nun festgelegt.

  :::note
  Sie können ein %%vDisk|vdisk%% nicht über die Unraid-Oberfläche verkleinern; nur eine Erweiterung wird unterstützt.
  :::

  <h4>Die Partition in Ihrem Gast-Betriebssystem erweitern</h4>

  Nach dem Anpassen der Größe des %%vDisk|vdisk%% starten Sie Ihre %%VM|vm%%. Sie müssen die Partition im Gastsystem erweitern, um den neuen Speicherplatz zu nutzen:

  - **Windows:** Verwenden Sie das eingebaute Festplattenverwaltungstool, um Ihre Partition zu erweitern.

  - **Linux (LVM):** Verwenden Sie Werkzeuge wie `fdisk`, `pvresize`, `lvextend` und `resize2fs`, um Partitionen und logische Volumes zu erweitern.

    **Beispiel:**

    ```bash
    sudo fdisk /dev/vda
    sudo pvresize /dev/vda3
    sudo lvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv
    sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv
    ```

    Passen Sie die Gerätenamen bei Bedarf an Ihre Konfiguration an.

  :::tip
  Sichern Sie immer Ihre %%VM|vm%%, bevor Sie Änderungen an der Festplatte vornehmen.
  :::
</details>

### Steckenbleiben in der UEFI-Shell

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Wenn Ihre %%VM|vm%% zu einer %%UEFI|uefi%%-Shell statt zu Ihrem Betriebssystem startet, können Sie den Bootprozess manuell starten:

  Geben Sie am %%UEFI|uefi%%-Shell-Befehlsprompt ein:

  ```bash
  fs0:
  cd efi/boot
  bootx64.efi
  ```

  Die %%VM|vm%% sollte nun in Ihr Betriebssystem booten.

  :::tip
  Wenn dies häufig passiert, überprüfen Sie die Startreihenfolge Ihrer VM und stellen Sie sicher, dass die richtige %%vDisk|vdisk%% oder ISO als primäres Startgerät in den VM-Einstellungen festgelegt ist.
  :::
</details>

### Schwarzer Bildschirm nach VM-Start

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Wenn Ihre %%VM|vm%% startet, aber das Display leer bleibt:

  1. **BIOS-Einstellungen überprüfen:**
     - Primäre Grafik auf integrierte GPU (iGPU) setzen, nicht auf die Passthrough-GPU.
     - Aktualisieren Sie das Motherboard- und GPU-BIOS auf die neuesten Versionen.

  2. **%%VM|vm%%-Einstellungen anpassen:**
     - Switch from %%SeaBIOS|seabios%% to %%OVMF|ovmf%% (%%UEFI|uefi%%) in %%VM|vm%% settings.
     - Ändern Sie den **Maschinentyp** von i440fx auf Q35.

  3. **Manuelle ROM-Injektion (letztes Mittel):** [GPU-ROM manuell injizieren](#manual-rom-injection).
</details>

### Fehler: "IOMMU für Behälter konnte nicht eingestellt werden: Operation nicht erlaubt"

<details>
  <summary><strong>Klicken zum Erweitern/Reduzieren</strong></summary>

  Dieser Fehler weist typischerweise auf %%IOMMU|iommu%%-Gruppenkonflikte oder fehlende Interrupt-Remapping hin:

  1. **PCIe ACS-Override aktivieren:**
     - Gehen Sie zu ***Einstellungen → VM-Manager***.
     - Setzen Sie **PCIe ACS Override** auf *Downstream* oder *Beides*.
     - Unraid neu starten.

  2. **Unsichere Interrupts zulassen (fortgeschritten):**
     - Bearbeiten Sie `syslinux.cfg` auf Ihrem Unraid-Flash-Laufwerk:

       ```bash
       append vfio_iommu_type1.allow_unsafe_interrupts=1 initrd=/bzroot
       ```

     - Verwenden Sie dies nur, wenn Sie Ihren %%VM|vm%%-Gästen voll vertrauen.

  :::note
  Für detaillierte Erklärungen zu %%IOMMU|iommu%%-Gruppen empfehlen wir, [Alex Williamsons Blog](http://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html) zu besuchen.
  :::
</details>
