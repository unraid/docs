# Version 6.12.4 2023-08-31

## Upgrade-Hinweise

### Bekannte Probleme

Bitte beachten Sie die [6.12.0 Release-Hinweise](6.12.0.md#known-issues) für allgemein bekannte Probleme.

### Rückschritte

Bevor Sie auf eine ältere Version zurücksetzen, stellen Sie sicher, dass Bridging aktiviert ist:

- ***Einstellungen > Netzwerkeinstellungen > eth0 > Bridging aktivieren*** = Ja

Starten Sie dann das Array (zusammen mit den Docker- und VM-Diensten), um Ihre Docker-Container, VMs und WireGuard-Tunnel zu aktualisieren, sodass sie wieder mit den vorherigen Einstellungen arbeiten, die in älteren Versionen funktionieren sollten.

Sobald Sie sich in der älteren Version befinden, überprüfen Sie, ob diese Einstellungen für Ihre Konfiguration korrekt sind:

- ***Einstellungen > Docker > Hostzugriff auf benutzerdefinierte Netzwerke***
- ***Einstellungen > Docker > Docker-Benutzerdefinierter Netztyp***

Wenn Sie zu einer Version vor 6.12.0 zurückrollen, beachten Sie bitte auch die [6.12.0 Release-Hinweise](6.12.0.md#rolling-back).

## Behebung für macvlan Call Traces

Die große Neuigkeit in dieser Version ist, dass wir Probleme im Zusammenhang mit macvlan Call Traces und Abstürzen gelöst haben!

Das Problem liegt darin, dass macvlan, das für benutzerdefinierte Docker-Netzwerke verwendet wird, unzuverlässig ist, wenn die übergeordnete Schnittstelle eine
Bridge (wie br0) ist. Es funktioniert am besten auf einer physischen Schnittstelle (wie eth0) oder einem Bond (wie bond0). Wir glauben, dass dies ein lang anhaltendes Kernelproblem
ist, und haben einen [Bug-Report](https://bugzilla.kernel.org/show_bug.cgi?id=217777) eingereicht.

Wenn Sie auf macvlan-bezogene Call-Traces stoßen, empfehlen wir als ersten Schritt das Navigieren zu ***Einstellungen > Docker***,
wechseln Sie zur erweiterten Ansicht und ändern Sie den "Docker-Benutzernetzwerktyp" von macvlan auf ipvlan. Dies ist die Standardkonfiguration, die Unraid seit Version 6.11.5 ausliefert und sollte für die meisten Systeme funktionieren.
Wenn Sie mit dieser Einstellung zufrieden sind, sind Sie fertig! Sie werden keine Call-Traces im Zusammenhang mit macvlan mehr haben
und können zum [nächsten Abschnitt](#system-drivers-page) übergehen.

Einige Benutzer meldeten jedoch Probleme mit der Portweiterleitung von bestimmten Routern (Fritzbox) und verminderter Funktionalität bei fortschrittlichen Netzwerkmanagement-Tools (Ubiquiti) im ipvlan-Modus.

Für diese Benutzer haben wir eine neue Methode, die das Networking überarbeitet, um Probleme mit macvlan zu vermeiden. Passen Sie ein paar Einstellungen an, und Ihre
Docker-Container, VMs und WireGuard-Tunnel sollten sich automatisch anpassen:

- ***Einstellungen > Netzwerkeinstellungen > eth0 > Bonding aktivieren*** = Ja oder Nein, beide Lösungen funktionieren
- ***Einstellungen > Netzwerkeinstellungen > eth0 > Bridging aktivieren*** = Nein (dies ermöglicht automatisch macvlan)
- ***Einstellungen > Docker > Hostzugriff auf benutzerdefinierte Netzwerke*** = Aktiviert

Hinweis: Wenn Sie zuvor die [2-nic Docker-Segmentierungsmethode](https://forums.unraid.net/topic/137048-guide-how-to-solve-macvlan-and-ipvlan-issues-with-containers-on-a-custom-network/) verwendet haben, möchten Sie dies möglicherweise zurücksetzen:

- ***Einstellungen > Docker > benutzerdefinierte Netzwerkschnittstelle eth0 oder bond0*** (d.h. stellen Sie sicher, dass eth0/bond0 für das benutzerdefinierte Netzwerk konfiguriert ist, nicht eth1/bond1)

Wenn Sie das Array starten, können der Host, die VMs und die Docker-Container alle kommunizieren, und es sollten keine Call Traces mehr auftreten!

### Fehlerbehebung

- Wenn Ihre Docker-Container mit benutzerdefinierten IPs nicht starten, bearbeiten Sie diese und ändern Sie den "Netzwerktyp" zu "Custom: eth0" oder "Custom: bond0". Wir haben versucht, dies automatisch zu tun, aber je nachdem, wie Dinge angepasst wurden, müssen Sie es möglicherweise manuell tun.
- Wenn Ihre VMs Netzwerkprobleme haben, bearbeiten Sie diese und setzen Sie die Netzwerkquelle auf "vhost0". Stellen Sie auch sicher, dass eine MAC-Adresse zugewiesen ist.
- Wenn Ihre WireGuard-Tunnel nicht starten, führen Sie für jeden Tunnel eine Dummy-Änderung durch und speichern Sie diese.
- Wenn Sie Probleme beim Port-Forwarding zu Docker-Controllern haben (insbesondere mit einem FritzBox-Router), löschen und erstellen Sie das Port-Forwarding in Ihrem Router neu.

### Um etwas technischer zu werden...

Nach dem Upgrade auf diese Version, wenn das Bridging auf eth0 aktiviert bleibt, funktioniert alles wie bisher. Sie können versuchen, die Call-Traces zu umgehen, indem Sie das benutzerdefinierte Docker-Netzwerk deaktivieren oder ipvlan anstelle von macvlan verwenden oder die 2-Nic-Docker-Segmentierungsmethode mit Containern auf eth1 verwenden.

Mit dieser Version erstellen wir ein neues macvtap-Netzwerk für Docker-Container und VMs, wenn Sie das Bridging auf eth0 deaktivieren. Es hat eth0 als übergeordnete Schnittstelle anstelle von br0, wodurch wir die Call-Traces vermeiden.

Ein Nebeneffekt ist, dass macvtap-Netzwerke als schneller als Bridge-Netzwerke berichtet werden, sodass Sie möglicherweise Geschwindigkeitsverbesserungen beim Kommunikationsvorgang mit Docker-Containern und VMs bemerken.

FYI: Mit deaktiviertem Bridging für die Hauptschnittstelle (eth0) wird der Docker-Benutzernetzwerktyp auf macvlan eingestellt und ausgeblendet,
es sei denn, es gibt andere Schnittstellen auf Ihrem System mit aktiviertem Bridging, in diesem Fall ist die legacy ipvlan-Option verfügbar.
Um die hier besprochene neue Lösung zu verwenden, sollten Sie dies auf macvlan belassen.

## Systemtreiber-Seite

Navigieren Sie zu ***Werkzeuge > Systemtreiber***, um Einsicht in die auf Ihrem System verfügbaren/benutzten Treiber zu erhalten. Von Plugins installierte 3rd-Party-Treiber (wie NVIDIA und Realtek) haben ein Symbol, das auf die Support-Seite für diesen Treiber verlinkt. Sie können jetzt auch die modprobe.d-Konfigurationsdatei für jeden Treiber hinzufügen/modifizieren/löschen, ohne diese Datei auf Ihrem Flash-Laufwerk finden zu müssen.

## Weitere Fehlerkorrekturen und Verbesserungen

- Diese Veröffentlichung behebt Randfälle in Netzwerken, Libvirt, Docker, WireGuard, NTP, NGINX, NFS und RPC. Sie enthält eine Verbesserung des VM-Managers, sodass das VNC-Passwort während eines Updates beibehalten wird.

- Der Herunterfahrprozess wurde so geändert, dass das NUT-Plugin das System ordnungsgemäß herunterfahren kann.

- Die Anzeigedauer von Benachrichtigungen vor dem automatischen Schließen ist jetzt konfigurierbar (siehe ***Einstellungen > Benachrichtigungseinstellungen***).

- Eine kleine Änderung besteht darin, dass Pakete in /boot/extra jetzt mehr wie von Plugins installierte Pakete behandelt werden, und die Installation wird in syslog anstelle der Konsole protokolliert.

- Der Update-OS-Prozess aktualisiert bei Bedarf automatisch das Plugin-Update-Helfer-Skript.

## Änderungen gegenüber [6.12.3](6.12.3.md)

### Grunddistro

- create\_network\_ini:
  - dhcp-Hook behoben
  - verbesserte IP-Adressen-Erfassung
- Diagnose:
  - Vorherige Unraid-Version zur Diagnosedatei hinzufügen.
  - ntp.conf, sshd.config und servers.conf (mit anonymisierten URLs) hinzufügen
  - IP-Adressen anonymisieren
- Docker:
  - Routing hinzufügen, wenn shim- oder macvtap-Netzwerk verwendet wird
  - Routing beheben, wenn "Hostzugriff" aktiviert ist
  - IPv6 von Shim/Vhost-Schnittstelle entfernen (einige Router sind inkompatibel)
- Libvirt, Nginx, NFS, RPC: laufende Prozessdetektion geändert
- NFS-Client: Verhandlung mit v4 starten, Änderung der Zugriffzeiten deaktivieren
- rc.6: /usr und /lib während des Herunterfahrens weiterhin eingehängt lassen
- rc.docker:
  - gleiches IPv6-Netzwerk für Container und Services erstellen
  - mehr Protokollierung beim Stoppen von dockerd hinzufügen
- rc.inet1:
  - Promiscuous-Modus für Bridging nicht verwenden
  - Persistente Option zu dhcpcd hinzufügen
- rc.library: Schnittstellen immer in derselben Reihenfolge auflisten, IPv6-Anzeige beheben
- rc.libvirt: 'itco'-Watchdog aus XML entfernen, falls vorhanden
- rc.local: Auto-generierte Datei /etc/modprobe.d/zfs.conf kommentieren
- rc.services:
  - Logging hinzufügen
  - WireGuard "VPN-Tunnelzugriff für Docker"-Tunnel von Services ausschließen
  - WireGuard-Tunnel für NTP ausschließen (Code-Optimierung)

#### Paketaktualisierungen

- btrfs-progs: 6.3.3
- curl: Version 8.2.0 (CVE-2023-32001)
- Firefox: Version 117.0.r20230824132758 (AppImage)
- kernel-firmware: version 20230724\_59fbffa
- krb5: Version 1.19.2 (CVE-2023-36054)
- openssh: Version 9.3p2 (CVE-2023-38408)
- openssl: Version 1.1.1v (CVE-2023-3817 CVE-2023-3446)
- samba: Version 4.17.10 (CVE-2023-3496 CVE-2022-2127 CVE-2023-34968 CVE-2023-3496 CVE-2023-3347)

### Linux-Kernel

- Version 6.1.49 (CVE-2023-20593)
- CONFIG\_SCSI\_MPI3MR: Broadcom MPI3 Storage Controller Device Driver

### WebGUI

- Dashboard: ZFS-Leiste ausblenden, wenn kein ZFS verwendet wird
- Docker-Einstellungen: Subnetzgrößen beheben
- Rückmeldung: Rückmeldungsskript umstrukturieren
- Netzwerkeinstellungen: DNS-Einstellungen korrigieren, die manchmal verschwinden
- Benachrichtigungen: Neue Benachrichtigungsoption: automatisierte Schließzeit, Standard sind 5 Sekunden
- Pools: Mindestfreier Speicherplatz: nur aktiv, wenn das Array gestoppt ist
- Freigaben und Pools: Zeige "Mindestfreier Speicherplatz" als absolute Zahl anstelle eines Prozentsatzes
- Systemtreiber: neue Seite
- Übersetzungen: Schlüssel und Wert in Sprachdateien trimmen
- VM-Manager: VNC-Passwort während des Updates beibehalten.
- VM-Manager: Heruntergeladene '.vv'-Dateien entfernen.
- CSS: overflow-x auf 'auto' setzen
- update monitor\_nchan

## Patches

Mit dem [Unraid-Patch-Plugin](https://forums.unraid.net/topic/185560-unraid-patch-plugin/) installiert, besuchen Sie ***Tools → Unraid Patch***, um folgende Patches/Hotfixes zu erhalten:

- Ein Teil der Sicherheitsaktualisierungen, siehe [diesen Blogbeitrag](https://unraid.net/blog/cvd) für Details. Wir empfehlen, auf die neueste stabile Version zu aktualisieren, um zusätzliche Sicherheitsaktualisierungen zu erhalten.
