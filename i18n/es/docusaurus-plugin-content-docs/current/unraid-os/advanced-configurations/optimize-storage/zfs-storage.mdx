---
sidebar_position: 1
sidebar_label: Almacenamiento ZFS
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Almacenamiento ZFS

:::important[Special gracias]

Nos gustaría expresar nuestro agradecimiento a Ed Rawlings ([Spaceinvader One](https://www.youtube.com/c/SpaceinvaderOne)) por la experiencia y la guía de la que esta documentación de almacenamiento de %%ZFS|zfs%% ha sido adaptada. Sus tutoriales y perspectivas han asistido a innumerables usuarios de Unraid en dominar técnicas avanzadas de almacenamiento. Apreciamos sus continuas contribuciones a la comunidad de Unraid.

:::

%%ZFS|zfs%% trae integridad de datos avanzada, configuraciones de almacenamiento flexibles y alto rendimiento a su sistema Unraid. Esta guía explica los conceptos básicos de %%ZFS|zfs%% y lo guía a través de la administración de pools de %%ZFS|zfs%% directamente desde el %%WebGUI|web-gui%% de Unraid. Ya sea configurando nuevo almacenamiento %%ZFS|zfs%% o integrando un pool existente, encontrará los pasos y el contexto que necesita para comenzar con confianza.

---

## ¿Por qué ZFS?

%%ZFS|zfs%% es un sistema de archivos moderno y un administrador de volúmenes diseñado para proteger sus datos, prevenir la corrupción y simplificar la gestión de almacenamiento.

Con %%ZFS|zfs%%, obtienes:

- Verificaciones automáticas de integridad de datos y autoreparación
- Soporte integrado para %%RAID|raid%% (espejos, RAIDZ)
- %%Snapshots|snapshot%% y clones para copias de seguridad y restablecimientos fáciles
- %%ZFS|zfs%% envía/recibe para una replicación eficiente
- Compresión en tiempo real

Unraid supports %%ZFS|zfs%% for any storage pool. You can create a new %%ZFS|zfs%% pool, import one from another system, or use Unraid’s unique hybrid %%ZFS|zfs%% setup: add a %%ZFS|zfs%%-formatted disk directly to the Unraid %%array|array%% (not a pool) and combine %%ZFS|zfs%% features with Unraid’s %%parity|parity%% protection.

:::info\[Example]

Puede usar %%snapshots|snapshot%% de %%ZFS|zfs%% y replicación en un solo disco como un objetivo de copia de seguridad, o replicar un pool rápido %%ZFS|zfs%% SSD a un disco %%ZFS|zfs%% en la %%array|array%% protegido por la %%parity|parity%% de Unraid, obteniendo lo mejor de ambos mundos.

:::

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs1.png)
</div>

:::note

The hybrid %%ZFS|zfs%%-in-array approach is helpful for specific backup or replication scenarios but is not a replacement for a full %%ZFS|zfs%% pool. %%ZFS|zfs%% disks in the %%array|array%% are managed individually; you do not get the combined performance, redundancy, or self-healing of a true multi-disk %%ZFS|zfs%% pool. For full %%ZFS|zfs%% functionality, always use dedicated %%ZFS|zfs%% pools.

:::

### Pools, vdevs y redundancia

Un pool de %%ZFS|zfs%% (denominado "zpool") está compuesto por uno o más vdevs (dispositivos virtuales). Cada vdev es un grupo de discos físicos con su propio nivel de redundancia. %%ZFS|zfs%% escribe datos a través de los vdevs, pero cada vdev es responsable de su tolerancia a fallos.

:::caution

La redundancia siempre es por vdev. Si falla algún vdev, todo el pool falla, incluso si otros vdevs están en buen estado. ¡Planee sus vdevs con cuidado!

:::

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs2.png)
</div>

---

## Creación de un grupo ZFS

Para crear un grupo %%ZFS|zfs%% usando el %%WebGUI|web-gui%%:

1. Detenga el %%array|array%%.
2. Haga clic en **Agregar Grupo**.

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs3.png)
</div>

3. Elija un nombre para su grupo (por ejemplo, `raptor`).
4. Configure el número de ranuras para coincidir con el número de discos que desea en sus vdev(s) de datos primarios.

:::note

Este conteo inicial de ranuras es solo para vdevs de datos. Los vdevs de soporte (como unidades de registro o caché) se pueden agregar por separado después de crear el pool.

:::

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs4.png)
</div>

5. Asigne discos al grupo (el orden de los discos no importa).

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs5.png)
</div>

6. Haga clic en el nombre del grupo (por ejemplo, `raptor`) para abrir su pantalla de configuración.
7. Establezca el tipo de sistema de archivos a `zfs` o `zfs-encrypted` (para cifrado LUKS).

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs6.png)
</div>

8. Elija su perfil de asignación: esto determina la redundancia y el rendimiento de su grupo.

:::tip

Antes de finalizar, revise las secciones sobre perfiles de asignación y topología para tomar una decisión informada.

:::

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs7.png)
</div>

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs8.png)
</div>

9. Habilite la compresión si lo desea (recomendado para la mayoría de las cargas de trabajo).
10. Haga clic en **Hecho**, luego inicie el %%array|array%%.

---

## Agregar un disco ZFS al array (Configuración híbrida)

Puede agregar un disco %%ZFS|zfs%% independiente a su %%array|array%% de Unraid (no un grupo %%ZFS|zfs%%) para combinar características de %%ZFS|zfs%% con la protección de %%paridad|parity%% de Unraid.

:::info[What esto permite]

- **Protección de paridad:** El disco %%ZFS|zfs%% está protegido por la %%parity|parity%% de la %%array|array%% de Unraid, asegurando que sus datos estén seguros contra fallos de disco simples (o múltiples, dependiendo de sus %%parity drives|parity-drives%%).

- **Integridad de datos:** %%ZFS|zfs%% proporciona verificaciones de integridad a nivel de bloque (checksums). Si bien un solo disco no puede autocurarse de bit rot, %%ZFS|zfs%% detectará corrupción y le alertará, permitiéndole restaurar desde una copia de seguridad antes de que ocurra la pérdida de datos silenciosa.

- **Características de %%ZFS|zfs%%:** Puede utilizar %%snapshots|snapshot%% y replicación de %%ZFS|zfs%% en este disco, lo que lo hace ideal para objetivos de respaldo, conjuntos de datos específicos o escenarios donde desea características de %%ZFS|zfs%% junto con el almacenamiento tradicional de Unraid.

:::

Para añadir un disco %%ZFS|zfs%% al %%array|array%%:

1. Vaya a la pestaña **Principal** en el %%WebGUI|web-gui%%.
2. Detenga el %%array|array%%.
3. Haga clic en una ranura vacía bajo **Dispositivos del Array**.
4. Seleccione el disco que desea agregar.

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs9.png)
</div>

5. Bajo **Sistema de archivos**, elija `zfs` o `zfs-encrypted`.

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs10.png)
</div>

6. Haga clic en **Aplicar**.
7. Inicie el %%array|array%% y permita que el disco sea formateado si es necesario.

---

## Elegir un perfil de asignación

Cuando configura un pool de %%ZFS|zfs%%, su perfil de asignación determina cómo se protege su datos, cómo funciona su pool, y cómo puede expandirlo. Aquí hay una comparación simple para ayudarle a decidir qué perfil se adapta a sus necesidades:

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs11.png)
</div>

| Perfil | Redundancia                    | Rendimiento                                                                      | Expansión            | Eficiencia Espacial | Caso de uso típico                                      |
| ------ | ------------------------------ | -------------------------------------------------------------------------------- | -------------------- | ------------------- | ------------------------------------------------------- |
| Raya   | Ninguno                        | Rápido, pero arriesgado                                                          | Agregar más discos   | 100%                | Almacenamiento temporal/de raspado                      |
| Espejo | 1:1 (estilo %%RAID 1\|raid1%%) | Excelente para E/S aleatoria                                                     | Agregar más espejos  | 50%                 | Alto rendimiento, fácil expansión                       |
| RAIDZ1 | 1 disco por vdev               | Rápido para archivos grandes. No es ideal para escrituras pequeñas o aleatorias. | Agregar nuevos vdevs | Alta                | Uso general, tolerancia a fallas de 1 disco             |
| RAIDZ2 | 2 discos por vdev              | Como Z1, pero con escrituras un poco más lentas (paridad adicional)              | Agregar nuevos vdevs | Moderado            | Datos importantes, tolerancia a fallas de 2 discos      |
| RAIDZ3 | 3 discos por vdev              | Como Z2, con más sobrecarga de escritura (para máxima seguridad)                 | Agregar nuevos vdevs | Inferior            | Crítico para la misión, tolerancia a fallas de 3 discos |

:::important[How elegir]

- Use **Espejo** si quiere el mejor rendimiento y expansión fácil y flexible, y está de acuerdo en utilizar más espacio en disco para la redundancia.
- Elija **RAIDZ1/2/3** si desea maximizar el espacio utilizable y almacenar archivos grandes, pero tenga en cuenta que la expansión es menos flexible y el rendimiento de escrita aleatoria es inferior.
- **Raya** solo es adecuada para datos no críticos y temporales; si falla un disco, se pierde todo.

:::

---

## Topología y expansión

Cómo agrupar discos en vdevs afecta tanto la seguridad de los datos como la velocidad.

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs12.png)
</div>

- Si coloca todos sus discos en un gran vdev RAIDZ2, puede perder dos discos sin perder datos. Sin embargo, la expansión significa agregar otro vdev completo.
- Obtendrá mejor rendimiento en paralelo si divide discos en varios vdevs RAIDZ1 más pequeños. Tenga cuidado; si dos discos fallan en el mismo vdev, perderá todo el pool.
- %%ZFS|zfs%% stripes data across vdevs, not individual disks, so more vdevs can lead to better performance for workloads with many small files or random I/O.
- Expandir un grupo %%ZFS|zfs%% generalmente significa agregar un nuevo vdev con la misma disposición, no solo un disco.

:::tip

Planifique la disposición de su pool para que se adapte a sus necesidades y crecimiento futuro. A diferencia del %%array|array%% de Unraid, no puede agregar un solo disco a un vdev existente usando el %%WebGUI|web-gui%%.

:::

---

## Compresión y RAM

%%ZFS|zfs%% ofrece características avanzadas que pueden mejorar significativamente la eficiencia y rendimiento del almacenamiento de Unraid. Dos temas comunes de interés son la compresión y los requisitos de memoria.

La compresión %%ZFS|zfs%% es transparente: opera en segundo plano, reduciendo los datos antes de que lleguen al disco.

Esto ofrece dos beneficios importantes:

- **Uso reducido del disco:** Se consume menos espacio de almacenamiento.
- **Mejor rendimiento:** Escribir y leer menos datos puede llevar a operaciones más rápidas, especialmente en CPUs modernas.

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs13.png)
</div>

:::tip

Active la compresión %%ZFS|zfs%% para la mayoría de los pools %%ZFS|zfs%% de Unraid. Es segura, eficiente y rara vez afecta la compatibilidad o estabilidad.

:::

<details>
  <summary><strong>El mito de la RAM de ZFS</strong> - Haga clic para expandir/contraer</summary>

  Es posible que te hayas encontrado con el consejo desactualizado: “%%ZFS|zfs%% requiere 1 GB de RAM por 1 TB de almacenamiento." Esto ya no es aplicable para la mayoría de los usuarios. %%ZFS|zfs%% utiliza RAM para su Caché de Reemplazo Adaptativa (ARC), lo que acelera las lecturas accedidas con frecuencia.

  Unraid limita automáticamente %%ZFS|zfs%% a usar una porción razonable de la RAM de tu sistema (generalmente 1/8 del total de RAM). Esto permite que %%ZFS|zfs%% funcione bien sin afectar a los contenedores Docker, %%VMs|vm%% o el sistema operativo Unraid.

  <div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
    ![](/img/zfs14.png)
  </div>
</details>

:::info

%%ZFS|zfs%% se escala bien con la memoria disponible. Más RAM puede mejorar el rendimiento de la caché, pero %%ZFS|zfs%% funciona de manera fiable con hardware modesto. No deje que las recomendaciones antiguas le impidan usar %%ZFS|zfs%% en Unraid.

:::

---

## Importando grupos ZFS creados en otros sistemas

Unraid puede importar grupos %%ZFS|zfs%% creados en otras plataformas sin grandes complicaciones.

<details>
  <summary><strong>Cómo importar un grupo ZFS</strong> - Haga clic para expandir/contraer</summary>

  1. **Detenga el array:** Asegúrese de que su %%array|array%% de Unraid esté detenido.
  2. **Añadir una nueva piscina:** Haz clic en **Añadir Piscina**.
  3. **Asigne todas las unidades:**
     - Configure **Número de ranuras de datos** al número total de unidades en su grupo %%ZFS|zfs%% (incluidos los vdevs de datos y los vdevs de soporte).
     - Asigna cada disco a la ranura correcta.
     - *Ejemplo:* Para un pool con un vdev espejado de 4 unidades y un vdev L2ARC de 2 unidades, configure 6 ranuras y asigne las seis unidades.
  4. **Configure el sistema de archivos a "Auto":** Haga clic en el nombre del grupo (por ejemplo, `raptor`) y configure **Sistema de Archivos** en **Auto**.
  5. **Finalice e inicie el array:** Haga clic en **Hecho**, luego inicie el %%array|array%%.

  :::info[Detección automática]
  Unraid detectará e importará automáticamente el pool de %%ZFS|zfs%%. Vdevs de soporte (como log, cache/L2ARC, special/dedup) se listan bajo **Subpools** en el %%WebGUI|web-gui%%. No hay necesidad de añadir subpools por separado después de iniciar la importación. Unraid los importará automáticamente junto con los discos de datos principales cuando se asignen todas las unidades requeridas.
  :::

  Después de importar, se recomienda encarecidamente ejecutar un %%scrub|scrub%% para verificar la integridad de los datos.

  - Haz clic en el nombre del pool (por ejemplo, `raptor`) para abrir su configuración.
  - En **Estado del Pool**, verifica el estado y haz clic en **Scrub**.

  <div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
    ![](/img/zfs15.png)
  </div>
</details>

---

## Vdevs de soporte (subpools)

Unraid se refiere a los vdevs de soporte de %%ZFS|zfs%% como subpools. La mayoría de los usuarios no necesitan estos, pero es posible que los usuarios avanzados se encuentren con ellos:

<div style={{ margen: 'auto', maxAnchura: '600px', display: 'flex', flexDirection: 'columna', alignItems: 'centro' }}>
  ![](/img/zfs16.png)
</div>

| Vdev de soporte (subpool) | Propósito                                             | Riesgos/Notas                                                                                                                         |
| ------------------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- |
| Vdev especial             | Almacena metadatos y archivos pequeños                | El pool se vuelve ilegible si se pierde.                                                                                              |
| Vdev de deduplicación     | Permite la deduplicación                              | Requiere grandes cantidades de RAM; es arriesgado para la mayoría de los usuarios. Evitar a menos que se tengan necesidades técnicas. |
| Vdev de log (SLOG)        | Mejora el rendimiento de escritura síncrona           | Opcional. Solo es beneficioso para ciertos flujos de trabajo.                                                                         |
| Vdev de cache (L2ARC)     | Proporciona cache de lectura basado en SSD            | Opcional. Puede mejorar las velocidades de lectura para grandes conjuntos de trabajo.                                                 |
| Vdev de repuesto          | No soportado en Unraid (a partir de la versión 7.1.2) |                                                                                                                                       |

:::caution

La mayoría de los usuarios de Unraid deberían evitar los vdevs/subpools de soporte a menos que tenga una necesidad específica y bien entendida. Están diseñados para cargas de trabajo especializadas y pueden introducir complejidad o riesgo si se utilizan incorrectamente.

:::

---

## Unidades de soporte críticas de vdev no asignadas durante la importación

Cuando importe un pool de %%ZFS|zfs%% en Unraid, debe asignar cada unidad de su pool original, incluidas las utilizadas para los vdevs de soporte, a los slots del pool. Unraid reconocerá automáticamente el rol de cada unidad (datos, registro, caché, especial o dedup) una vez que comience el %%array|array%%. No es necesario especificar manualmente qué unidad sirve para qué propósito.

Si olvidas incluir una unidad que formaba parte de un vdev de soporte durante la importación, el resultado dependerá de la función del vdev:

| Tipo de vdev                     | Si falta una unidad durante la importación                               | Resultado                                                                                                                             |
| -------------------------------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------- |
| Vdev especial o de deduplicación | El pool no se importará o será inutilizable                              | These vdevs store critical metadata or deduplication tables. Without them, %%ZFS\|zfs%% cannot safely mount the pool.                 |
| Vdev de log (SLOG)               | El pool se importa, pero el rendimiento de escritura síncrona disminuye. | El pool sigue siendo accesible, pero puedes notar un menor rendimiento en los flujos de trabajo que dependen de escrituras síncronas. |
| Vdev de cache (L2ARC)            | El pool se importa, pero se pierde el cache de lectura                   | El pool funciona normalmente, pero pierdes el aumento de rendimiento de la cache L2ARC. No se pierde ningún dato.                     |

:::tip

Always assign every physical drive from your original %%ZFS|zfs%% pool, including all support vdevs, when importing into Unraid. This ensures smooth detection and integration. For new pools created in Unraid, support vdevs are optional and generally not needed for most users.

:::

---

## Expansión de almacenamiento

%%ZFS|zfs%% es poderoso, pero es importante entender cómo funciona su expansión de almacenamiento - especialmente si estás planificando un crecimiento futuro.

Históricamente, los vdevs %%ZFS|zfs%% tienen un ancho fijo. No puede agregar un disco a un vdev RAIDZ existente para hacerlo más grande.

Formas de expandir tu pool incluyen:

- **Añadiendo un nuevo vdev:** Crezca su pool agregando otro vdev (como un nuevo espejo o grupo RAIDZ). Esto aumenta la capacidad, pero debe agregar discos en conjuntos que coincidan con la configuración del vdev.
- **Reemplazo de unidades con unidades más grandes:** Reemplace cada unidad en un vdev, una a la vez, por un disco más grande. Consulte [reemplazo de discos](../../using-unraid-to/manage-storage/array-configuration.mdx#replacing-faileddisabled-disks) para procedimientos detallados. Después de que todas las unidades sean reemplazadas y el pool se resuelva, la capacidad del vdev aumenta.
- **Crear un nuevo pool:** Iniciar un nuevo pool de %%ZFS|zfs%% mantiene las cosas organizadas e independientes para diferentes tipos de datos o cargas de trabajo.

:::tip[Planning adelante]

Antes de construir su pool, considere cuánta almacenamiento necesitará, no solo hoy, sino en el futuro. %%ZFS|zfs%% recompensa la buena planificación, especialmente si desea evitar actualizaciones disruptivas más adelante.

:::

---

## Usar pools ZFS en un servidor Unraid existente

Si estás ejecutando un %%array|array%% tradicional de Unraid y quieres añadir pools de %%ZFS|zfs%%, aquí hay algunas formas efectivas de integrarlos:

| Caso de uso                                | Descripción                                                                                                                                                                                                           | Detalles / Ejemplos                                                                                                            |
| ------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| Pool SSD/NVMe rápido para appdata y Docker | Almacena el recurso compartido appdata para contenedores y bases de datos rápidas y receptivas. Esto soporta %%snapshot\|snapshot%%s para fáciles reversiones y también puede alojar %%VM\|vm%%s para alta E/S.       | Muchos usuarios eligen un espejo de %%ZFS\|zfs%% de 2 unidades para esto. Es fácil de expandir y ofrece un rendimiento sólido. |
| Pool ZFS para datos importantes            | Use un espejo %%ZFS\|zfs%% o un pool RAIDZ2 para archivos insustituibles como fotos, registros de impuestos y datos de %%user share\|user-share%%. %%ZFS\|zfs%% verifica la corrupción y se autocura con redundancia. | Esta configuración protege datos críticos con comprobaciones de integridad automáticas y capacidades de auto-saneamiento.      |
| Objetivo de respaldo o replicación diaria  | Usa un disco %%ZFS\|zfs%% (incluso dentro del %%array\|array%% de Unraid) como un objetivo de replicación. Puedes replicar otros pools localmente o desde otro servidor Unraid.                                       | Utiliza `zfs send/receive` o herramientas como Syncoid para respaldos y restauraciones rápidas y confiables.                   |
| %%Snapshot\|snapshot%%-based recovery pool | Mantén %%snapshot\|snapshot%%s puntuales de datos o contenedores críticos. Los %%snapshot\|snapshot%%s pueden ser programados automáticamente y son eficientes en espacio.                                            | Esta función permite una rápida recuperación de eliminaciones accidentales o errores de configuración.                         |

## Evitar errores comunes de ZFS

%%ZFS|zfs%% es un poderoso sistema de archivos, pero hay varios errores comunes que pueden socavar sus beneficios. Es importante tener en cuenta los siguientes puntos antes de configurar su pool para una experiencia más fluida:

- **Desajuste de tamaño de discos en RAIDZ:** %%ZFS|zfs%% trata todos los discos en un vdev RAIDZ como del tamaño del más pequeño. Para asegurar la mejor eficiencia, use siempre discos de tamaño idéntico dentro de cada vdev.

- **Expansión de vdevs RAIDZ a través del %%WebGUI|web-gui%%:** Mientras que Unraid 7.1.x y versiones más nuevas admiten la expansión de RAIDZ a través de la línea de comandos, esta función aún no está disponible en el %%WebGUI|web-gui%%. Por el momento, expanda a través del CLI o agregue nuevos vdevs a través del GUI.

- **%%ZFS|zfs%% disk vs. full zpool:** A single %%ZFS|zfs%%-formatted disk in the Unraid %%array|array%% does not offer the redundancy or features of a dedicated %%ZFS|zfs%% pool. To leverage advanced functionality, use standalone pools.

- **Deduplicación sin RAM adecuada:** La deduplicación requiere memoria significativa, y habilitarlo sin suficiente RAM puede impactar gravemente el rendimiento. Solo habilite la deduplicación si comprende completamente los requisitos.

- **La redundancia de vdev es local:** La redundancia en %%ZFS|zfs%% es local para cada vdev y no se comparte a través del pool. Asegúrese de planear el diseño de su vdev para lograr el nivel de resiliencia que necesita.
