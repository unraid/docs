# Versión 6.12.4 2023-08-31

## Notas de actualización

### Problemas conocidos

Por favor, consulte las [notas de la versión 6.12.0](6.12.0.md#known-issues) para conocer los problemas generales.

### Deshacer cambios

Antes de revertir a una versión anterior, es importante asegurarse de que el Puenteo esté habilitado:

- _**Configuración > Configuración de Red > eth0 > Habilitar Puenteo**_ = Sí

Luego, inicie el array (junto con los servicios de Docker y VM) para actualizar sus contenedores Docker, VMs y túneles WireGuard a sus configuraciones anteriores que deberían funcionar en versiones anteriores.

Una vez en la versión anterior, confirme que estas configuraciones sean correctas para su configuración:

- _**Configuración > Docker > Acceso del host a redes personalizadas**_
- _**Configuración > Docker > Tipo de red personalizada de Docker**_

Si retrocede antes de la 6.12.0, también consulte las [notas de la versión 6.12.0](6.12.0.md#rolling-back).

## Corrección para rastros de llamadas de macvlan

La gran noticia en esta versión es que hemos resuelto problemas relacionados con los rastros de llamadas de macvlan y comportamientos extraños.

La raíz del problema es que macvlan usado para redes personalizadas de Docker es poco confiable cuando la interfaz principal es un puente (como br0), funciona mejor en una interfaz física (como eth0) o un enlace (como bond0). Creemos que esto es un problema antiguo del kernel y hemos publicado un [informe de error](https://bugzilla.kernel.org/show_bug.cgi?id=217777).

Si está recibiendo trazas de llamada relacionadas con macvlan, como primer paso recomendamos navegar a _**Configuraciones > Docker**_, cambiar a vista avanzada, y cambiar el "Tipo de red personalizada de Docker" de macvlan a ipvlan. Esta es la configuración predeterminada que Unraid ha enviado desde la versión 6.11.5 y debería funcionar para la mayoría de los sistemas. Si está satisfecho con esta configuración, ¡ya ha terminado! No tendrá más trazas de llamada relacionadas con macvlan y puede continuar a [la siguiente sección](#system-drivers-page).

Sin embargo, algunos usuarios han informado problemas con el reenvío de puertos desde ciertos enrutadores (Fritzbox) y funcionalidad reducida con herramientas de gestión avanzada de red (Ubiquity) cuando están en modo ipvlan.

Para esos usuarios, tenemos un nuevo método que rehace la red para evitar problemas con macvlan. Ajuste algunas configuraciones y sus contenedores de Docker, máquinas virtuales y túneles de WireGuard deberían ajustarse automáticamente para usarlos:

- _**Configuración > Configuración de Red > eth0 > Habilitar Enlace**_ = Sí o No, cualquiera funciona con esta solución
- _**Configuración > Configuración de Red > eth0 > Habilitar Puenteo**_ = No (esto habilitará automáticamente macvlan)
- _**Configuración > Docker > Acceso del host a redes personalizadas**_ = Habilitado

Nota: si anteriormente usó el [método de segmentación de Docker de 2 NIC](https://forums.unraid.net/topic/137048-guide-how-to-solve-macvlan-and-ipvlan-issues-with-containers-on-a-custom-network/), también querrá revertir eso:

- _**Configuración > Docker > red personalizada en la interfaz eth0 o bond0**_ (es decir, asegúrese de que eth0/bond0 esté configurado para la red personalizada, no eth1/bond1)

Cuando inicia el array, el host, los VMs y los contenedores Docker podrán comunicarse, ¡y no deberían haber más rastros de llamada!

### Solución de problemas

- Si sus contenedores Docker con IPs personalizadas no se están iniciando, edítelos y cambie el "Tipo de red" a "Personalizado: eth0" o "Personalizado: bond0". Intentamos hacerlo automáticamente, pero dependiendo de cómo se personalizaron, es posible que deba hacerlo manualmente.
- Si sus máquinas virtuales están teniendo problemas de red, edítelas y establezca la fuente de red en "vhost0". También asegúrese de que haya una dirección MAC asignada.
- Si sus túneles WireGuard no se inician, realice un cambio ficticio en cada túnel y guarde.
- Si tiene problemas de reenvío de puertos hacia contenedores Docker (particularmente con un router Fritzbox), elimine y recree el reenvío de puertos en su router.

### Para ser un poco más técnico...

Después de actualizar a esta versión, si el puente sigue habilitado en eth0, entonces todo funciona como antes. Puede intentar evadir las trazas de llamada deshabilitando la red personalizada de Docker, o usando ipvlan en lugar de macvlan, o usando el método de segmentación Docker de 2 NICs con contenedores en eth1.

Comenzando con esta versión, cuando desactiva el puente en eth0 creamos una nueva red macvtap para que la usen los contenedores de Docker y las máquinas virtuales. Tiene como principal a eth0 en lugar de br0, lo cual nos ayuda a evitar las trazas de llamada.

Un beneficio colateral es que se informa que las redes macvtap son más rápidas que las redes en puente, por lo que podría ver mejoras en la velocidad al comunicarse con los contenedores Docker y VMs.

Para su información: Con el puente deshabilitado para la interfaz principal (eth0), entonces el tipo de red personalizada de Docker se establecerá en macvlan y se ocultará a menos que haya otras interfaces en su sistema que tengan el puente habilitado, en cuyo caso la opción ipvlan heredada está disponible. Para usar la nueva corrección discutida aquí, querrá mantenerlo configurado en macvlan.

## Página de controladores del sistema

Navegue a _**Herramientas > Controladores del sistema**_ para ver los controladores disponibles/en uso en su sistema. Los controladores de terceros instalados por plugins (como NVIDIA y Realtek) tienen un icono que enlaza a la página de soporte para ese controlador. Ahora también puede agregar/modificar/eliminar el archivo de configuración modeprobe.d para cualquier controlador sin tener que buscar ese archivo en su unidad flash.

## Otras correcciones de errores y mejoras

- Esta versión resuelve casos especiales en redes, Libvirt, Docker, WireGuard, NTP, NGINX, NFS y RPC. E incluye una mejora en el Gestor de VM para que retenga la contraseña VNC durante una actualización.

- El proceso de apagado fue modificado para permitir que el complemento NUT apague correctamente el sistema.

- El tiempo de exhibición de la notificación antes de cerrarse automáticamente es ahora configurable (vea _**Configuración > Configuración de notificaciones**_).

- Un pequeño cambio es que los paquetes en /boot/extra ahora se tratan más como paquetes instalados por plugins, y la instalación se registra en syslog en lugar de en la consola.

- El proceso de actualización del SO actualizará automáticamente el script Plugin-Update-Helper si es necesario.

## Cambios vs. [6.12.3](6.12.3.md)

### Distro base

- create\_network\_ini:
  - corrigió el gancho dhcp
  - mejoró la recolección de direcciones IP
- diagnósticos:
  - Agregue la versión anterior de Unraid al archivo txt de la versión de diagnósticos.
  - Agregue ntp.conf, sshd.config y servers.conf (con URLs anonimizadas)
  - anonimizar direcciones IP
- docker:
  - agregue enrutamiento cuando se use una red shim o macvtap
  - corrija el enrutamiento cuando "acceso del anfitrión" esté habilitado
  - elimine IPv6 de la interfaz shim/vhost (algunos enrutadores no son compatibles)
- libvirt, nginx, nfs, rpc: cambió la detección de procesos en ejecución
- nfsclient: iniciar negociación con v4, desactivar modificación de atime
- rc.6: deje montados /usr y /lib durante el apagado
- rc.docker:
  - cree la misma red IPv6 para contenedores y servicios
  - agregue más registros al detener dockerd
- rc.inet1:
  - no use el modo promiscuo para el puenteo
  - agregue opción persistente a dhcpcd
- rc.library: las interfaces siempre listadas en el mismo orden, arregle mostrar ipv6
- rc.libvirt: elimine el "itco" watchdog del XML si está presente
- rc.local: anote el archivo /etc/modprobe.d/zfs.conf autogenerado
- rc.services:
  - agregue registro
  - excluyendo túneles WireGuard "acceso VPN para docker" de los servicios
  - excluir túneles WireGuard para ntp (optimización de código)

#### Actualizaciones de paquetes

- btrfs-progs: 6.3.3
- curl: versión 8.2.0 (CVE-2023-32001)
- firefox: versión 117.0.r20230824132758 (AppImage)
- kernel-firmware: versión 20230724\_59fbffa
- krb5: versión 1.19.2 (CVE-2023-36054)
- openssh: versión 9.3p2 (CVE-2023-38408)
- openssl: versión 1.1.1v (CVE-2023-3817 CVE-2023-3446)
- samba: versión 4.17.10 (CVE-2023-3496 CVE-2022-2127 CVE-2023-34968 CVE-2023-3496 CVE-2023-3347)

### Núcleo de Linux

- versión 6.1.49 (CVE-2023-20593)
- CONFIG\_SCSI\_MPI3MR: Controlador de dispositivo de almacenamiento Broadcom MPI3

### WebGUI

- Panel: ocultar barra ZFS cuando no se usa ZFS
- Configuración de Docker: corregir tamaños de subred
- Comentarios: rehacer script de comentarios
- Configuración de Red: corrección DNS a veces desaparecen
- Notificaciones: nueva opción de notificación: tiempo de cierre automático, por defecto es 5 segundos
- Pools: espacio libre mínimo: solo habilitado cuando el array está detenido
- Shares y Pools: mostrar "Espacio libre mínimo" como número absoluto en lugar de porcentaje
- Controladores del sistema: página nueva
- Traducciones: recortar clave y valor en archivos de idioma
- Administrador de VMs: Mantener la contraseña VNC durante la actualización.
- Administrador de VMs: Eliminar archivos previamente descargados '.vv'.
- CSS: establecer overflow-x en 'auto'
- actualizar monitor\_nchan

## Parches

Con el [plugin de Parches para Unraid](https://forums.unraid.net/topic/185560-unraid-patch-plugin/) instalado, visite _**Herramientas → Parche de Unraid**_ para obtener los siguientes parches / hot fixes:

- Un subconjunto de actualizaciones de seguridad, vea [esta publicación de blog](https://unraid.net/blog/cvd) para más detalles. Recomendamos actualizar a la última versión estable para obtener actualizaciones de seguridad adicionales.
