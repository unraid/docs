---
sidebar_position: 2
sidebar_label: Unclean shutdowns
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import UncleanShutdownsPower from './partials/unclean-shutdowns/unexpected-power-loss.mdx';
import UncleanShutdownsFlash from './partials/unclean-shutdowns/flash-drive-failure.mdx';
import UncleanShutdownsTerminal from './partials/unclean-shutdowns/open-terminal-sessions.mdx';

# Unclean shutdowns

An unclean shutdown happens when Unraid detects that the %%array|array%% was not properly stopped before the system powered off. This situation can trigger an automatic %%parity check|parity-check%% during the next boot to ensure data integrity.

:::important[Recommendations to prevent unclean shutdowns]

- **Use a UPS:** Keep your server connected to an Uninterruptible Power Supply (UPS) and set it up to initiate a controlled shutdown when battery power runs low.
- **Attempt a graceful shutdown:** If your server is unresponsive, briefly press the power button to trigger a safe shutdown. Do not hold the button down, as this will force a hard power off and lead to an unclean shutdown.
- **Enable persistent logging:** Go to ***Settings → Syslog Server*** to activate logging that persists after a reboot. See [Persistent logs (Syslog server)](../diagnostics/capture-diagnostics-and-logs.mdx#persistent-logs-syslog-server) for more details.
- **Adjuntar diagnósticos para obtener soporte:** Si ocurre un apagado no limpio, Unraid intentará guardar diagnósticos en `/log/diagnostics.zip` en su dispositivo flash. Adjunte este archivo a las publicaciones del foro cuando busque ayuda.
  :::

:::tip[UPS configuration best practices]

- **Connect the UPS via USB** to your Unraid server.
- **Enable UPS support** in ***Settings → UPS Settings***.
- **Configure shutdown timeouts:** Set the UPS to trigger a controlled shutdown before the battery runs low. Adjust the "Battery runtime left" or "Battery charge level" thresholds to provide enough time for Unraid to [stop the %%array|array%%](../../using-unraid-to/manage-storage/array-configuration.mdx#startstop-the-array) and power down safely.
- **Test your configuration:** Simulate a power loss to ensure the UPS and Unraid respond correctly.

Examina el [plugin NUT](https://unraid.net/community/apps/c/plugins/p4?srsltid=AfmBOop675PrJQW4iqb4JBN3GyPpwDDiSmnZReq78t27XyxkFdMX8inO#:~:text=NUT%20%2D%20Network%20UPS%20Tools) para una mayor compatibilidad con modelos más avanzados de SAI o hardware no compatible.
:::

## Events That Cause Unclean Shutdowns

Understanding the main triggers for unclean shutdowns helps you prevent them. Explore the tabs below for details on each scenario.

<Tabs>
  <TabItem value="energía" label="Pérdida de energía inesperada" default>
    <UncleanShutdownsPower />
  </TabItem>

  <TabItem value="flash" label="Fallo de unidad flash">
    <UncleanShutdownsFlash />
  </TabItem>

  <TabItem value="terminal" label="Abrir sesiones de terminal">
    <UncleanShutdownsTerminal />
  </TabItem>
</Tabs>

---

## Configuring shutdown timeouts

Properly configuring shutdown timeouts is essential to ensure your Unraid server can stop all services effectively, preventing unclean shutdowns, particularly during power loss or maintenance. Each component of your system - %%VM|vm%%s, Docker containers, and the overall %%array|array%% - has its own timeout setting that can be adjusted.

### Recommended timeout settings

| Configuración                               | Default | Recomendación mínima                             | Dónde configurar                                     |
| ------------------------------------------- | ------- | ------------------------------------------------ | ---------------------------------------------------- |
| Tiempo de espera para apagado de %%VM\|vm%% | 60s     | 300s (5 min)                                     | ***Settings → VM Manager → VM Shutdown (Advanced)*** |
| Docker container stop timeout               | 10s     | 30–60s                                           | ***Configuración → Docker (Avanzado)***              |
| Tiempo de espera general de apagado         | 90s     | 3 × %%VM\|vm%% timeout + Docker timeout + 15–30s | ***Settings → Disk Settings → Shutdown time-out***   |

### Virtual machines timeout

<details>
  <summary><strong>Haga clic para expandir/contraer</strong></summary>

  Unraid primero apaga todas las máquinas virtuales configuradas (%%VMs|vm%%) antes de detener los contenedores de Docker o el %%array|array%% en sí. El Tiempo de Espera de Apagado de VM determina cuánto tiempo espera Unraid para que cada %%VM|vm%% se apague de manera ordenada.

  <h4>Dónde configurarlo</h4>

  - ***Settings → VM Manager → VM Shutdown*** (enable Advanced view)

  <h4>Considerar</h4>

  - Windows %%VMs|vm%% may take longer to shut down, especially if updates are pending or the %%VM|vm%% is in sleep/hibernation.
  - If the timeout is too short, %%VMs|vm%% will be force-stopped, risking data loss or corruption.

  <h4>Mejores prácticas</h4>

  Establezca el tiempo de espera en al menos 300 segundos (5 minutos) para las %%VMs|vm%% de Windows. Programe las actualizaciones para ejecutarse al inicio, no al apagarse, para evitar retrasos.
</details>

### Docker containers timeout

<details>
  <summary><strong>Haga clic para expandir/contraer</strong></summary>

  Después de las %%VMs|vm%%, Unraid detiene todos los contenedores de Docker en ejecución. El Tiempo de Espera de Detención de Contenedor de Docker controla cuánto tiempo espera Unraid para que cada contenedor salga limpiamente.

  <h4>Dónde configurarlo</h4>

  - ***Settings → Docker*** (enable Advanced view)

  <h4>Considerar</h4>

  - Containers are stopped in parallel.
  - Complex containers, or those with large databases, may need more than the default 10 seconds to shut down safely.
  - If the timer expires, containers are force-stopped.

  <h4>Mejores prácticas</h4>
  Aumenta el tiempo de espera a 30–60 segundos si ejecutas contenedores Docker que requieren más tiempo de apagado.
</details>

### General shutdown timer

<details>
  <summary><strong>Haga clic para expandir/contraer</strong></summary>

  El tiempo total de espera de apagado es el tiempo máximo que Unraid permite para todos los procesos de apagado - %%VM|vm%%s, Docker y operaciones de disco - antes de forzar un apagado.

  <h4>Dónde configurarlo</h4>

  - ***Settings → Disk Settings → Shutdown time-out***

  <h4>Cómo calcular</h4>

  Suma tus tiempos de espera para %%VM|vm%% y Docker, luego añade 15–30 segundos para el desmontaje de disco y otros procesos.

  - Example: `3 × ***VM Shutdown timeout*** + ***Docker stop timeout*** + 15–30 seconds`

  <h4>Mejores prácticas</h4>
  Establece este temporizador lo suficientemente alto para cubrir tu escenario de apagado más lento, especialmente si tienes muchas unidades o un gran %%array|array%%.
</details>

### UPS battery life

<details>
  <summary><strong>Haga clic para expandir/contraer</strong></summary>

  Tu SAI debe proporcionar suficiente tiempo de funcionamiento para permitir que todos los temporizadores de apagado expiren antes de que el servidor pierda energía.

  <h4>Dónde configurarlo</h4>

  - ***Settings → UPS Settings*** (see **Runtime left** with all disks spun up)

  <h4>Considerar</h4>

  - The UPS should trigger a shutdown early enough to allow the full shutdown sequence to complete.
  - If the battery runs out before shutdown completes, you risk an unclean shutdown and possible data loss.

  <h4>Mejores prácticas</h4>

  Prueba tu SAI simulando un corte de energía y confirma que Unraid se apague limpiamente con tiempo de sobra.
</details>
