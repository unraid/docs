---
title: Configuraci√≥n del proveedor OIDC
description: Configurar proveedores OIDC (OpenID Connect) para la autenticaci√≥n SSO en la API de Unraid
sidebar_position: 3
---

# Configuraci√≥n del proveedor OIDC

:::info[What ¬øQu√© es OIDC?]
OpenID Connect (OIDC) es un protocolo de autenticaci√≥n que permite a los usuarios iniciar sesi√≥n utilizando sus cuentas existentes de proveedores como Google, Microsoft o su proveedor de identidad corporativo. Habilita el inicio de sesi√≥n √∫nico (SSO) para una autenticaci√≥n sin interrupciones y segura.
:::

Esta gu√≠a le gu√≠a a trav√©s de la configuraci√≥n de proveedores OIDC (OpenID Connect) para la autenticaci√≥n SSO en la API de Unraid utilizando la interfaz web.

## üöÄ Inicio R√°pido

<details open>
  <summary><strong>Navegando a la Configuraci√≥n de OIDC</strong></summary>

  1. Navega a la interfaz web de tu servidor Unraid
  2. Ve a **Configuraci√≥n** ‚Üí **Acceso de Gesti√≥n** ‚Üí **API** ‚Üí **OIDC**
  3. Ver√°s pesta√±as para diferentes proveedores - haz clic en el bot√≥n **+** para a√±adir un nuevo proveedor
</details>

### Descripci√≥n general de la Interfaz de Proveedores OIDC

![P√°gina de inicio de sesi√≥n con opciones SSO](/img/api/sso-with-options.png)
*P√°gina de inicio de sesi√≥n mostrando el formulario de inicio de sesi√≥n tradicional con opciones SSO - botones "Iniciar sesi√≥n con Unraid.net" e "Iniciar sesi√≥n con Google"*

La interfaz incluye:

- **Pesta√±as de Proveedores**: Cada proveedor configurado (Unraid.net, Google, etc.) aparece como una pesta√±a
- **Bot√≥n A√±adir Proveedor**: Haz clic en el bot√≥n **+** para a√±adir nuevos proveedores
- **Desplegable de Modo de Autorizaci√≥n**: Alternar entre modos "simple" y "avanzado"
- **Secci√≥n de Autorizaci√≥n Simple**: Configura dominios de correo permitidos y direcciones espec√≠ficas
- **Botones A√±adir Elemento**: Haz clic para a√±adir m√∫ltiples reglas de autorizaci√≥n

## Entendiendo los Modos de Autorizaci√≥n

La interfaz ofrece dos modos de autorizaci√≥n:

### Modo Simple (Recomendado)

El modo simple es la forma m√°s f√°cil de configurar la autorizaci√≥n. Usted puede:

- Permitir dominios de correo espec√≠ficos (por ejemplo, @empresa.com)
- Permitir direcciones de correo espec√≠ficas
- Configurar qui√©n puede acceder a tu servidor Unraid con una configuraci√≥n m√≠nima

**Cu√°ndo usar el Modo Simple:**

- Deseas permitir a todos los usuarios de tu dominio corporativo
- Tienes una lista peque√±a de usuarios espec√≠ficos
- Eres nuevo en la configuraci√≥n de OIDC

<details>
  <summary><strong>Modo Avanzado</strong></summary>

  El modo avanzado ofrece un control granular utilizando reglas basadas en claims. Usted puede:

  - Crear reglas de autorizaci√≥n complejas basadas en claims de JWT
  - Usar operadores como equals, contains, endsWith, startsWith
  - Combinar m√∫ltiples condiciones con l√≥gica OR/AND
  - Elegir si CUALQUIER regla debe pasar (modo OR) o TODAS las reglas deben pasar (modo AND)

  **Cu√°ndo usar el Modo Avanzado:**

  - Necesitas verificar membres√≠as de grupos
  - Deseas verificar m√∫ltiples claims (por ejemplo, dominio de correo Y estado verificado)
  - Tienes requisitos de autorizaci√≥n complejos
  - Necesitas un control detallado sobre c√≥mo se eval√∫an las reglas
</details>

## Reglas de Autorizaci√≥n

![Configuraci√≥n de Reglas de Autorizaci√≥n](/img/api/advanced-rules.png)
*Reglas avanzadas de autorizaci√≥n mostrando configuraci√≥n de claims de JWT con operador de endsWith para control de acceso basado en dominio*

### Ejemplos de Modo Simple

#### Permitir Dominio Corporativo

En Autorizaci√≥n Simple:

- **Dominios de Correo Permitidos**: Ingresar `empresa.com`
- Esto permite a cualquier persona con correo @empresa.com

#### Permitir Usuarios Espec√≠ficos

- **Direcciones de Correo Espec√≠ficas**: A√±adir correos individuales
- Haz clic en **A√±adir Elemento** para a√±adir m√∫ltiples direcciones

<details>
  <summary><strong>Ejemplos de Modo Avanzado</strong></summary>

  #### Modo de Reglas de Autorizaci√≥n

  Al usar m√∫ltiples reglas, puedes elegir c√≥mo son evaluadas:

  - **Modo OR** (predeterminado): El usuario est√° autorizado si CUALQUIER regla pasa
  - **Modo AND**: El usuario est√° autorizado solo si TODAS las reglas pasan

  #### Correo de Dominio con Verificaci√≥n (Modo AND)

  Para requerir tanto el dominio del correo como la verificaci√≥n:

  1. Configura **Modo de Reglas de Autorizaci√≥n** a `AND`
  2. A√±adir dos reglas:
     - Regla 1:
       - **Claim**: `email`
       - **Operador**: `endsWith`
       - **Valor**: `@empresa.com`
     - Regla 2:
       - **Claim**: `email_verified`
       - **Operador**: `equals`
       - **Valor**: `true`

  Esto asegura que los usuarios deben tener tanto un correo de la empresa COMO una direcci√≥n de correo verificada.

  #### Acceso Basado en Grupos (Modo OR)

  Para permitir el acceso a m√∫ltiples grupos:

  1. Configura **Modo de Reglas de Autorizaci√≥n** a `OR` (predeterminado)
  2. Agrega reglas para cada grupo:
     - **Claim**: `groups`
     - **Operador**: `contains`
     - **Valor**: `admins`
       O a√±ada otra regla:
     - **Claim**: `groups`
     - **Operador**: `contains`
     - **Valor**: `developers`

  Los usuarios en el grupo `admins` O `developers` ser√°n autorizados.

  #### M√∫ltiples Dominios

  - **Claim**: `email`
  - **Operador**: `endsWith`
  - **Valores**: A√±adir m√∫ltiples dominios (por ejemplo, `empresa.com`, `filial.com`)

  #### Autorizaci√≥n Compleja (Modo AND)

  Para seguridad estricta que requiere m√∫ltiples condiciones:

  1. Configura **Modo de Reglas de Autorizaci√≥n** a `AND`
  2. A√±adir m√∫ltiples reglas que TODAS deben pasar:
     - El correo debe ser del dominio de la empresa
     - El correo debe estar verificado
     - El usuario debe estar en un grupo espec√≠fico
     - La cuenta debe tener 2FA habilitado (si el claim est√° disponible)
</details>

<details>
  <summary><strong>Detalles de la Interfaz de Configuraci√≥n</strong></summary>

  ### Pesta√±as de Proveedores

  - Cada proveedor configurado aparece como una pesta√±a en la parte superior
  - Haz clic en una pesta√±a para cambiar entre configuraciones de proveedores
  - El bot√≥n **+** a la derecha a√±ade un nuevo proveedor

  ### Desplegable de Modo de Autorizaci√≥n

  - **simple**: Mejor para la autorizaci√≥n basada en correo (recomendado para la mayor√≠a de los usuarios)
  - **avanzado**: Para reglas complejas basadas en claims utilizando claims de JWT

  ### Campos de Autorizaci√≥n Simple

  Cuando el modo "simple" est√° seleccionado, ver√°s:

  - **Dominios de Correo Permitidos**: Ingresa dominios sin @ (por ejemplo, `empresa.com`)
    - Texto de ayuda: "Usuarios con correos que terminan en estos dominios pueden iniciar sesi√≥n"
  - **Direcciones de Correo Espec√≠ficas**: A√±adir direcciones de correo individuales
    - Texto de ayuda: "Solo estas direcciones de correo exactas pueden iniciar sesi√≥n"
  - Botones **A√±adir Elemento** para a√±adir m√∫ltiples entradas

  ### Campos de Autorizaci√≥n Avanzada

  Cuando el modo "avanzado" est√° seleccionado, ver√°s:

  - **Modo de Reglas de Autorizaci√≥n**: Elige `OR` (cualquier regla pasa) o `AND` (todas las reglas deben pasar)
  - **Reglas de Autorizaci√≥n**: A√±adir m√∫ltiples reglas basadas en claims
  - **Para cada regla**:
    - **Claim**: El claim de JWT a verificar
    - **Operador**: C√≥mo comparar (equals, contains, endsWith, startsWith)
    - **Valor**: Qu√© coincidir

  ### Elementos Adicionales de la Interfaz

  - **Habilitar Sandbox de Desarrollador**: Toggle para habilitar el sandbox de GraphQL en `/graphql`
  - La interfaz utiliza un tema oscuro para mejor visibilidad
  - Los indicadores de validaci√≥n de campos ayudan a garantizar una configuraci√≥n correcta
</details>

### URI de Redirecci√≥n Requerida

:::caution[Important Configuraci√≥n]
Todos los proveedores deben configurarse con este formato exacto de URI de redirecci√≥n:
:::

```bash
http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback
```

:::tip
Reemplaza `TU_IP_UNRAID` con la direcci√≥n IP actual de tu servidor (por ejemplo, `192.168.1.100` o `tower.local`).
:::

### Formato de URL del Emisor

El campo **URL del Emisor** acepta ambos formatos, pero **se recomienda encarecidamente el URL base** por seguridad:

- **URL Base** (recomendado): `https://accounts.google.com`
- **URL completa de descubrimiento**: `https://accounts.google.com/.well-known/openid-configuration`

**‚ö†Ô∏è Nota de Seguridad**: Siempre use el formato de URL base cuando sea posible. El sistema agrega autom√°ticamente `/.well-known/openid-configuration` para el descubrimiento OIDC. Usar la URL completa de descubrimiento directamente desactiva importantes verificaciones de validaci√≥n del emisor y no es recomendable seg√∫n la especificaci√≥n de OpenID Connect.

**Ejemplos de URLs base correctas:**

- Google: `https://accounts.google.com`
- Microsoft/Azure: `https://login.microsoftonline.com/YOUR_TENANT_ID/v2.0`
- Keycloak: `https://keycloak.example.com/realms/YOUR_REALM`
- Authelia: `https://auth.yourdomain.com`

## ‚úÖ Probando Tu Configuraci√≥n

![P√°gina de inicio de sesi√≥n con Botones SSO](/img/api/sso-with-options.png)
*P√°gina de inicio de sesi√≥n de Unraid mostrando tanto la autenticaci√≥n de usuario/contrase√±a tradicional como opciones SSO con botones personalizados de proveedores*

1. Guarda la configuraci√≥n de tu proveedor
2. Cerrar sesi√≥n (si est√°s conectado)
3. Navegar a la p√°gina de inicio de sesi√≥n
4. El bot√≥n de tu proveedor configurado deber√≠a aparecer
5. Haz clic para probar el flujo de inicio de sesi√≥n

## üîß Resoluci√≥n de Problemas

### Problemas Comunes

#### Error de "Proveedor no encontrado"

- Aseg√∫rate de que la URL del Emisor sea correcta
- Verifica que el proveedor soporte el descubrimiento OIDC (/.well-known/openid-configuration)

#### "Autorizaci√≥n fallida"

- En el Modo Simple: Verifica que los dominios de correo est√©n ingresados correctamente (sin @)
- En el Modo Avanzado:
  - Verifica que los nombres de claims coincidan exactamente con lo que tu proveedor env√≠a
  - Comprueba si el Modo de Reglas de Autorizaci√≥n est√° configurado correctamente (OR vs AND)
  - Aseg√∫rate de que todos los claims requeridos est√©n presentes en el token
- Habilita el registro de depuraci√≥n para ver los claims reales y la evaluaci√≥n de reglas

#### "URI de redirecci√≥n inv√°lido"

- Aseg√∫rate de que el URI de redirecci√≥n en tu proveedor coincida exactamente
- Incluye el puerto correcto si est√°s usando una configuraci√≥n no est√°ndar
- Verifica que el protocolo de URI de redirecci√≥n coincida con la configuraci√≥n de tu servidor (HTTP o HTTPS)

#### No se puede ver el bot√≥n de inicio de sesi√≥n

- Verifica que al menos una regla de autorizaci√≥n est√© configurada
- Verifica que el proveedor est√© habilitado/guardado

### Modo de Depuraci√≥n

Para solucionar problemas:

1. Habilitar registro de depuraci√≥n:

```bash
LOG_LEVEL=debug unraid-api start --debug
```

2. Verificar logs para:

- Claims recibidos del proveedor
- Evaluaci√≥n de reglas de autorizaci√≥n
- Errores de validaci√≥n de tokens

## üîê Mejores pr√°cticas de seguridad

1. **Usar Modo Simple para la autorizaci√≥n** - Previene configuraciones excesivamente permisivas y reduce el riesgo de errores de configuraci√≥n
2. **Ser espec√≠fico con la autorizaci√≥n** - No uses reglas demasiado amplias
3. **Rotar secretos regularmente** - Actualiza los secretos del cliente peri√≥dicamente
4. **Probar exhaustivamente** - Verifica que solo los usuarios autorizados puedan acceder

## üí° ¬øNecesitas ayuda?

- Consulta la documentaci√≥n OIDC del proveedor
- Revisa los registros de la API de Unraid para obtener mensajes de error detallados
- Aseg√∫rate de que tu proveedor soporte el descubrimiento est√°ndar de OIDC
- Verifica la conectividad de red entre Unraid y el proveedor

## üè¢ Configuraci√≥n espec√≠fica del proveedor

### Proveedor Unraid.net

El proveedor Unraid.net est√° integrado y preconfigurado. Solo necesita configurar las reglas de autorizaci√≥n en la interfaz.

**Configuraci√≥n:**

- **URL del emisor**: Preconfigurado (proveedor integrado)
- **ID/Secreto del Cliente**: Preconfigurado (proveedor integrado)
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

:::tip[Redirect Protocolo URI]
**Haga coincidir el protocolo con la configuraci√≥n de su servidor:** Use `http://` si accede a su servidor Unraid sin SSL/TLS (t√≠pico para acceso a red local). Use `https://` si ha configurado SSL/TLS en su servidor. Algunos proveedores OIDC (como Google) requieren HTTPS y no aceptar√°n URIs de redirecci√≥n HTTP.
:::

Configura reglas de autorizaci√≥n usando Modo Simple (dominios/correos electr√≥nicos permitidos) o Modo Avanzado para requisitos complejos.

### Google

<details>
  <summary><strong>üìã Pasos de configuraci√≥n</strong></summary>

  Configura las credenciales OAuth 2.0 en [Google Cloud Console](https://console.cloud.google.com/):

  1. Ve a **APIs y servicios** ‚Üí **Credenciales**
  2. Haz clic en **Crear credenciales** ‚Üí **ID de cliente OAuth**
  3. Elige **Aplicaci√≥n web** como el tipo de aplicaci√≥n
  4. Agrega tu URI de redirecci√≥n a **URIs de redirecci√≥n autorizados**
  5. Configura la pantalla de consentimiento OAuth si se solicita
</details>

**Configuraci√≥n:**

- **URL del Emisor**: `https://accounts.google.com`
- **ID/Secreto del Cliente**: Desde tus credenciales de cliente OAuth 2.0
- **√Åmbitos requeridos**: `openid`, `profile`, `email`
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

:::warning[Google Requisitos de dominio]
**Google requiere nombres de dominio v√°lidos para los URIs de redirecci√≥n OAuth.** No se aceptan direcciones IP locales y dominios `.local`. Para usar Google OAuth con su servidor Unraid, necesitar√°:

- **Opci√≥n 1: Proxy inverso** - Configura un proxy inverso (como NGINX Proxy Manager o Traefik) con un nombre de dominio v√°lido que apunte a tu API de Unraid
- **Opci√≥n 2: Tailscale** - Usa Tailscale para obtener un dominio `*.ts.net` v√°lido que Google aceptar√°
- **Opci√≥n 3: DNS din√°mico** - Usa un servicio de DNS din√°mico para obtener un nombre de dominio p√∫blico para tu servidor

Recuerda actualizar tu URI de redirecci√≥n tanto en Google Cloud Console como en la configuraci√≥n OIDC de tu Unraid para usar el dominio v√°lido.
:::

Para los dominios de Google Workspace, usa Modo Avanzado con la propiedad `hd` para restringir el acceso al dominio de tu organizaci√≥n.

### Authelia

Configura el cliente OIDC en tu `configuration.yml` de Authelia con el ID de cliente `unraid-api` y genera un secreto con hash usando el comando hash-password de Authelia.

**Configuraci√≥n:**

- **URL del Emisor**: `https://auth.yourdomain.com`
- **ID de Cliente**: `unraid-api` (o seg√∫n configurado en Authelia)
- **Secreto del Cliente**: Tu secreto sin cifrar
- **√Åmbitos requeridos**: `openid`, `profile`, `email`, `groups`
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Usa Modo Avanzado con la propiedad `groups` para autorizaci√≥n basada en grupos.

### Microsoft/Azure AD

Registrar una nueva aplicaci√≥n en [Azure Portal](https://portal.azure.com/) bajo Azure Active Directory ‚Üí Registros de la aplicaci√≥n. Anote el ID de la aplicaci√≥n, cree un secreto de cliente y anote su ID de arrendatario.

**Configuraci√≥n:**

- **URL del Emisor**: `https://login.microsoftonline.com/YOUR_TENANT_ID/v2.0`
- **ID de Cliente**: Tu ID de aplicaci√≥n (cliente)
- **Secreto del Cliente**: Secreto de cliente generado
- **√Åmbitos requeridos**: `openid`, `profile`, `email`
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Las reglas de autorizaci√≥n pueden configurarse en la interfaz usando dominios de correo electr√≥nico o propiedades avanzadas.

### Keycloak

Crea un nuevo cliente confidencial en el Console de Administraci√≥n de Keycloak con el protocolo `openid-connect` y copia el secreto del cliente desde la pesta√±a de Credenciales.

**Configuraci√≥n:**

- **URL del Emisor**: `https://keycloak.example.com/realms/YOUR_REALM`
- **ID de Cliente**: `unraid-api` (o seg√∫n configurado en Keycloak)
- **Secreto del Cliente**: De la pesta√±a Credenciales de Keycloak
- **√Åmbitos requeridos**: `openid`, `profile`, `email`
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Para autorizaci√≥n basada en roles, usa Modo Avanzado con propiedades `realm_access.roles` o `resource_access`.

### Authentik

Crea un nuevo Proveedor OAuth2/OpenID en Authentik, luego crea una aplicaci√≥n y vinc√∫lala al proveedor.

**Configuraci√≥n:**

- **URL del Emisor**: `https://authentik.example.com/application/o/<application_slug>/`
- **ID de Cliente**: De la configuraci√≥n del proveedor Authentik
- **Secreto del Cliente**: De la configuraci√≥n del proveedor Authentik
- **√Åmbitos requeridos**: `openid`, `profile`, `email`
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Las reglas de autorizaci√≥n pueden configurarse en la interfaz.

### Okta

Crea una nueva aplicaci√≥n web OIDC en el Console de Administraci√≥n de Okta y asigna los usuarios o grupos apropiados.

**Configuraci√≥n:**

- **URL del Emisor**: `https://YOUR_DOMAIN.okta.com`
- **ID de Cliente**: De la configuraci√≥n de la aplicaci√≥n Okta
- **Secreto del Cliente**: De la configuraci√≥n de la aplicaci√≥n Okta
- **√Åmbitos requeridos**: `openid`, `profile`, `email`
- **URI de redirecci√≥n**: `http://YOUR_UNRAID_IP/graphql/api/auth/oidc/callback`

Las reglas de autorizaci√≥n pueden configurarse en la interfaz usando dominios de correo electr√≥nico o propiedades avanzadas.
