---
sidebar_position: 1
sidebar_label: Capture diagnostics and logs
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import SyslogMirror from './partials/syslog-server/mirror.mdx';
import SyslogRemote from './partials/syslog-server/remote.mdx';
import SyslogLocal from './partials/syslog-server/local.mdx';
import DockerLogsViaWebGUI from './partials/docker-logs/via-webgui.mdx';
import DockerLogsCommandLine from './partials/docker-logs/command-line.mdx';
import DockerLogsPersistent from './partials/docker-logs/persistent.mdx';

# Capturing diagnostic information

When you have issues with your Unraid server, gathering detailed information is crucial for effective troubleshooting. This information helps others provide accurate and timely assistance, especially when you post in forums.

:::info[Diagnostics include...]

- **System configuration**: Information about your %%array|array%%, shares, network settings, and installed plugins.
- **System logs**: Logs from the kernel, %%WebGUI|web-gui%%, and system services, documenting events that may have led to the issue.
- **Hardware information**: Details about connected drives, controllers, and other hardware components.
- **Docker 和 %%VM|vm%% 信息**：Docker 和虚拟机的整体配置（不包括关于您个人容器或 %%VMs|vm%% 的信息）。
  :::

---

## System diagnostics

Unraid provides a **Diagnostics** tool located under ***Tools → Diagnostics*** in the %%WebGUI|web-gui%% to capture comprehensive system information for troubleshooting. This tool will generate a zip file you can download and attach to forum posts for support. All diagnostics files are text-based, and users can review them to understand what information is included.

| 场景                                      | 如何捕获                                                                                                                                 | Notes                                                                                                                      |
| --------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------------------------- |
| %%WebGUI\|web-gui%% 可用                  | 在 **%%WebGUI\|web-gui%%** 中使用 ***工具 → 诊断*** 来生成并下载诊断 zip 文件。                                                                         | 诊断默认是匿名的，以保护敏感数据。                                                                                                          |
| %%WebGUI\|web-gui%% 不可用                 | 通过 **%%SSH\|ssh%%**、telnet 或直接控制台访问以运行 `diagnostics` 命令。zip 文件保存到 `/boot/logs`。                                                      | 重启前务必捕获诊断以保持日志完整。                                                                                                          |
| %%Array\|array%% started in normal mode | This is the preferred method for capturing diagnostics, as it provides the most complete information, especially about drive status. | If this isn't possible, see the [Persistent logs section](#persistent-logs-syslog-server) for alternative capture methods. |

<div style={{ margin: 'auto', maxWidth: '600px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
  ![Disk selection logic](/img/Diagnostics.jpg)
</div>

:::important
Attach the single diagnostics zip file when posting on forums - avoid uploading the extracted files individually.
:::

### Anonymization of diagnostic data

By default, diagnostics are automatically anonymized. If you enable %%Mover|mover%% logging under ***Settings → Scheduler → Mover Settings***, the %%syslog|syslog%% will include details about files the %%Mover|mover%% processes. It's best to allow %%Mover|mover%% logging only when troubleshooting specific %%Mover|mover%%-related issues, as it may reveal file paths and names.

When your system shuts down gracefully, the session log is saved automatically to the flash drive. You can access it after rebooting by going to ***Tools → Syslog → syslog-previous***. This log is also included in diagnostics on the next boot. However, if the system crashes, the system log will be lost. In these cases, enabling %%syslog|syslog%% mirroring to the flash or using a remote %%syslog server|syslog-server%% is recommended to preserve logs for troubleshooting.

---

## Testing drive read performance

You can use built-in Linux tools to evaluate the read performance of your hard drives. This is helpful when diagnosing slow %%parity|parity%% syncs, sluggish disk responses, or mismatched speeds among drives in an %%array|array%% or %%cache|cache%%.

:::important[When and why to test drive speed]

- Extremely slow %%parity|parity%% builds or %%parity check|parity-check%%s
- Suspiciously slow file transfers from a specific disk
- Drive mismatches after adding or replacing disks, particularly when mixing SSDs and HDDs
- Reallocated sectors or %%UDMA|udma%% %%CRC errors|crc-errors%%, which may indicate failing drives

虽然这些测试无法提供您在现实世界中的精确文件传输速度，但它们可以指出表现不佳的磁盘和任意控制器瓶颈。
:::

### Quick test (hdparm)

The `hdparm` tool measures both cached and buffered read speeds of a disk.

To run the test, replace `X` with your disk device (like `sdb` or `sdg`) and enter the following command:

```
hdparm -tT /dev/sdX
```

- The `-T` result shows the cache read speed.
- The `-t` result shows the buffered (sequential) disk read performance.

:::tip
Run this test multiple times to get a more reliable benchmark. For example, you can use the following one-liner to run the test 12 times:

```
for ((i=0;i<12;i++)); do hdparm -tT /dev/sdX; done
```

:::

:::note
Make sure to replace `/dev/sdX` with a valid physical device. Avoid logical Unraid devices, such as `/dev/md1`, which include %%parity|parity%% processes that may distort the raw performance readings.
:::

### Comprehensive test (diskspeed.sh)

For a more detailed assessment of all attached drives, including %%parity|parity%% and data drives, consider using the community script `diskspeed.sh`.

This script:

- Tests read speeds at multiple linear offsets across the disk surface
- Generates CSV data and performance heat maps (images)
- Can identify zones of poor performance, which might be a sign of failing hardware or problematic SMR drives

To get started with `diskspeed.sh`:

1. Download the script from the [Unraid forums](https://forums.unraid.net/topic/31073-disk-speed-test-graphs-disk-bottlenecks-identified-see-how-fast-your-disks-can-really-go/).
2. Place it in a persistent path like `/boot/scripts/`.
3. Make it executable:

```
chmod +x /boot/scripts/diskspeed.sh
```

4. Run the script:

```
bash /boot/scripts/diskspeed.sh
```

:::note
This script only performs read-only operations and won't modify any data on your drives. However, it's best to schedule the test during idle periods, as it may affect disk I/O and interfere with %%array|array%% performance.
:::

---

## Persistent logs (syslog server)

Persistent logs are essential for keeping a record of system events between reboots. Unlike standard logs that reset when the system restarts, persistent logs use Unraid's built-in %%syslog server|syslog-server%% to ensure you can diagnose crashes or intermittent issues that arise over time.

### Choosing the right logging method

Go to ***Settings → Syslog Server*** to set up persistent logging. Each method has advantages and disadvantages:

| 方法                            | 优点                                                                             | 缺点                                        | Best for                                    |
| ----------------------------- | ------------------------------------------------------------------------------ | ----------------------------------------- | ------------------------------------------- |
| **镜像到闪存**                     | 捕获启动过程事件                                                                       | 可能迅速磨损闪存驱动器                               | 短期诊断（几天）                                    |
| **Remote %%syslog\|syslog%%** | 日志存储在另一台设备上                                                                    | 需要一个独立的常开服务器                              | 长期监控（几周到几个月）                                |
| **本地 %%syslog\|syslog%%**     | Keeps logs on the %%array\|array%% or %%cache\|cache%%, reducing wear on flash | Less accessible if there's a system crash | Continuous logging without external devices |

:::tip
For detailed configuration help, check the **Help** icon in the WebGUI toolbar.
:::

### Enabling the syslog server

<Tabs>
  <TabItem value="镜像" label="镜像到闪存" default>
    <SyslogMirror />
  </TabItem>

  <TabItem value="远程" label="远程syslog服务器">
    <SyslogRemote />
  </TabItem>

  <TabItem value="本地" label="本地syslog服务器">
    <SyslogLocal />
  </TabItem>
</Tabs>

---

## Accessing Docker container logs

While standard diagnostics only provide limited data for Docker and %%VM|vm%%, you can access container logs directly for more detailed troubleshooting.

To retrieve Docker logs:

<Tabs>
  <TabItem value="via-webgui" label="通过 WebGUI" default>
    <DockerLogsViaWebGUI />
  </TabItem>

  <TabItem value="命令行" label="通过命令行">
    <DockerLogsCommandLine />
  </TabItem>

  <TabItem value="持久性" label="持久日志记录">
    <DockerLogsPersistent />
  </TabItem>
</Tabs>

### Virtual machine logs

%%VM|vm%% logs can be accessed through their respective hypervisors (for example, %%QEMU|qemu%% logs are located in `/var/log/libvirt/`). Check your %%VM|vm%% platform's documentation for more details.

:::important
Remember to attach the relevant container or %%VM|vm%% logs separately when seeking support for application-specific issues.
:::
