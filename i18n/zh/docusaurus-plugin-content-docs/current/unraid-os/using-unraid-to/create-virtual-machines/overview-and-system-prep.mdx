---
sidebar_position: 1
sidebar_label: Overview & system prep
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HvmSupport from './partials/hvm-support.mdx';
import IommuSupport from './partials/iommu-support.mdx';
import GpuNvidia from './partials/gpu-nvidia.mdx';
import GpuAmd from './partials/gpu-amd.mdx';

# Overview & system prep

Virtual machines (VMs) allow you to run full operating systems, such as Windows, macOS, or Linux, on your Unraid server, side-by-side with Docker containers.

%%VMs|vm%% are ideal for:

- Running applications that require a full OS or are unavailable as containers.
- Assigning dedicated hardware to guest systems, such as GPUs or USB devices.
- Testing, development, gaming, or running legacy software.
- Hosting multiple isolated environments for different workloads.

For a list of operating systems tested with Unraid, see the [%%VM|vm%% Setup](./vm-setup.mdx) page.

<details>
  <summary>**幕后的故事：** 展开以了解更多 Unraid 虚拟化的技术堆栈</summary>

  Unraid 的虚拟化栈设计灵活且性能卓越，利用多种开源技术支持高效的虚拟机管理。此概述以用户友好的方式阐明了关键组件及其交互。

  <h4>核心技术</h4>

  | 技术                                | 功能                                                                                        | 重要性                                                                                                       |
  | --------------------------------- | ----------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------- |
  | %%KVM\|kvm%%                      | 充当嵌入在Linux内核中的%%hypervisor\|hypervisor%%。                                                 | 允许 Unraid 流畅运行虚拟机，具备硬件加速功能且开销最小。                                                                          |
  | %%QEMU\|qemu%%                    | Emulates the essential hardware (like motherboard, CPU, and controllers) for %%VMs\|vm%%. | 与%%KVM\|kvm%%协作，为客户操作系统创建完整的虚拟环境。                                                                         |
  | %%Libvirt\|libvirt%%              | 管理%%虚拟机\|vm%%定义，以及存储和网络接口。                                                                | 将%%虚拟机\|vm%%配置存储在`libvirt.img`中，并提供一致的管理API。                                                              |
  | %%VNC\|vnc-session%%              | 提供对%%虚拟机\|vm%%的远程图形访问。                                                                    | 允许使用浏览器或%%VNC\|vnc-session%%客户端从任何设备与%%虚拟机\|vm%%交互。                                                       |
  | %%VirtIO\|virtio%%                | 为网络和磁盘设备提供高性能的半虚拟化驱动程序。                                                                   | Enhances %%VM\|vm%% speed and efficiency, requiring %%VirtIO\|virtio%% drivers installed in the guest OS. |
  | %%VirtFS\|virtfs%% (`9p`)         | 在主机和基于 Linux 的来宾之间促进文件系统共享。                                                               | 适用于开发和高级文件共享需求。                                                                                           |
  | %%HVM\|hvm%%                      | Supports hardware-assisted virtualization (%%Intel VT-x\|intel-vt-x%%, %%AMD-V\|amd-v%%). | 运行%%虚拟机\|vm%%以实现完全硬件加速的必要条件。                                                                              |
  | %%VFIO\|vfio%% & %%IOMMU\|iommu%% | 允许直接向%%虚拟机\|vm%%传递PCI设备（如GPU和USB设备）。                                                      | 对于实现接近原生性能和维护安全隔离至关重要。                                                                                    |

  <h4>Unraid 如何实现 %%VM|vm%% 支持</h4>

  - %%KVM|kvm%%/%%QEMU|qemu%%: Unraid’s virtualization is fundamentally based on %%KVM|kvm%% and %%QEMU|qemu%%, providing robust %%VM|vm%% hosting capabilities.
  - %%Libvirt|libvirt%%: %%VM|vm%% definitions are stored as XML files in `libvirt.img` (typically found in the `system` share).
  - **Default shares**:
    - `domains`: Holds %%VM|vm%% %%virtual disk images|virtual-disk-images%%.
    - `isos`: Contains installation ISOs and driver images.
    - `system`: Stores `libvirt.img` and other critical system files.
    - All default to **Use %%Cache|cache%%: Prefer** for optimal performance.
  - %%VNC|vnc-session%%: Unraid features a built-in NoVNC client for easy browser-based access to %%VMs|vm%%, with the option to use external %%VNC clients|vnc-session%% as needed.

  :::tip
  大多数用户不需要直接与这些技术交互，但了解 "引擎盖下" 的运作对高级故障排除和自定义设置非常有用。有关更多详细信息，请查看 [KVM](https://www.linux-kvm.org/page/Main_Page)、[QEMU](https://www.qemu.org/)、[Libvirt](https://libvirt.org/)、[VirtIO](https://www.linux-kvm.org/page/Virtio) 的官方文件。
  :::
</details>

## Requirements

To run %%VMs|vm%% on Unraid, your system must meet the following requirements:

| 组件             | 最低要求                                                          | 推荐用于%%虚拟机\|vm%% & %%GPU直通\|gpu-passthrough%%                                   |
| -------------- | ------------------------------------------------------------- | ------------------------------------------------------------------------------ |
| CPU            | 64 位，4 核，2.4 GHz+（Intel/AMD）                                  | 8 个以上内核，3.0 GHz+（Intel Core i7/i9，AMD Ryzen 7/9 或更新版本）                         |
| 虚拟化            | %%HVM\|hvm%% (%%Intel VT-x\|intel-vt-x%% or %%AMD-V\|amd-v%%) | %%HVM\|hvm%% + %%IOMMU\|iommu%% (Intel VT-d or AMD-Vi)                         |
| RAM            | 8 GB                                                          | 16 GB 或更多（每个活动虚拟机增加 RAM）                                                       |
| Storage        | 用于%%虚拟机\|vm%%磁盘的SSD/NVMe                                      | 高端 NVMe 以获得最佳性能                                                                |
| 网络             | 千兆以太网（建议使用 PCIe）                                              | 2.5 G/10 G 以太网用于高需求工作负载                                                        |
| GPU (optional) | 现代 NVIDIA RTX（推荐）或 AMD Radeon RX                              | RTX 3000/4000 series (NVIDIA recommended for better passthrough compatibility) |

:::tip[GPU passthrough compatibility]
NVIDIA GPUs are **generally recommended** for %%VM|vm%% passthrough due to better compatibility and reliability. AMD GPUs can be more challenging to pass through, and some newer models (including RX 7000/9000 series) may not work reliably or at all with %%VMs|vm%%. If you're planning to use %%GPU passthrough|gpu-passthrough%%, consider NVIDIA options for the best experience.
:::

:::note
Your motherboard BIOS must enable Hardware-assisted virtualization and %%IOMMU|iommu%% support. Look for settings labeled “%%Intel VT-x|intel-vt-x%%,” “Intel VT-d,” “%%AMD-V|amd-v%%,” or “AMD-Vi.”
:::

### VM resources

| %%虚拟机\|vm%%类型            | RAM per %%VM\|vm%% | vCPUs per %%VM\|vm%% | 使用例子                                             |
| ------------------------ | ------------------ | -------------------- | ------------------------------------------------ |
| 虚拟服务器                    | 1-2 GB             | 1-2                  | 轻量级Linux，实用工具%%虚拟机\|vm%%                         |
| 虚拟桌面                     | 4–8 GB             | 2–4                  | Windows 11，Ubuntu 桌面，RDP                         |
| Hybrid/gaming %%VM\|vm%% | 8–16 GB+           | 4–8+                 | %%GPU passthrough\|gpu-passthrough%%, gaming, ML |

- Memory and CPU are only consumed while %%VMs|vm%% are running.
- Plan for peak usage if running multiple %%VMs|vm%% simultaneously.
- Always allocate resources based on guest OS and workload requirements.

### HVM & IOMMU: What they enable

<Tabs>
  <TabItem value="hvm" label="HVM 支持">
    <HvmSupport />
  </TabItem>

  <TabItem value="iommu" label="IOMMU 支持">
    <IommuSupport />
  </TabItem>
</Tabs>

:::important[How to check support]

- **HVM support:** Shows if hardware virtualization is present and enabled.
- **IOMMU 支持：** 显示是否可以使用设备直通并已启用。
  :::

---

### Graphics device passthrough

Passing a GPU to a %%VM|vm%% allows for near-native graphics performance, making it ideal for gaming, creative work, or machine learning.

<Tabs>
  <TabItem value="nvidia" label="NVIDIA">
    <GpuNvidia />
  </TabItem>

  <TabItem value="amd" label="AMD">
    <GpuAmd />
  </TabItem>
</Tabs>

:::tip[General tips]

- Use %%OVMF|ovmf%% (%%UEFI|uefi%%) for %%VMs|vm%% with modern GPUs.
- Always use the latest Unraid version for improved hardware support.
- 像 NVIDIA Optimus 这样的技术可能允许笔记本电脑或高级设置的 %%GPU 直通%%，但结果各异。
  :::

:::info[Always changing]
Hardware and driver compatibility changes rapidly. Before purchasing a GPU for passthrough, check the [Unraid forums](https://forums.unraid.net/) and vendor documentation for up-to-date reports and user experiences.
:::

---

## System preparation

Before you create virtual machines, complete these essential setup tasks to ensure your system is ready.

### Adjust BIOS settings

To fully utilize Unraid's virtualization capabilities, your BIOS must enable hardware-assisted virtualization and I/O memory management. Look for settings labeled **Virtualization**, %%Intel VT-x|intel-vt-x%%, **Intel VT-d**, %%AMD-V|amd-v%%, or **AMD-Vi** and set them to **Enabled**.

:::note
BIOS interfaces vary by manufacturer. Check your motherboard manual for the exact location of these settings.
:::

### Configure a network bridge

%%Virtual machines|vm%% can connect to your network using one of two bridge types. Choose the one that best fits your needs:

| 桥接类型                     | 描述                                                                                                                                                                                                           | Use case                                                                                                     |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------ |
| **Private NAT (virbr0)** | Managed by %%libvirt\|libvirt%%. This option provides an internal DHCP server and an isolated subnet. %%VMs\|vm%% can access the internet and host file shares, but are isolated from other network devices. | 适合需要互联网和主机访问但无需局域网可见的孤立%%虚拟机\|vm%%。                                                                          |
| **公共桥接 (br0)**           | 由 Unraid 管理。此选项将虚拟机直接连接到您的 LAN，由路由器分配 IP 地址。MAC 地址保持不变以确保 IP 地址的一致性。                                                                                                                                         | Best for %%VMs\|vm%% that should function as regular devices on your network, accessible from other devices. |

:::important
If your Unraid server is connected to Wi-Fi, using the **Private NAT (virbr0)** network bridge for your %%virtual machines|vm%% is recommended. This is because Wi-Fi interfaces support only a single MAC address, which restricts the use of public bridges and custom network types. By utilizing the **virbr0** bridge, your %%VMs|vm%% will have complete network access through %%NAT|nat%%, although they will not be directly accessible from other devices on your local area network (LAN). However, you can still access the %%VMs|vm%% via %%VNC|vnc-session%% through the host.
:::

- Enable the public bridge in ***Network settings → Enable bridging***.
- Set your preferred bridge as the **Default network bridge** in %%VM|vm%% settings. You may need to enable advanced view to see this option.

---

### User shares for virtualization

Unraid creates two default %%user shares|user-share%% for %%virtualization|virt%%:

- `isos`: This share stores installation media files for your %%VMs|vm%%.
- `domains`: This share holds %%virtual machine|vm%% %%virtual disk images|virtual-disk-images%% and configuration files.

Consider creating a separate share for %%VM|vm%% backups to protect your data.

<h4>Share configuration recommendations</h4>

- Store active %%VM|vm%% %%virtual disk images|virtual-disk-images%% on a %%cache|cache%%-only share for the best performance.
- Using SSDs in your %%cache pool|cache-pool%% significantly improves %%VM|vm%% responsiveness.
- %%Cache|cache%% usage for the `isos` share is optional.

:::important
Do not store active %%virtual machines|vm%% on a share with **Use %%cache|cache%%** set to **Yes**. This can cause %%VMs|vm%% to be moved to the %%array|array%% during the %%Mover|mover%% process, leading to degraded performance.
:::

## Set up virtualization preferences

Before you begin, ensure your system is ready for virtualization (see [System preparation](#system-preparation)). Setting your %%virtualization|virt%% preferences in Unraid helps ensure your %%virtual machines (VMs)|vm%% are configured for optimal performance and compatibility.

To set your virtualization preferences:

1. In the %%WebGUI|web-gui%%, go to ***Settings → VM Manager***.
2. **For Windows VMs:**
   - Download the latest stable %%VirtIO|virtio%% Windows drivers ISO from the [official repository](https://github.com/virtio-win/virtio-win-pkg-scripts/blob/master/README.md).
   - Copy the %%VirtIO|virtio%% ISO file to your **isos** share.
   - In **VM Manager**, use the file picker for **VirtIO Windows Drivers ISO** to select the ISO you just copied.
   - (Optional) Override the default driver ISO for individual %%VMs|vm%% in **Advanced View**.
3. **Select a default network bridge:**
   - Choose `virbr0` for a private network bridge, or select a public bridge (e.g., `br0`) created in **Network Settings**.
   - (Optional) Override the default network bridge for each %%VM|vm%% in **Advanced View**.
4. **PCIe ACS override (Advanced):**
   - Toggle **PCIe ACS Override** to **On** if you need to assign multiple PCI devices (like %%GPUs|gpu-passthrough%% or USB controllers) to different %%VMs|vm%%.
   - This option breaks apart %%IOMMU|iommu%% groups, allowing more flexible device passthrough.

:::warning
This setting is experimental and may affect system stability. Use with caution.
:::

5. Click **Apply** to save your settings.
