---
sidebar_position: 4
sidebar_label: 文件系统
---

# 文件系统

## 选择文件系统类型

为您的 Unraid %%array|array%% 或 %%cache pool|cache-pool%% 选择正确的文件系统至关重要。它有助于实现性能、数据保护和高级功能之间的平衡。Unraid 支持多种现代 Linux 文件系统，每种都有其独特的优势和特定的使用场景：

| 文件系统             | 数据保护                                                                            | 空间效率                    | 高级功能                                                             | 最佳使用案例                                                 |
| ---------------- | ------------------------------------------------------------------------------- | ----------------------- | ---------------------------------------------------------------- | ------------------------------------------------------ |
| %%XFS\|xfs%%     | 没有内置冗余                                                                          | 100%                    | 对损坏的强大抗性                                                         | 默认的数组驱动器；高可靠性                                          |
| EXT4             | 没有内置冗余                                                                          | 100%                    | Mature, stable, journaled                                        | Array drives or single-drive pools; alternative to XFS |
| %%ZFS\|zfs%%     | %%RAIDZ1\|raidz1%%/%%RAIDZ2\|raidz2%%/%%RAIDZ3\|raidz3%%，镜像等。                   | 根据%%RAID\|raid%%级别而有所不同 | %%Checksums\|checksum%%, %%Snapshots\|snapshot%%, %%RAID\|raid%% | 多设备池，%%虚拟机\|vm%%，Docker，高级用户                           |
| %%BTRFS\|btrfs%% | %%RAID 0\|raid0%%/%%RAID 1\|raid1%%/%%10\|raid10%%/%%5\|raid5%%/%%6\|raid6%%、镜像 | 根据%%RAID\|raid%%级别而有所不同 | %%Checksums\|checksum%%, %%Snapshots\|snapshot%%, %%RAID\|raid%% | 多设备池，混合SSD/HDD，灵活的池                                    |
| NTFS             | 没有内置冗余                                                                          | 100%                    | Windows compatibility                                            | Adding existing Windows drives without data migration  |
| exFAT            | 没有内置冗余                                                                          | 100%                    | 跨平台兼容性                                                           | Adding existing exFAT drives without data migration    |

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FsCheckCliXfs from './partials/fs-check-cli-xfs.mdx';
import FsCheckCliBtrfs from './partials/fs-check-cli-btrfs.mdx';
import FsCheckCliZfs from './partials/fs-check-cli-zfs.mdx';
import FsRepairCliXfs from './partials/fs-repair-cli-xfs.mdx';
import FsRepairCliBtrfs from './partials/fs-repair-cli-btrfs.mdx';
import FsRepairCliZfs from './partials/fs-repair-cli-zfs.mdx';

### XFS

%%XFS|xfs%% is the default file system for %%array|array%% drives in Unraid. It's known for its robustness and ability to recover from corruption after unexpected shutdowns or crashes. Each drive formatted with %%XFS|xfs%% acts as a self-contained file system, making data recovery straightforward on any Linux system.

- **数据保护：** 没有内建冗余；依赖 Unraid 的 %%parity|parity%% 进行保护。
- \*\*性能：\*\*一致且可靠。
- \*\*最适合：\*\*特别是当稳定性和数据恢复易用性优先时的%%Array|array%%驱动器。

### EXT4

EXT4 is a mature and stable file system that offers excellent compatibility and reliability. It is fully supported and stands on par with %%XFS|xfs%%, %%BTRFS|btrfs%%, and %%ZFS|zfs%%, making it a strong choice for array drives or single-drive pools.

- **Data protection:** It does not have built-in redundancy and relies on Unraid's %%parity|parity%% for protection.
- **Performance:** It provides consistent and reliable performance with journaling to ensure data integrity.
- **Best for:** %%Array|array%% drives or single-drive pools when you are looking for an alternative to %%XFS|xfs%%.

### ZFS

%%ZFS|zfs%% is a modern file system that comes with advanced features such as %%checksums|checksum%% to detect %%bit rot|bit-rot%%, %%snapshots|snapshot%% for backups, and native %%RAID|raid%% support options like %%RAIDZ1|raidz1%%/%%RAIDZ2|raidz2%%/%%RAIDZ3|raidz3%% and mirrors. %%ZFS|zfs%% can be utilized for both single-device and multi-device pools.

- \*\*数据保护：\*\*支持各种%%RAID&#124;raid%%级别以实现冗余。
- \*\*性能：\*\*尤其是对多设备池来说表现优异。
- **最佳用途：** 高性能环境、%%虚拟机|vm%%、Docker 或需要高级功能（如 %%snapshots|snapshot%%）时。

For comprehensive guidance on %%ZFS|zfs%% features, configuration, and best practices, see the dedicated [ZFS storage](../../advanced-configurations/optimize-storage/zfs-storage.mdx) page.

### BTRFS

%%BTRFS|btrfs%% 提供灵活的 %%RAID|raid%% 支持，%%checksums|checksum%% 确保数据完整性，并在池中有效管理不同大小的驱动器。它是%%cache pools|cache-pool%% 的默认文件系统，并支持单设备和多设备配置。

- **数据保护：** 支持%%RAID 0|raid0%%/%%1|raid1%%/%%10|raid10%%/%%5|raid5%%/%%6|raid6%% （注意%%RAID 5|raid5%%/%%6|raid6%% 仍然是实验性的）。
- **性能：** 良好，具有扩展和收缩的灵活性。
- **最适合：** %%Cache pools|cache-pool%%，尤其是在你计划混合使用SSD和HDD或需要简单扩展时。

### NTFS and exFAT (limited support)

NTFS and exFAT file systems are supported with some limitations. This is mainly to help you add existing drives with data to your Unraid system without needing to transfer the data elsewhere first.

:::warning

Drives formatted with NTFS or exFAT must be added to the %%array|array%% **before** you add any parity drives. Once a parity drive has been added to your %%array|array%%, any new data drives you add will be zeroed out, regardless of their file system format.

If you want to use existing NTFS or exFAT drives:

- Add them to the %%array|array%% first (or run ***Tools → New Config*** to reset your array configuration).
- After adding your NTFS/exFAT data drives, you can then add parity drives.
- The existing data on these drives will be preserved and protected by parity.

:::

- **Data protection:** These drives do not offer built-in redundancy; they rely on Unraid's %%parity|parity%% for protection once parity is added.
- **Performance:** Adequate for basic storage needs.
- **Best for:** Adding existing Windows-formatted drives (NTFS) or cross-platform formatted drives (exFAT) without the need for data migration. They can also be used for single-drive pools.
- **Limitations:** These file systems are not recommended for regular use; they are intended primarily for migrating existing drives. For new drives, consider using %%XFS|xfs%%, EXT4, %%BTRFS|btrfs%%, or %%ZFS|zfs%% instead.

For more details on adding existing drives, see the [release notes](../../release-notes/7.2.0.md#ext234-ntfs-and-exfat-support).

:::note[Additional 笔记]

- Mixing different file system types in your Unraid system is perfectly acceptable; the Unraid %%parity|parity%% system works independently of the file system used.
- 始终在 Unraid 内格式化和分区驱动器以确保兼容性。
- Linux  系统可以原生读取这些文件系统；然而，Windows 和 macOS 将需要额外的软件来访问。
- You can **encrypt** drives for enhanced security, but keep in mind that encrypted drives might pose challenges for recovery if corruption occurs.
- 对于传输驱动器或外部设备，建议使用支持额外文件系统的 **[Unassigned Devices](#using-the-unassigned-devices-plugins)** 插件。
  :::

:::

:::tip[Still 需要帮助选择吗？]

- **For array drives:** %%XFS|xfs%% is generally the best choice for most users. EXT4 is also a solid option if you prefer a more traditional Linux file system.
- **For high-performance or advanced features:** Choose %%ZFS|zfs%% or %%BTRFS|btrfs%% for %%cache pools|cache-pool%% or multi-device setups. See the [ZFS storage](../../advanced-configurations/optimize-storage/zfs-storage.mdx) page for detailed %%ZFS|zfs%% guidance.
- **对于混合或扩展池：** 如果你想使用不同的驱动器大小或轻松地添加或删除设备，%%BTRFS|btrfs%% 是理想选择。
- **For existing drives:** Use NTFS or exFAT only when adding existing drives with data; add them before adding parity.

如果不确定，开始默认设置是一种好的方法：对于%%array|array%%驱动器使用 %%XFS|xfs%% ，对于 %%cache pools|cache-pool%% 使用 %%BTRFS|btrfs%%。

:::

---

## 设定文件系统类型

在向 Unraid 添加新磁盘时，您可以选择最适合您需求的文件系统类型。文件系统决定了磁盘上数据的组织和保护方式。

To set the file system type globally, navigate to ***Settings → Disk Settings*** to set the default file system for new %%array|array%% drives only. Unraid defaults to %%XFS|xfs%% for %%array|array%% drives.

:::note

There is currently no global default setting for %%cache pools|cache-pool%%. They will always default to %%BTRFS|btrfs%% if left to "auto".

:::

:::important

If you're adding drives with existing NTFS or exFAT data, they must be added to the %%array|array%% before any parity drives are added. Once parity is present, all newly added data drives will be zeroed out regardless of their file system type.

:::

To set the file system for an individual drive:

1. Stop the %%array|array%% before making changes.
2. In the **Main** tab, click the drive you want to configure.
3. Select the desired file system type from the drop-down menu.
4. (Optional) If you select **auto**, Unraid uses the global default.
5. 对于多设备 %%cache pools|cache-pool%% ，仅支持 %%BTRFS|btrfs%% 或 %%ZFS|zfs%%。
6. If adding existing NTFS or exFAT data drives to the %%array|array%%, add them before adding any parity drives.

---

## 创建文件系统（格式化）

在 Unraid 中使用新磁盘之前，必须用选定的文件系统格式化。

:::warning

Formatting will erase all existing content on the drive. Make sure you've backed up any important data before proceeding.

:::

To format a drive:

1. 启动 %%array|array%%。
2. Identify unmountable drives (they appear as **unmountable**).
3. Verify that all unmountable drives are the ones you want to format.
4. Check the confirmation box, read the warning dialog, and click **Format**.
5. Monitor the process. For new disks, Unraid first rewrites the partition table.
6. Wait for completion. If progress stalls, refresh the **Main** tab.

格式化完成后，驱动器即可存储文件。

---

## 更改文件系统类型

要更改特定驱动器上的文件系统类型：

:::warning

如果您遇到任何问题，可以随时访问 [Unraid 论坛](https://forums.unraid.net/)。附上您的系统诊断 zip 文件（位于 **工具 → 诊断** 下）以获取帮助。

:::

要更改特定驱动器上的文件系统类型：

1. 停止%%array|array%%。
2. In the **Main** tab, click the drive you want to change.
3. Choose the new file system from the drop-down (repeat for multiple drives as needed).
4. 启动 %%array|array%%。
5. In the **Main** tab, review the unmountable drives list and ensure only the intended drives are included.
6. Check the confirmation box and click **Format**.
7. Wait for completion. If status doesn’t update, refresh the **Main** tab.

如果您遇到任何问题，可以随时访问 [Unraid 论坛](https://forums.unraid.net/)。附上您的系统诊断 zip 文件（位于 **工具 → 诊断** 下）以获取帮助。

---

## 转换到新的文件系统类型

:::important

The ***Main*** page will warn if any array or pool drives are formatted in legacy filesystems:

- Any drives formatted in ReiserFS need to be migrated to another filesystem ASAP as they will not be usable in future releases of Unraid.
- Any drives formatted in older XFS versions need to be migrated before 2030.

:::

要更改驱动器的文件系统类型但保留其数据，您必须在重新格式化之前迁移内容。该过程对于从不再支持的 ReiserFS（在旧版 Unraid 中使用）迁移到 %%XFS|xfs%% 或 %%BTRFS|btrfs%% 的用户尤为常见，但它适用于任何文件系统转换。

:::important

This process requires temporarily moving your data to another location. Make sure you have enough free space elsewhere in your %%array|array%% or on an external device before you begin.

:::

要安全地转换为新的文件系统类型：

1. Move all data off the drive to another location (another %%array|array%% drive, %%cache pool|cache-pool%%, or external backup). Use one of these methods:

   **Via the WebGUI:**

   - 导航到 ***主菜单 → 阵列操作*** 并停止阵列。
   - 导航到 ***设置 → 全局共享设置***。在**清空磁盘**区域，选择要清空的磁盘并点击 **应用**。注意：当阵列停止时，该状态将自动移除。
   - 导航到 ***主菜单 → 阵列操作*** 并启动阵列。
   - 在 ***主菜单 → 阵列操作*** 上点击 **移动** （或等待移动程序按其正常计划运行）。
   - 移动程序将根据您的共享设置清空磁盘。注意根目录的文件不包括在任何共享内，因此不会被移动。
   - 检查 ***工具 → 系统日志*** 查看文件因正在使用或缺乏空闲空间而无法移动的信息。

   **Or via the command line:**

   - Move files [using 'mover' to empty an array disk](../../release-notes/7.0.0.md#using-mover-to-empty-an-array-disk) to other array drives

   **Or manually:**

   - Move files manually to another location

   Once completed, navigate to ***Main → Array Devices*** and browse the disk to confirm it is empty. Proceed only when you are certain the disk is empty.
2. Follow the procedure for [changing a file system type](#changing-a-file-system-type). This formats the drive and erases all content, leaving a blank drive in the new format.
3. (Optional) Move your data back to the newly formatted drive, depending on where you moved the files.
4. If you have multiple drives to convert, repeat these steps for each drive.

:::note\[Timing]

此简单过程可确保驱动器完全擦除并格式化为所需格式。格式化过程通常只需几分钟。

:::

---

## 重新格式化驱动器

在 Unraid 中重新格式化驱动器将擦除所有数据并创建一个新的空文件系统。此过程有助于解决持久的文件系统错误或开始使用新的格式。

:::warning

从缓存移动数据：

:::

重新格式化缓存驱动器：

1. **停止阵列**。
2. **设置缓存驱动器格式**（在 %%XFS|xfs%% 或 %%BTRFS|btrfs%% 之间选择）。
   - 对于单驱动 %%cache|cache%%，推荐选择 %%XFS|xfs%%。
   - 选择不同的文件系统类型（例如，从%%XFS|xfs%%更改为%%BTRFS|btrfs%%）。
   - 启动%%array|array%%，驱动器将显示为**不可挂载的**。
   - 在提示时，格式化驱动器。
3. **启动阵列**。
   - 再次停止%%array|array%%。
   - 将文件系统改回你首选的类型。
   - 启动%%array|array%%并再次格式化驱动器。

还原数据和设置：

### 重新格式化缓存驱动器

有时，你需要重新格式化一个%%cache|cache%%驱动器，原因如下：

- 更改文件系统类型（例如，从%%BTRFS|btrfs%%转换到%%XFS|xfs%%或反之亦然）
- 修复持久的文件系统错误
- 为新的工作负载重新开始

#### Preparation

Before reformatting, prepare the system:

1. 停止%%array|array%%。
2. Go to **Settings** and disable Docker and %%VM|vm%% services (this prevents their tabs from appearing during the process).
3. Start the %%array|array%% again.

#### Move data off the cache

从缓存移动数据：

1. 设定共享存储与Mover操作 (缓存 → 阵列):
   - 转到**Shares** 选项卡。
   - For each share with files in the %%cache|cache%%, set **Primary storage** to the source %%cache|cache%% pool and **Secondary storage** to the %%array|array%%.
   - 将 **Mover操作** 设置为 **缓存 → 阵列**。
   - Note the shares you changed and their original settings.
2. In the **Main** tab, click **Move Now** and wait for completion. Ensure the %%cache|cache%% is empty.
   - If files remain, stop and check the forums for help.

#### Reformat the cache drive

让我们来详细解释每项操作的作用以及何时使用这些操作：

1. 停止%%array|array%%。
2. Set the cache drive format:
   - In the **Main** tab, click the cache drive.
   - Choose between %%XFS|xfs%%, EXT4, or %%BTRFS|btrfs%%.
   - For a single-drive %%cache|cache%%, %%XFS|xfs%% or EXT4 are recommended.
   - Note that %%XFS|xfs%% and EXT4 are only available with one %%cache|cache%% slot.
3. 启动 %%array|array%%。
4. Format the cache drive:
   - Confirm only the %%cache|cache%% drive is listed as unmountable.
   - Check the confirmation box and click **Format**.

#### Restore data and settings

还原数据和设置：

1. For each share you changed, set **Primary storage** and **Secondary storage** back to their original values.
2. Move data back (array → cache):
   - For each share you changed, set **Primary storage** to the destination %%cache|cache%% pool and **Secondary storage** to the %%array|array%%.
   - 将 **Mover 动作** 设置为 **array → cache**。
   - In the **Main** tab, click **Move Now** to move data back to the %%cache|cache%%.
3. 停止%%array|array%%。
4. Go to **Settings** and re-enable Docker and %%VM|vm%% services.
5. Start the %%array|array%% to complete the process.

:::note\[Timing]

使用 %%Mover|mover%% 移动数据和格式化驱动器所需时间可能从几分钟到几小时不等，具体取决于数据量和驱动器速度。

:::

---

## BTRFS 操作

在 Unraid 中维护您的 %%BTRFS|btrfs%% 池对于保持其正常运行和确保您的数据安全至关重要。您需要定期使用的两个关键工具是 **平衡** 和 **清理**。这些操作有助于解决空间分配问题，优化存储利用率，并保护数据免受隐藏损坏的影响。

Let's break down what each operation does and when to use them:

### 平衡

The **Balance** operation redistributes data and metadata chunks across your %%BTRFS|btrfs%% pool. This process helps free up space, resolves allocation issues, and can fix "no space left on device" errors even when space seems available.

#### 何时运行平衡

- When you encounter "no space left on device" errors but have free space.
- 在池中添加或移除驱动器后。
- 优化空间使用并提升性能。

#### 如何运行平衡

1. In the %%WebGUI|web-gui%%, click the pool in the **Main** tab and select **Balance**.
2. (Optional) Add parameters for advanced use (refer to Unraid Help for details).
3. Click **Start** to begin.

:::note\[Timing]

平衡操作可能需要几分钟到几小时，具体取决于池的大小和数据量。

:::

### 校验

The **Scrub** operation reads all data and metadata, checks the integrity of checksums, and repairs any corrupt blocks using available redundant copies. Scrubbing helps identify and fix silent data corruption, known as "bit rot," before it becomes a significant issue.

#### 何时运行清洗

- 作为常规维护的一部分（请参阅下面的推荐计划）。
- 在不正常关机后或如果您怀疑有损坏时。
- 在高使用率池中更频繁地运行。

#### 推荐计划

- 高使用率池： **每周一次**
- 所有其他池： **每月一次**

#### 如何运行清洗

1. In the %%WebGUI|web-gui%%, click the pool in the **Main** tab and select **Scrub**.
2. Click **Start** to initiate.

:::note\[Timing]

擦洗操作通常比完全磁盘扫描快，因为它们只会检查已分配的数据。根据池大小和使用情况，这可能需要几分钟到几小时。

:::

:::tip

**平衡** 和 **清理** 都可以在系统在线时进行，但请记住，在这些操作期间性能可能会受到影响。您可以在 %%WebGUI|web-gui%% 中监控进度。

:::

有关高级 %%BTRFS|btrfs%% 功能的更多详细信息，请查阅 [官方 BTRFS 文档](https://btrfs.readthedocs.io/en/latest/Introduction.html)。

---

## 故障排除

Unassigned drives are storage devices connected to your Unraid server that aren't part of the main %%array|array%% or any %%cache pool|cache-pool%%. You can use these drives to transfer files, create backups, or provide fast storage for %%virtual machines|vm%%.

:::note

All drives connected to your server when the %%array|array%% starts count toward your Unraid Attached Devices license limit, even if they aren't assigned to the %%array|array%% or a pool.

:::

### 未分配驱动器的常见用途

- **识别情况**：确定这是新驱动器还是先前工作的驱动器。
- **对于新驱动器**：格式化驱动器以创建一个新的文件系统（查看 [格式化步骤](#creating-a-file-system-formatting)）。

### 使用未分配设备插件

修复文件系统通常比重建驱动器所需时间更短，让您可以不丢失任何数据地访问它。请记住，重建驱动器**无法**修复文件系统问题；它仅确保物理驱动器与模拟驱动器相匹配，且将现有问题一同保留。

- \*\*[未分配设备](https://unraid.net/community/apps?q=dlandon\&r=0#:~:text=and%20iso%20files.-,Unassigned%20Devices,-dlandon)：\*\*此插件允许您挂载、共享和管理具有 Unraid 支持的文件系统（如 %%XFS|xfs%%、%%BTRFS|btrfs%% 或 NTFS）的驱动器。

- \*\*[未分配设备Plus](https://unraid.net/community/apps?q=dlandon\&r=0#:~:text=and%20iso%20files.-,Unassigned%20Devices%20Plus,-\(Addon\))：\*\*此扩展支持额外的文件系统，包括 ExFAT 和 HFS+。

如果您不确定：

- 使用 Unraid 网页界面轻松挂载和卸载驱动器。
- 如需专家帮助，请将您的问题连同诊断信息一起发布于 [Unraid 论坛](https://forums.unraid.net/)。
  :::
- 在服务器启动时自动挂载。
- 格式化或擦除驱动器以备将来使用。
- 安全地断开 USB 或外部驱动器而不产生麻烦。

有关插件安装和管理的详细信息，请查阅 [插件](../customize-your-experience/plugins.mdx)。

---

## 故障排除

### 检查文件系统

如果您在 Unraid 中看到驱动器为**无法挂载**，可能是由于两个主要原因之一：

1. If you just added a new drive to your setup, it will show as unmountable until you format it. Formatting creates a file system that allows the drive to store files. You can find the steps to format a drive [here](#creating-a-file-system-formatting).

2. If a drive that was previously working suddenly shows as unmountable, it likely has a file system issue. This can happen due to unexpected shutdowns, problems while writing data, or if the drive has been marked as disabled (which appears as a red 'x' in the %%WebGUI|web-gui%%).

:::important

Do not format an unmountable drive unless you are okay with losing all the data on it. Formatting will erase everything and update the %%parity|parity%% information, making recovery impossible. Always try to fix the file system first.

:::

如果您的驱动器无法挂载：

1. Determine if it's a new drive or a previously working drive.
2. For new drives: Format the drive to create a new file system (see [formatting steps](#creating-a-file-system-formatting)).
3. For previously working drives: Perform a file system check or repair (see [Checking a file system](#checking-a-file-system)). Avoid formatting if you want to keep the data.

:::note

如果驱动器既不可挂载又被禁用（红色“x”），首先对**模拟**驱动器运行文件系统检查/修复。如果模拟驱动器也不可挂载并尝试重建，新驱动器也将不可挂载。

:::

修复文件系统通常比重建驱动器所需时间更短，让您可以不丢失任何数据地访问它。请记住，重建驱动器**无法**修复文件系统问题；它仅确保物理驱动器与模拟驱动器相匹配，且将现有问题一同保留。

:::important[Why 奇偶校验不足够吗？]

While %%parity|parity%% helps recover a failed drive, it cannot fix file system problems. If the file system is corrupted, %%parity|parity%% will simply replicate that corruption to the new drive.

如果您不确定：

- 通过导航到 ***工具 → 诊断*** 来下载系统日志。
- 如需专家帮助，请将您的问题连同诊断信息一起发布于 [Unraid 论坛](https://forums.unraid.net/)。

:::

:::note[Just 重申一下]

- 仅当他们是全新的或想要擦除所有数据时，才格式化无法挂载的驱动器。
- 使用文件系统检查/修复来解决损坏文件问题；不要依靠 %%parity|parity%% 来解决这些问题。
- 对于有多个驱动器的 %%cache pools|cache-pool%%，可以考虑使用 %%BTRFS|btrfs%% 或 %%ZFS|zfs%%。
- 在格式化或修复驱动器之前，请再次检查以避免意外的数据丢失。

:::

---

### 检查文件系统

如果之前正常挂载的磁盘现在显示为**不可挂载**，这通常表示文件系统损坏。这可能由未清洁的关机、失败的写操作或磁盘在 %%WebGUI|web-gui%% 中被标记为禁用所导致。检查和修复文件系统通常比执行重建更快更安全，因此建议在格式化或重建磁盘之前尝试此操作。

:::important

If the %%WebGUI|web-gui%% suggests formatting an unmountable drive, **do not format** unless you intend to erase all data. Formatting will destroy the contents of the drive and update %%parity|parity%%, making recovery impossible.

:::

#### 准备检查或修复

1. Identify the file system type:
   - In the **Main** tab, select your disk (e.g., Disk 3, Cache).
   - Find the **File system type** (should be %%XFS|xfs%%, EXT4, %%BTRFS|btrfs%%, or %%ZFS|zfs%%).

2. 以正确模式启动阵列:
   - For **%%XFS|xfs%%** or **EXT4**, start the %%array|array%% in **%%Maintenance Mode|maintenance-mode%%**.
   - 对于 **%%BTRFS|btrfs%% **，请在**正常模式**下启动 %%array|array%% 进行 %%scrub|scrub%% ，或在\*\* %%维护模式|maintenance-mode%% \*\*下进行修复。
   - 对于 **%%ZFS|zfs%%** ，请参考下方的 %%ZFS|zfs%% 内容。

3. If the disk is disabled and being emulated, run the check/repair on the %%emulated disk|emulated-disk%% before attempting a rebuild. If the %%emulated disk|emulated-disk%% is unmountable, the rebuilt disk will also be unmountable.

#### 常见错误消息

| 消息                          | 意义/行动             |
| --------------------------- | ----------------- |
| **超级块有错误的幻数**               | 严重腐败；尝试文件系统修复。    |
| **文件系统脏**                   | 未清关闭；执行文件系统检查。    |
| **元数据损坏检测**                 | 文件系统结构损坏；开始修复。    |
| **未找到有效的 %%BTRFS\|btrfs%%** | 磁盘可能不属于有效池；检查池分配。 |
| **挂载：错误的文件系统类型、错误的选项等**     | 文件系统选择错误或磁盘未格式化。  |
| **无法挂载 /dev/mdX：结构需要清理**    | 文件系统已损坏；执行修复。     |

#### Checking via the WebGUI

1. Start the %%array|array%% in the correct mode (refer to the steps above).
2. In the **Main** tab, select the disk you wish to check.
3. Scroll to **Check Filesystem Status**.
4. For XFS: You will see a **CHECK** button without any options to enter. The system automatically determines the necessary actions based on the check results.
5. For other file systems: Enter any necessary options (for details, see **Help** in the upper right).
6. Click **Check** to initiate the process.
7. Monitor progress in the output box. Use **Refresh** if required.
8. Review results. If uncertain, copy the output and post it on the [forums](https://forums.unraid.net/) for advice.

#### XFS automatic repair workflow

XFS file system repair is fully automated through the WebGUI:

1. Click the **CHECK** button (no options to enter)
2. Check results:
   - **未检测到损坏**：显示“未检测到文件系统损坏”，**CHECK** 按钮保持不变
   - **检测到损坏**：显示“检测到文件系统损坏”，出现 **FIX** 按钮
3. Click **FIX** to automatically repair the file system
4. If needed, a **ZERO LOG** button may appear
5. Shows "filesystem repaired" when the process is complete

此自动系统消除了用户手动输入修复选项的需求，并确保了正确的修复顺序。

#### Checking via the command line

<Tabs>
  <TabItem value="xfs" label="XFS">
    <FsCheckCliXfs />
  </TabItem>

  <TabItem value="btrfs" label="BTRFS">
    <FsCheckCliBtrfs />
  </TabItem>

  <TabItem value="zfs" label="ZFS">
    <FsCheckCliZfs />
  </TabItem>
</Tabs>

:::tip

- 文件系统修复通常比完整重建更快，并能在不丢失数据的情况下恢复访问。
- 重建磁盘并 **不会** 解决文件系统损坏；请始终先运行检查或修复。
- 如果您有疑问，请在 Unraid [论坛](https://forums.unraid.net/) 上发布您的诊断和错误信息以获取专家协助。

:::

---

### 修复文件系统

如果文件系统检查发现错误，您可能需要进行修复才能再次访问数据。修复通常比完全重建所需的时间少，但重要的是仔细阅读输出，并在不确定任何问题时在 [论坛](https://forums.unraid.net/) 上寻求帮助。

:::note\[Timing]

修复可能需要从几分钟到几个小时，尤其是对于更大或严重受损的文件系统。进度可能看起来很慢，但您可以通过查看主页上的读/写统计来查看活动。

:::

#### 准备进行修复

1. In the **Main** tab, click the disk and identify the file system type (%%XFS|xfs%%, EXT4, %%BTRFS|btrfs%%, or %%ZFS|zfs%%).

2. 以正确模式启动阵列:

   - **For %%XFS|xfs%% or EXT4:** Use **%%Maintenance Mode|maintenance-mode%%**.
   - **对于 %%BTRFS|btrfs%%:** 为 %%scrub|scrub%% 使用 **正常模式**；为修复使用 **%%维护模式|maintenance-mode%%**。
   - **For %%ZFS|zfs%%:** Use **Normal mode** and run a %%scrub|scrub%% to check for errors. See the [ZFS storage page](../../advanced-configurations/optimize-storage/zfs-storage.mdx) for guidance on %%ZFS|zfs%% pool maintenance and repair procedures.

3. If the disk is disabled and being emulated, run the repair on the %%emulated disk|emulated-disk%% before trying to do a rebuild.

#### Repairing via the WebGUI

1. Start the %%array|array%% in the correct mode (refer to the section above).
2. In the **Main** tab, click the disk you want to repair.
3. Scroll down to **Check Filesystem Status**.
4. For XFS: The repair process is fully automated. Click **CHECK**, then **FIX** if corruption is detected, and **ZERO LOG** if prompted.
5. For other file systems: Remove any options that would run the process in check-only mode (like `--readonly` for %%BTRFS|btrfs%%).
6. If prompted, add the suggested options as indicated in the check output.
7. Click **Check** to begin the repair.
8. Monitor progress in the output box. Use **Refresh** if needed.
9. If you notice a `lost+found` folder after the repair, it may contain files or folders that couldn't be fully recovered. Use backups or the Linux `file` command to identify the contents if necessary.

:::info

如果对输出不确定，将其复制并分享至 [Unraid 论坛](https://forums.unraid.net/) 寻求专家帮助。使用代码格式选项以保持可读性。

:::

#### Repairing via the command line

<Tabs>
  <TabItem value="xfs" label="XFS">
    <FsRepairCliXfs />
  </TabItem>

  <TabItem value="btrfs" label="BTRFS">
    <FsRepairCliBtrfs />
  </TabItem>

  <TabItem value="zfs" label="ZFS">
    <FsRepairCliZfs />
  </TabItem>
</Tabs>

:::info[After 修复]

- Stop and restart the %%array|array%% in **Normal mode**.
- 驱动器现在应挂载并可访问。
- 如果您看到一个 `lost+found` 文件夹，请检查其内容是否有重要文件。

:::

如果您不理解修复输出或过程失败，请在 [Unraid 论坛](https://forums.unraid.net/) 上分享您的诊断和修复日志以获得进一步的帮助。
