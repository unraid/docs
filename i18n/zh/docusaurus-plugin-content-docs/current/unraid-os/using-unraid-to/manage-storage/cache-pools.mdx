---
sidebar_position: 3
sidebar_label: 缓存池
---

import RemoveDiskGui from './partials/remove-disk-gui.mdx';
import RemoveDiskCommandLine from './partials/remove-disk-command-line.mdx';
import PoolSingleDeviceMode from './partials/pool-single-device-mode.mdx';
import PoolMultiDeviceMode from './partials/pool-multi-device-mode.mdx';
import MovePoolToArray from './partials/move-pool-to-array.mdx';
import MoveArrayToPool from './partials/move-array-to-pool.mdx';
import MoveBetweenPoolsUsingMover from './partials/move-between-pools-using-mover.mdx';
import MoveBetweenPoolsManual from './partials/move-between-pools-manual.mdx';

# 缓存池

In Unraid, a %%cache pool|cache-pool%% is a collection of one or more drives, typically SSDs or high-speed HDDs. These drives temporarily store data before it's moved to your main [%%array|array%%](./array/overview.mdx). Using %%cache pools|cache-pool%% can significantly enhance write speeds, protect your data, and provide dedicated storage for specific tasks like running Docker containers or [%%virtual machines|vm%%](../create-virtual-machines/overview-and-system-prep.mdx).

%%Cache pools|cache-pool%% offer several advantages, making them a valuable addition to your Unraid setup, such as:

1. **Faster write speeds:** %%Cache pools|cache-pool%% allow you to quickly write data to faster drives before it gets transferred to the main %%array|array%%. This greatly enhances perceived performance when saving files.

2. **Data protection for cached files:** By using multiple drives in a %%cache pool|cache-pool%% (like setting them up in %%RAID 1|raid1%%), you add redundancy. This means your cached data is protected from drive failure before it even reaches the main %%array|array%%.

3. **为应用程序优化存储：** 将 Docker 容器或 %%虚拟机|vm%% 存储在 %%cache pool|cache-pool%% 上可以提高其性能，减少对主 %%array|array%% 的磨损，并最大限度地缩短访问频繁使用文件的时间。

4. **Flexible and dedicated storage:** With multiple %%cache pools|cache-pool%%, you can assign specific pools for different tasks. For instance, you could have one pool dedicated to downloads and another for %%virtual machines|vm%%, reducing competition for resources and boosting efficiency.

:::info[Keep 铭记在心]

- **多个池：** 您可以创建并命名不同的 %%cache pool|cache-pool%%，以便根据您的具体需要进行调整。
- **SSD 与 HDD：** SSD 适合于速度，而 HDD 可用于大型顺序数据处理。此外，HDD 可以延长 SSD 的使用寿命。
- **Redundancy matters:** To protect your data, use more than one drive in a %%cache pool|cache-pool%%. A single drive pool won't protect you from potential drive failure.
- **File system choice:** The default file system for %%cache pools|cache-pool%% is %%BTRFS|btrfs%%, which supports various %%RAID|raid%% options for added redundancy and flexibility. For more details on file system selection, see [File systems](./file-systems.mdx).
- **%%Mover|mover%% integration:** Data written to a %%cache pool|cache-pool%% is automatically transferred to your main %%array|array%% based on a schedule you set. This keeps your [%%user shares|user-share%%](./shares.mdx) organized and easy to manage.
- **应用程序性能：** 通过将 Docker 容器、应用程序数据和 %%VM|vm%% 磁盘放在 %%cache pool|cache-pool%% 上，您可以提升访问速度，并最大限度地减少对主存储的压力。
  :::

:::

---

## 池模式

Unraid %%cache pools|cache-pool%% can operate in two main modes: **single device mode** and **multi-device mode**. Knowing the difference between these modes will help you find the right balance between performance, flexibility, and data protection for your needs.

### 单设备模式

<PoolSingleDeviceMode />

### 多设备模式

<PoolMultiDeviceMode />

%%cache pool|cache-pool%% 的常见任务包括：

- 在单设备和多设备模式间切换
- 向池中添加磁盘
- 更换池中的磁盘
- Moving files between the pool and the %%array|array%% (see [Moving files between a pool and the array](#moving-files-between-a-pool-and-the-array))

---

## 向多设备池中添加磁盘

%%Cache pools|cache-pool%% in Unraid can be expanded from a single device to multiple devices, allowing for increased capacity and redundancy. To take advantage of multi-device mode, your pool must be formatted as %%BTRFS|btrfs%% or %%ZFS|zfs%%.

### 将池转换为 BTRFS 或 ZFS

If your %%cache pool|cache-pool%% isn't already formatted as %%BTRFS|btrfs%% or %%ZFS|zfs%%, you can convert it using the following steps.

To convert a pool to BTRFS or ZFS:

1. Back up important content. See [Moving files between a pool and the array](#moving-files-between-a-pool-and-the-array) to move files from your pool to the %%array|array%%.
2. 停止%%array|array%%。
3. In the **Main** tab, click the pool and select **BTRFS** or **ZFS** as the file system format.
4. 启动 %%array|array%%。
5. When the pool shows as **unmountable**, confirm and click **Format**.
6. After formatting, you’ll have a %%BTRFS|btrfs%% or %%ZFS|zfs%% pool (single device at this stage).
7. (Optional) Add additional drives as needed.
8. Restore your data by moving files back to the pool.

### 向多设备池中添加磁盘

一旦您的池格式化为 %%BTRFS|btrfs%% 或 %%ZFS|zfs%%，您可以添加更多驱动器以增加冗余和扩展存储。

随着您的存储需求增长，您可能希望通过添加额外的硬盘来扩展您的缓存池。此过程使您能够在提高容量和性能的同时，通过 RAID 配置保持数据保护。

1. 停止%%array|array%%。
2. In the **Main** tab, assign one or more new devices to your pool.
3. 启动 %%array|array%%。
4. Unraid automatically incorporates the new devices and starts a **balance** (%%BTRFS|btrfs%%) or **resilver** (%%ZFS|zfs%%).
5. In the **Main** tab, click the first pool device and check **Balance Status** (%%BTRFS|btrfs%%) or **zpool status** (%%ZFS|zfs%%) to follow progress.
6. When complete, the pool operates in **multi-device mode** with enhanced capacity and redundancy.

:::tip

您可以使用 [BTRFS磁盘使用计算器](http://carfax.org.uk/btrfs-usage/) 估算根据您选择的`RAID`级别和设备尺寸的可用空间与冗余。

:::

---

## 向池中添加磁盘

随着您的存储需求增长，您可能希望通过添加额外的硬盘来扩展您的缓存池。此过程使您能够在提高容量和性能的同时，通过 RAID 配置保持数据保护。

:::note

If you want to add disks to your pool, make sure your pool is already formatted as %%BTRFS|btrfs%% or %%ZFS|zfs%%. If it's not, you'll need to format it first, as explained in [Converting a pool to BTRFS or ZFS](#converting-a-pool-to-btrfs-or-zfs).

:::

向池中添加磁盘的方法:

1. 停止%%array|array%%。
2. In the **Main** tab, open the pool.
3. In the Pool Devices section, set **Slots** to the exact number of additional devices.
4. Assign the new devices to the available slots.
5. Start the %%array|array%% to enable the changes.

---

## 从池中移除磁盘

Removing a disk from a %%BTRFS|btrfs%% or %%ZFS|zfs%% multi-device %%cache pool|cache-pool%% can help you reclaim hardware, replace a failing drive, or reconfigure your storage. This process is only possible if your pool is set up for redundancy (like %%RAID 1|raid1%% for both data and metadata) and the remaining devices have enough space to hold all of your data.

### 通过 WebGUI

<RemoveDiskGui />

### Using the command line (Advanced)

<RemoveDiskCommandLine />

### 改变池的 RAID 级别

%%BTRFS|btrfs%% provides the ability to change %%RAID|raid%% levels for %%cache pools|cache-pool%% dynamically, allowing you to adjust settings without stopping the %%array|array%% or losing any data. This flexibility lets you optimize for performance, redundancy, or storage efficiency as your requirements change.

<h4>支持的 %%RAID|raid%% 级别</h4>

| %%RAID\|raid%% 级别   | 数据保护        | 空间效率   | 使用场景                                                  |
| ------------------- | ----------- | ------ | ----------------------------------------------------- |
| 单个                  | 无           | 100%   | 用于临时存储或不需要冗余的非关键数据。                                   |
| %%RAID 0\|raid0%%   | 无           | 100%   | 最大化性能和容量，但不建议用于关键数据。                                  |
| RAID 1\|raid1       | 可承受 1 个磁盘故障 | 50%    | Unraid 池的默认值。非常适合 Docker/VM 存储和关键数据。                  |
| %%RAID 10\|raid10%% | 可承受 1 个磁盘故障 | 50%    | 结合了%%RAID 0\|raid0%%的速度和%%RAID 1\|raid1%%的冗余以满足高性能需求。 |
| %%RAID 5\|raid5%%\* | 可承受 1 个磁盘故障 | 67-94% | **实验性。** 适用于大规模媒体存储的容量和冗余的平衡。                         |
| %%RAID 6\|raid6%%\* | 可承受 2 个磁盘故障 | 50-88% | **实验性。** 为大容量硬盘提供额外的归档存储保护。                           |

:::important

%%RAID 5|raid5%% and %%RAID 6|raid6%% are considered experimental in %%BTRFS|btrfs%%. %%ZFS|zfs%% provides more mature support for these %%RAID|raid%% levels. Use with caution and ensure you have backups. Avoid using experimental %%RAID|raid%% levels for critical data.

:::

更改池的 %%RAID|raid%% 级别：

1. Start the %%array|array%% in normal mode.
2. In the **Main** tab, click the pool name.
3. Scroll to **Balance Status** to view current %%RAID|raid%% levels for data and metadata.
4. Select the new %%RAID|raid%% profile from the drop-down.
5. Click **Balance** to begin the conversion.

<div style={{ margin: 'auto', maxWidth: '600px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
  ![从%%RAID 1|raid1%%转换到单一配置文件](/img/Btrfs-raid1.jpg)
  <p class="caption-center">*示例：从%%RAID 1|raid1%%转换到单一配置文件*</p>
</div>

6. Monitor progress in the %%WebGUI|web-gui%%.

:::note\[Timing]

Balance operations can take several hours to days, depending on the amount of data in the pool, drive speeds, and the complexity of the selected %%RAID|raid%% level.

:::

<details>
  <summary>如果平衡操作卡住，进行故障排除 - 点击以展开/折叠</summary>

  如果平衡操作似乎卡住或没有响应，请按照这些步骤进行：

  1. In ***Tools → Logs***, filter for `btrfs` entries.
  2. Stop and resume the operation:
     - 点击 **取消均衡**。
     - 重启 %%array|array%%。
     - 再次启动均衡操作。
  3. Run %%SMART|smart%% tests on all devices in the pool. For more information on disk health monitoring, see [SMART reports and disk health](../../system-administration/monitor-performance/smart-reports-and-disk-health.mdx).
  4. Ensure there is at least 10-15% free space available on the pool.
  5. If issues persist, share the logs on the [Unraid forums](https://forums.unraid.net/). For guidance on capturing diagnostics, see [Capture diagnostics and logs](../../troubleshooting/diagnostics/capture-diagnostics-and-logs.mdx).
</details>

有关高级 %%BTRFS|btrfs%% 配置的详细信息，请参阅 [BTRFS wiki](https://btrfs.wiki.kernel.org/index.php/Using_Btrfs_with_Multiple_Devices)。

---

## 缓存池的最低空闲空间

在 %%cache pool|cache-pool%% 中更换磁盘是一项重要任务，有助于保持存储系统的性能和可靠性。

:::note\[Prerequisites]

- **Check your pool configuration:** Make sure your pool is set up with a redundant %%RAID|raid%% profile, like %%RAID 1|raid1%%. You can do this by going to ***Main → Pool → Balance Status*** (for %%BTRFS|btrfs%%) or ZFS pool status (for %%ZFS|zfs%%) in your management interface.
- \*\*选择合适的替换磁盘：\*\*新磁盘的大小必须与您要替换的磁盘相同或更大。
- \*\*热插拔能力：\*\*如果您的硬件支持热插拔，您不需要关闭系统电源来更换磁盘。

:::

您可以通过点击 **主** 选项卡中的池名称并转到 **个人池设置** 来访问最低空闲空间。

1. In the **Main** tab, stop the %%array|array%% (Array Operation → **Stop**).
2. (Optional) If you don’t have hot-swap, physically remove the old disk.
3. Install the replacement disk and ensure proper connection.
4. Refresh the **Main** tab to detect the new disk.
5. Assign the new disk to the previous slot.
6. 启动 %%array|array%%。
7. Monitor the rebuild progress in the %%WebGUI|web-gui%%.

:::important\[Timing]

根据磁盘大小和系统当前负载情况，重建可能需要一些时间。例如，在 RAID 1 设置中重建一个 4TB 的 SSD 可能需要大约 3-6 小时。建议在可以让系统不受干扰的情况下进行计划。

:::

---

## 缓存池的最低空闲空间

Setting a minimum free space for your %%cache pool|cache-pool%% can provide better control over file placement, especially when dealing with large files like high-resolution videos. This setting helps Unraid know when to stop writing to the pool and start writing directly to the larger storage %%array|array%%, avoiding interruptions or data corruption.

:::tip\[Example]

如果您常常下载大约 10GB 的文件，则将最低空闲空间设置为至少 10GB，最好是 20GB 以便调整。

:::

您可以通过点击 **主** 选项卡中的池名称并转到 **个人池设置** 来访问最低空闲空间。

<h4>原理</h4>

- 当您将文件传输到包含池的共享时，Unraid 将遵循遇到的第一个最低空闲空间设置 (无论是共享的最低空闲空间还是池的最低空闲空间，哪个先达到) 。
- 最低可用空间设置告诉 Unraid，当可用空间降到此数量以下时，将停止使用 %%cache pool|cache-pool%%。
- 如果您的共享使用 %%cache pool|cache-pool%% 作为**主存储**，文件会进入池，直到达到最低可用空间，然后直接发送到 %%array|array%%。
- 如果设置为仅使用 %%cache pool|cache-pool%%（没有**次存储**），则不应用此设置。
- 如果设置为仅使用 %%array|array%% 作为 **主存储**，则文件将直接写入 %%array|array%%。

:::tip[Use case example]

媒体共享将地板设置为 20GB，这对于该共享中的文件来说是合适的。但是，如果您还在池中使用 VM 并希望留有缓冲空间以防虚拟磁盘增长，则可以将池地板设置为 50GB。这样，在池的空余空间少于 50GB 之后，对媒体共享的任何传输将直接转到阵列。

:::

:::tip[Best 实践]

将最小可用空间设置为您期望的最大文件大小，最好是该大小的两倍。例如，如果您的最大文件是 30 GB，要将最小可用空间设置为 60 GB。

:::

:::caution

When accessing a [%%user share|user-share%%](./shares.mdx) from multiple pools and %%array|array%% disks, Unraid merges the directory listings in this order:

:::

---

## 在池和数组之间移动文件

There are times when you may need to move files between your %%cache pool|cache-pool%% and the main %%array|array%%, such as when preparing for maintenance, upgrading hardware, or optimizing performance. This process is also useful for backing up your %%cache pool|cache-pool%% before making configuration changes or replacing drives. Unraid provides a built-in tool called %%Mover|mover%% to automate this process for [%%user shares|user-share%%](./shares.mdx).

:::tip

在使用 Mover 移动文件之前，务必禁用 Docker 和 VM 服务。这可以防止在传输过程中跳过打开的文件。

:::

### Move from pool to array

<MovePoolToArray />

### Move from array to pool

<MoveArrayToPool />

<details>
  <summary><strong>为什么文件有时会出现在错误的池或缓存中？</strong> - 点击展开/折叠</summary>

  When you move files between [%%user shares|user-share%%](./shares.mdx) at the Linux level (for example, using `mv` or within a Docker container), Linux tries to optimize the operation. If both the source and destination appear on the same mount point (`/mnt/user`), Linux might rename the file instead of moving it. This can result in files remaining on the original disk or pool, even if the share's "Use cache" setting is set to "No."

  为确保文件按预期移动，请考虑以下选项：

  - 使用 %%Mover|mover%% 工具。
  - 复制文件然后删除原件。
  - 通过网络移动文件。

  这些方法有助于防止文件出现在错误的位置。
</details>

---

## 多个存储池

Unraid 允许您创建和管理最多 35 个独立的存储池，每个池最多可容纳 60 个设备。多个池为您提供灵活性，可根据需要分配存储、提高性能和定制冗余。每个池可以使用不同的文件系统、RAID 级别和设备类型（SSD、HDD、NVMe 等）。

<h4>为何使用多个存储池？</h4>

- **优化性能：** 为 %%VMs|vm%%、Docker 容器、下载或媒体设置单独的存储池可以提高速度并减少冲突。
- **保护数据：** 为每个存储池分配不同的 %%RAID|raid%% 级别或文件系统，以实现定制化的冗余和备份选项。
- **隔离工作负载：** 将关键应用程序放在更快的冗余存储池中，将大容量数据存储在更具成本效益的设备上。
- **灵活管理：** 你可以独立地扩展、减少或格式化存储池而不影响其他池。

<h4>常见使用案例</h4>

| 使用场景              | 配置示例                                                                       | 好处         |
| ----------------- | -------------------------------------------------------------------------- | ---------- |
| 高性能 %%VMs\|vm%%   | NVMe SSD池，%%RAID 1\|raid1%%，%%BTRFS\|btrfs%% 或 %%ZFS\|zfs%%                | 快速 I/O 与冗余 |
| Docker/Appdata 存储 | SSD池，%%RAID 1\|raid1%%，%%BTRFS\|btrfs%% 或 %%ZFS\|zfs%%                     | 快速访问和数据保护  |
| 批量媒体下载            | Large HDD pool, %%RAID 0\|raid0%% or single, %%XFS\|xfs%%/%%BTRFS\|btrfs%% | 高容量但冗余较少   |
| 项目/团队隔离           | 为每个团队/项目设置单独的存储池                                                           | 减少资源冲突     |
| 快照和备份目标           | %%ZFS\|zfs%%池，%%RAIDZ1\|raidz1%%/%%RAIDZ2\|raidz2%%（多设备）                   | 支持原生快照和备份  |

:::info[Supported File Systems]

- %%BTRFS|btrfs%%: 适合多设备存储池（支持 %%RAID 0|raid0%%, %%RAID 1|raid1%%, %%RAID 10|raid10%%, %%RAID 5|raid5%%, %%RAID 6|raid6%%）。
- ZFS: 非常适合单一设备和多设备池（Unraid 6.12+），支持成熟的 RAIDZ1 和 RAIDZ2。有关高级 ZFS 功能和配置，请参见 [ZFS 存储](../../advanced-configurations/optimize-storage/zfs-storage.mdx)。
- %%XFS|xfs%%: 适合单设备存储池。

:::

When accessing a [%%user share|user-share%%](./shares.mdx) from multiple pools and %%array|array%% disks, Unraid merges the directory listings in this order:

1. 分配给共享的存储池
2. %%Array|array%% 磁盘（disk1、disk2、...、disk28）
3. 其他存储池（按顺序）

### 在存储池之间移动文件

Unraid 不允许通过 %%WebGUI|web-gui%% 直接在存储池间移动文件，但可以使用 %%Mover|mover%% 工具或通过命令行实现。

:::note\[Remember]

如果任何文件属于 Docker 容器和/或 VM ，必须禁用这些服务，以便文件可以成功移动。

:::

### 使用 Mover

<MoveBetweenPoolsUsingMover />

### 手动文件传输(高级)

<MoveBetweenPoolsManual />

:::warning

If you remove a device from a %%BTRFS|btrfs%% or %%ZFS|zfs%% pool and move it to a new pool, Unraid will erase all data on it when the %%array|array%% restarts. Always back up important data before changing pool configurations.

:::
