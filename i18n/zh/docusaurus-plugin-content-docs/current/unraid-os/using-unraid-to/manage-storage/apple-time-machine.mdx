---
sidebar_position: 5
sidebar_label: Apple Time Machine
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Apple Time Machine

Apple’s Time Machine is a backup tool that comes with every Mac. It makes it easy to protect your files, applications, and system settings by automatically backing them up. By connecting Time Machine to your Unraid server, you can store these backups securely on your own hardware. This setup not only gives you more control but also allows for easier scalability and added peace of mind.

::::note[macOS 兼容性]

要获得最佳效果，请确保您的 Mac 升级到与硬件兼容的最新版本 macOS。
:::注意[macOS Sequoia (15.x) 事项]
一些用户报告在 macOS Sequoia 上使用时间机器和网络共享时出现间歇性问题。如果您遇到备份失败，建议考虑使用 [时间机器 Docker 容器](https://unraid.net/community/apps?q=time+machine#r) 作为替代方案。
:::

:::

:::

## Creating a Time Machine share

:::caution[Before 开始]

1. Go to ***Settings → SMB*** under "Network Services."
2. Set **Enable %%SMB|samba%%** to **Yes** (you must stop the %%array|array%% to change this).
3. Set **Enhanced macOS interoperability** to **Yes**.

<div style={{ margin: 'auto', maxWidth: '600px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
  ![增强的 macOS 互操作性](/img/enhancedmacos.png)
</div>

:::

To create a Time Machine share:

1. In the %%WebGUI|web-gui%%, go to **Shares** and click **Add %%user share|user-share%%**.

2. Configure the following settings:

   | 设置                                  | 描述                                                                                                                                                                                                             |
   | ----------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | **%%User share\|user-share%% name** | 命名您的 %%user share\|user-share%%（例如，Time Machine）。                                                                                                                                                              |
   | **最小可用空间**                          | 设置为 **1**（1 KB）以获得最佳效果。这可以防止磁盘接近容量时 Time Machine 出错。                                                                                                                                                           |
   | **包含的磁盘**                           | 选择 %%array\|array%% 中的磁盘以用于 Time Machine %%user share\|user-share%%。                                                                                                                                           |
   | **启用写入时复制**                         | 保持 **自动** 以获得最佳性能。                                                                                                                                                                                             |
   | **%%SMB\|samba%% 导出**               | 设为 **是（时间机器）** 以启用时间机器支持。                                                                                                                                                                                      |
   | **时间机器卷大小**                         | Set to your desired maximum size, or leave unset. If not setting minimum free space to 1, apply the share first, then re-edit and set volume size to less than the calculated minimum free space that appears. |
   | **安全设置**                            | 根据需要配置 %%SMB\|samba%% 安全参数。                                                                                                                                                                                    |

3. Click **Apply** to create the %%user share|user-share%%.

For more details on creating and managing shares, see [User shares](./shares.mdx).

## Connect from macOS

To connect to your %%user share|user-share%% from your Mac:

1. In **Finder**, press **Command + K** to open the "Connect to Server" window.
2. Enter the %%SMB|samba%% address of your Unraid server. For example, use the format `smb://[server-ip]/[Time Machine share name]` and click **Connect**.
3. When prompted, input your Unraid username and password that has access to the share, then click **Connect**.
4. Open **System Settings** if you're using macOS Ventura 13.0 or later, or **System Preferences** if you're on macOS Monterey 12.x or earlier. Then navigate to **Time Machine**.
5. Click on **Select Disk** or **Add Backup Disk**, choose your Unraid Time Machine %%user share|user-share%%, and then click **Use Disk**.
6. (Optional) If you want to secure your backup with a password, enable **Encrypt backups**.
7. If prompted, confirm the connection and re-enter your Unraid %%root user|root-user%% credentials if needed.
8. Time Machine will start the initial backup automatically. Keep in mind that the first backup may take a while, but future backups will be faster since they are incremental.

:::tip
For more control over backup scheduling and options, consider using a third-party tool like [Time Machine Editor](https://tclementdev.com/timemachineeditor/).

<div style={{ margin: 'auto', maxWidth: '600px', display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
  ![时间机器编辑器](/img/TimeMachineEditor.png)
</div>

:::

## Multiple Time Machine setups

:::tip
For families or settings with multiple Macs, this method offers clear separation of backups, enhances security, and simplifies management.
:::

To create separate backups for different users or Macs on your Unraid server:

1. **Create unique Unraid %%root user|root-user%% accounts** for each person or Mac that will back up data. For example, users named `larry`, `curly`, and `moe`. This ensures that each user has their own identity and permissions.

2. **Create individual Time Machine %%user shares|user-share%%** for each user, naming them clearly to match the user, such as `tm-larry`, `tm-curly`, and `tm-moe`. Keeping shares separate helps with managing storage and access for each user.

3. **Assign appropriate user permissions** for each %%user share|user-share%%:
   - Set the %%user share|user-share%%'s %%SMB|samba%% security settings to ensure that only the corresponding user has access.
   - Confirm that only the intended user can read and write to their Time Machine %%user share|user-share%%.

4. **Configure Time Machine on each Mac** to connect to its designated %%user share|user-share%%:
   - On each Mac, connect to the Unraid server using the %%SMB|samba%% path for their specific %%user share|user-share%% (e.g., `smb://unraid-server/tm-larry`).
   - Follow the usual Time Machine setup steps to select the %%user share|user-share%% as the backup disk.

5. **Monitor and manage storage usage**:
   - You can optionally set volume size limits on each Time Machine %%user share|user-share%% to prevent one user from taking up too much space.
   - Regularly check usage and adjust quotas as necessary.

For more information on user management and security, see [User management](../../system-administration/secure-your-server/user-management.mdx).

## 故障排除

If Time Machine backups fail or become unreliable:

1. **Try the Time Machine Docker container**: [Available through Community Applications](https://unraid.net/community/apps?q=time+machine#r), this option can provide more stable backups than direct %%SMB|samba%% %%user shares|user-share%%.
2. **Check macOS firewall**: Temporarily disable the firewall to see if it’s blocking connections.
3. **Create a fresh backup destination**: Delete and recreate the Time Machine %%user share|user-share%% if issues continue.

For additional troubleshooting help, see [Troubleshooting](../../troubleshooting/troubleshooting.mdx) or visit the [Unraid forums](https://forums.unraid.net/).
