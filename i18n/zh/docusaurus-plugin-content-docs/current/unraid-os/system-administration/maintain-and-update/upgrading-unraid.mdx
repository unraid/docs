---
sidebar_position: 2
sidebar_label: 升级 Unraid
---

import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";
import UpgradeModern from "./partials/upgrade-modern.mdx";
import UpgradeLegacy611612 from "./partials/upgrade-legacy-611-612.mdx";
import ManualDowngradeSimplest from "./partials/manual-downgrade-simplest.mdx";
import ManualDowngradeCommandLine from "./partials/manual-downgrade-command-line.mdx";

# 升级 Unraid

升级 Unraid OS 可确保您获得最新功能、安全更新和硬件支持。本页概述了标准升级过程，提供了疑难解答技巧和手动升级选项。

:::note\[Prerequisites]

在开始升级之前，请确保完整备份您的USB闪存设备。有关更多详细信息，请参阅[备份闪存设备](../maintain-and-update/changing-the-flash-device.mdx#backing-up-your-flash-device)。

:::

:::tip[Best 升级前的实践]

1. **备份**您的闪存驱动器和任何重要数据。
2. **阅读您计划安装版本的发布说明**。
3. **将所有插件更新**至最新版本。
4. **可选步骤，停止阵列**后再进行。
5. 在 ***工具 → 更新操作系统*** 页面上**更新 Unraid OS**。
6. 重启服务器以完成升级。

:::

## 标准升级流程

<Tabs>
  <TabItem value="modern-7x" label="Unraid 7.x及更高版本" default>
    <UpgradeModern />
  </TabItem>

  <TabItem value="legacy-611-612" label="Unraid 6.11到6.12">
    <UpgradeLegacy611612 />
  </TabItem>
</Tabs>

:::caution[ZFS 存储池升级警告]

When upgrading to Unraid 7.x, you may see warnings about [%%ZFS|zfs%%](../../advanced-configurations/optimize-storage/zfs-storage.mdx) pool feature upgrades during boot or in the %%WebGUI|web-gui%%. These warnings are not a sign of a problem; they simply indicate that your %%ZFS|zfs%% pool is using features from an older version of ZFS.

升级您的池并不紧急，但如果您决定升级，请注意它可能无法与以前的 Unraid 版本一起使用。这意味着进行升级后，您可能无法返回到以前的 Unraid 版本。

如以往一样，升级您的%%ZFS|zfs%%池之前，请记得备份数据。

:::

---

## 排查升级问题

如果升级后遇到问题，请查看下面相关部分获取帮助。

<details>
  <summary><strong>升级后 Docker 容器无法正常工作</strong> - 点击以展开/收起</summary>

  如果您遇到类似 "layers from manifest don't match image configuration" 的错误，您可能需要重新构建您的 Docker 镜像文件。以下是方法：
</details>

<details>
  <summary><strong>VMs 显示“无法获取接口 MTU”或网络错误</strong> - 点击以展开/收起</summary>

  If you have %%OVMF|ovmf%%-based %%VMs|vm%% created in older Unraid versions, you might encounter an EFI shell. You can boot the %%VM|vm%% by entering the following commands:

  1. 键入 `fs0:`。
  2. 然后键入 `cd efi/boot`。
  3. 最后，键入 `bootx64.efi`。
  4. 导航到 **应用** 标签页，选择 **先前的应用**，勾选要重新安装的应用并点击 **安装 xx 应用**。
</details>

<details>
  <summary><strong>VNC 无法访问或速度慢</strong> - 点击以展开/收起</summary>

  为了解决此问题，在 %%WebGUI|web-gui%% 中编辑 %%VM|vm%%，然后在不进行任何修改的情况下点击 **Apply**。此操作将更新机器类型为最新支持版本。

  1. 前往 **VMs** 标签页并编辑每个 %%VM%%（确保启用 **高级视图**）。
  2. 将网络桥接设置为 `br0` 并点击 **应用**。
  3. 前往 ***设置 → VM 管理器***（在 **高级视图** 中）并将默认桥接设置为 `br0`。
</details>

<details>
  <summary><strong>VM 无法启动（出现 EFI shell）</strong> - 点击以展开/收起</summary>

  If you have %%OVMF|ovmf%%-based %%VMs|vm%% created in older Unraid versions, you might encounter an EFI shell. You can boot the %%VM|vm%% by entering the following commands:

  1. 在 **VMs** 标签页编辑 %%VM%%（选择 **高级视图**）。
  2. 将 **VNC 视频驱动程序** 设置为 **QXL**（推荐）。如果 QXL 不成功，可以尝试 **Cirrus** 或 **vmvga**。
  3. 点击 **应用** 以保存更改。
</details>

<details>
  <summary><strong>VMs 显示“无法获取接口 MTU”或网络错误</strong> - 点击以展开/收起</summary>

  If you have %%OVMF|ovmf%%-based %%VMs|vm%% created in older Unraid versions, you might encounter an EFI shell. You can boot the %%VM|vm%% by entering the following commands:

  1. 键入 `fs0:`。
  2. 然后键入 `cd efi/boot`。
  3. 最后，键入 `bootx64.efi`。

  如果 `fs0:` 不起作用，您可以尝试 `fs1:`。如果问题仍然存在，请访问 [Unraid 论坛](https://forums.unraid.net/) 寻求帮助。
</details>

<details>
  <summary><strong>VNC 无法访问或速度慢</strong> - 点击以展开/收起</summary>

  为了解决此问题，在 %%WebGUI|web-gui%% 中编辑 %%VM|vm%%，然后在不进行任何修改的情况下点击 **Apply**。此操作将更新机器类型为最新支持版本。
</details>

<details>
  <summary><strong>VM 无法启动（出现 EFI shell）</strong> - 点击以展开/收起</summary>

  If you have %%OVMF|ovmf%%-based %%VMs|vm%% created in older Unraid versions, you might encounter an EFI shell. You can boot the %%VM|vm%% by entering the following commands:
</details>

---

## 手动降级

手动降级很少必要，但在您无法访问%%WebGUI|web-gui%%或需要返回到先前版本时可能需要。在继续之前，请备份您的USB闪存设备，详细信息可查看[备份您的闪存设备](../maintain-and-update/changing-the-flash-device.mdx#backing-up-your-flash-device)。

只有在无法访问 %%WebGUI|web-gui%% 的情况下才使用这些方法：

<Tabs>
  <TabItem value="最简单的方法" label="最简单的方法">
    <ManualDowngradeSimplest />
  </TabItem>

  <TabItem value="命令行方法" label="命令行方法">
    <ManualDowngradeCommandLine />
  </TabItem>
</Tabs>

:::info[What 降级过程中的]]

使用降级OS工具（WebGUI）时，工具将自动处理以下操作：

1. **系统验证**：检查降级操作是否安全。
2. **文件备份**：将创建当前系统文件的备份。
3. **版本验证**：工具确保目标版本的文件是有效且完整的。
4. **文件替换**：它将使用旧版本的文件替换当前的OS文件。
5. **配置保留**：您的当前设置将被保留。
6. **系统准备**：系统将为旧版本做好准备。
7. **重启安排**：将安排一次重启以完成降级。

:::

#### 降级后的验证

降级完成并重启服务器后：

1. **Check the version**: Verify that you're running the version of Unraid you expect.
2. **测试核心功能**：确保%%array|array%%、Docker和VM服务正常工作。
3. **检查插件**：确认已安装的插件兼容且正常运行。
4. **测试Docker容器**：启动您的Docker容器，并确认其正常运行。
5. **检查VMs**：如果您有任何虚拟机（VMs），确保它们正确启动和运行。查看[VM设置](../../using-unraid-to/create-virtual-machines/vm-setup.mdx)以获取配置指南。
6. **监控系统日志**：关注系统日志中的错误信息。使用[诊断工具](../../troubleshooting/diagnostics/capture-diagnostics-and-logs.mdx)获取详细的系统信息。

#### 故障排除降级问题

<details>
  <summary><strong>降级选项不可用</strong> - 单击展开/折叠</summary>

  如果您没有看到降级选项：

  - **检查系统历史记录**：确保您以前从兼容版本升级过。
  - **验证文件完整性**：以前版本的文件可能已损坏或丢失。
  - **检查兼容性**：较早的版本可能与您的当前硬件不兼容。
  - **手动方法**：如有需要，请按照本页上列出的手动降级方法进行操作。
</details>

<details>
  <summary><strong>降级过程中失败</strong> - 单击展开/折叠</summary>

  如果降级过程未按计划进行：

  1. **不要慌张**：您的系统应仍然可用当前版本工作。
  2. **检查日志**：查看系统日志以找到特定错误信息。使用[诊断工具](../../troubleshooting/diagnostics/capture-diagnostics-and-logs.mdx)进行综合日志分析。
  3. **验证文件**：确保目标版本的所有必需文件可用。
  4. **尝试手动方法**：如果工具无效，考虑使用手动降级方法。
  5. **Contact support**: If problems continue, reach out to Unraid support with your diagnostics.
</details>

<details>
  <summary><strong>系统在降级后无法启动</strong> - 单击展开/折叠</summary>

  如果系统在降级后无法启动：

  1. **从USB启动**：使用另一台计算机访问您的USB闪存设备。查看[启动故障排除](../../troubleshooting/common-issues/boot-and-startup-failures.mdx)以获取详细恢复步骤。
  2. **从备份恢复**：将备份文件复制回USB设备。
  3. **检查文件完整性**：确保所有系统文件完整无损。
  4. **尝试安全模式**：进入[安全模式](../../using-unraid-to/customize-your-experience/plugins.mdx#troubleshooting-with-safe-mode)进行进一步故障排查。
  5. **手动恢复**：如有必要，使用手动恢复方法。
</details>

<details>
  <summary><strong>插件或Docker容器不工作</strong> - 单击展开/折叠</summary>

  降级后，一些插件或容器可能无法正常运行：

  - **更新插件**：寻找与降级版本兼容的插件更新。在[社区应用](../../using-unraid-to/run-docker-containers/community-applications.mdx)中检查兼容版本。
  - **重建Docker**：删除并重新创建您的Docker镜像文件。查看[Docker故障排除](../../troubleshooting/common-issues/docker-troubleshooting.mdx#re-creating-the-docker-image-file)以获取详细步骤。
    - **检查依赖项**：确保所有必要的依赖项可用。
    - **Plugin compatibility**: Some plugins might not support earlier Unraid versions.
    - **UI/WebGUI feature-dependent plugins**: Plugins relying on newer WebGUI features may not operate correctly on older versions.
    - **主题插件**：如果视觉定制插件不兼容，可能需要更新或移除。
</details>
