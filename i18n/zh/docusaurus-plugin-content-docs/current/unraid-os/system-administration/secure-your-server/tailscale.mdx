---
sidebar_position: 6
sidebar_label: Tailscale
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Tailscale

Unraid 现在通过与 [%%Tailscale|tailscale%%](https://tailscale.com/) 的技术合作，提供了深度集成，使您的服务器能够实现无缝、安全的网络连接。%%Tailscale|tailscale%% 不是传统的 VPN，而是一种基于 %%WireGuard|wireguard%% 的现代点对点覆盖网络。它可以将设备、服务器和单个 Docker 容器连接到您的安全私人网络 (%%Tailnet|tailnet%%)，无论其物理位置或网络环境如何。Unraid 的合作确保了 %%Tailscale|tailscale%% 插件的完整维护和紧密集成，为 Unraid 7 及更新版本提供原生证书支持和高级功能。

- **简单设置：** 无需端口转发或防火墙困扰。
- **强大的安全性：** 使用 %%WireGuard|wireguard%% 加密核心技术。
- **灵活共享：** 仅授予对特定设备或容器的访问权限，而不是整个网络。
- **一流支持：** 官方维护的插件，持续增强。

---

## 开始使用 Tailscale

首先，[注册一个免费的 Tailscale 帐户](https://login.tailscale.com/start) 并在至少一个设备（Windows, macOS, Linux, iOS, Android 等）上安装客户端。免费帐户最多支持三位用户和 100 台设备。

在添加 Unraid 之前，请考虑：

- [为更易识别重命名您的 %%Tailnet|tailnet%%](https://tailscale.com/kb/1217/tailnet-name)。
- 启用 [%%MagicDNS|magicdns%%](https://tailscale.com/kb/1081/magicdns) 以简化设备命名。
- 启用 [HTTPS 证书](https://tailscale.com/kb/1153/enabling-https) 以实现安全、可信的访问。

:::note
Machine names in HTTPS certificates are public. Use names you’re comfortable sharing.
:::

### Adding Tailscale to Unraid

The following steps are current and accurate for Unraid 7 and later:

1. Review your Tailscale account settings as described above.
2. In Unraid, search the [**Community Apps**](../../using-unraid-to/run-docker-containers/community-applications.mdx) tab for the official %%Tailscale|tailscale%% plugin and install it.
3. Open ***Settings → Tailscale*** and click Reauthenticate. Sign in with your %%Tailscale|tailscale%% account.
4. Click **Connect** to add your Unraid server to your %%Tailnet|tailnet%%.
5. Visit ***Settings → Management Access*** to see your %%Tailscale|tailscale%% URLs for the %%WebGUI|web-gui%%.
6. In ***Settings → Tailscale***, find your server's %%Tailnet|tailnet%% name and IP. Use these to access SMB/NFS shares, Docker containers, and more from any device on your %%Tailnet|tailnet%%.

### Subnet routing (optional)

To access your Unraid server by its main LAN IP (or to reach Docker containers with their own IPs):

1. Go to ***Settings → Tailscale***, click Viewing, and Sign In.
2. Click **Subnet router** and add:
   - Your Unraid server’s IP (e.g., `192.168.0.12/32`), or
   - Your whole network’s subnet (e.g., `192.168.0.0/24`).
3. Click **Advertise routes**.
4. Approve the pending route in your Tailscale admin console.
5. Once approved, devices on your %%Tailnet|tailnet%% can access your Unraid server and/or LAN devices by their usual IP addresses.
6. For advanced details, see the [%%Tailscale|tailscale%% %%subnet routing|subnet-routing%% documentation](https://tailscale.com/kb/1019/subnets).

---

## Adding Tailscale to Docker Containers

Unraid makes it easy to connect [Docker containers](../../using-unraid-to/run-docker-containers/overview.mdx) to your %%Tailnet|tailnet%%, giving each container a unique device identity for secure, flexible remote access. With this integration, you can share access to individual containers - without exposing your entire server - and take advantage of advanced features like exit nodes, Serve, and Funnel on a per-container basis. The setup is fully automated, so users of all skill levels can benefit from enhanced security and streamlined networking.

<details>
  <summary><strong>How the Tailscale-Docker integration works</strong> - Click to expand/collapse</summary>

  When you enable **Use %%Tailscale|tailscale%%** for a Docker container and apply changes, Unraid automates the following steps for seamless integration:

  1. **Entrypoint Extraction:** Unraid identifies the container’s original Entrypoint and CMD, preserving its intended startup behavior.
  2. **Integration Script Injection:** The `tailscale_container_hook` script is mounted inside the container, and the Entrypoint is updated to run this script first.
  3. **Environment Setup:** The original Entrypoint, CMD, and all required %%Tailscale|tailscale%% variables are passed to the Docker run command.
  4. **%%Tailscale|tailscale%% Initialization:** On startup, the hook script installs any dependencies, downloads, and launches the %%Tailscale|tailscale%% client within the container.
  5. **Normal Startup:** The script then starts the container’s original Entrypoint and CMD, so your application runs as usual - with Tailscale networking layered in automatically.

  Once enabled, the container appears as its own device on your Tailnet, ready for secure access and advanced Tailscale features, without any need for manual network configuration or port forwarding.
</details>

:::warning[Container 兼容性]
Tailscale integration does not work with all containers. Some containers may not function at all if Tailscale is enabled, particularly those with:

- 自定义网络要求
- 特定的网络隔离需求
- 与 Tailscale 网络修改相冲突的应用程序

Test Tailscale integration on non-critical containers first, and be prepared to disable it if the container stops working properly.
:::

:::note\[Prerequisites]

- 首先，在任何将访问您 Docker 容器的计算机上安装 %%Tailscale|tailscale%%。
- While the Unraid Tailscale plugin isn’t strictly required for Docker integration, it’s strongly recommended to install it and sign in on your Unraid server for the best experience.

:::

将 %%Tailscale|tailscale%% 添加到 Docker 容器：

1. 请查看您的 %%Tailscale|tailscale%% 帐户设置，如 [开始使用部分](#getting-started-with-tailscale) 所述。
2. 在 Unraid 中，转到 **Docker** 选项卡并 [编辑所需的容器](../../using-unraid-to/run-docker-containers/managing-and-customizing-containers.mdx)。
3. 启用 **使用 Tailscale** 开关。
4. 为容器输入一个 **Tailscale 主机名**（必须在您的 Tailnet 上唯一）。

:::warning
HTTPS 证书将为此主机名生成，并发布在公共证书册中。选择您愿意公开分享的名称。有关详细信息，请参阅 [Tailscale HTTPS 文档](https://tailscale.com/kb/1153/enabling-https)。
:::

5. 决定此容器是否应成为出口节点（对于 VPN 容器非常有用）。
6. 选择容器是否应使用出口节点处理其外发流量。如果安装了 Tailnet 插件，您将看到可用的出口节点列表；否则，请手动输入 IP。
7. 如果使用出口节点，指定容器是否还应访问您的 LAN。
8. Tailscale **用户空间网络** 字段通常自动设置。除非有特定需求，否则请保持禁用状态。
9. 决定是否启用 **%%Tailscale|tailscale%% %%SSH|ssh%%**（通过 %%Tailscale|tailscale%% 认证的安全外壳访问）。

:::info[Serve 与漏斗]
- **Serve**：允许您使用友好的 HTTPS URL 从您的 Tailnet 安全访问容器的网页或 Web 服务。不需要端口转发，且只能通过 Tailnet 设备进行连接。
- **Funnel**: Publishes the container’s website to the public internet via a unique HTTPS URL. Anyone with the link can access it, even if they’re not on your Tailnet. Use this with caution, as it exposes your service to the wider internet.
:::

10. 启用 **Serve** 可将容器的 Web 界面反向代理到您的 Tailnet，或启用 **Funnel** 以使其在公共互联网中可访问。Unraid 将根据容器的 WebUI 设置自动检测要使用的端口。如有需要，还提供高级选项。

:::warning
使用 Serve 或 Funnel 时，没有额外的身份验证层 - 容器负责管理用户访问。请相应地保护您的 Web 应用程序。
:::

11. **应用** 您的更改并检查 **容器日志** 中的 Tailscale 消息。点击 "要进行身份验证，请访问" 链接以批准您的 Tailnet 上的容器。

:::caution\[Troubleshooting]

**Persistent state error** - If you see "*ERROR: Couldn't detect persistent Docker directory for .tailscale\_state*":

- 编辑容器并标识映射路径以存储 Tailscale 状态数据（例如，`/container-path/`）。
- 启用 Tailscale **显示高级设置** 并设置 Tailscale **状态目录** 为 `/container-path/.tailscale_state`。
- 重启容器。
- Docker XML authors can simplify this by adding `<TailscaleStateDir>/container-path/.tailscale_state</TailscaleStateDir>` to the container’s XML file.

:::

---

## 更新 Tailscale

%%Tailscale|tailscale%% 经常更新以提供新功能和安全改进。为使您的 Unraid 系统保持安全和兼容，请确保 Unraid %%Tailscale|tailscale%% 插件和使用 %%Tailscale|tailscale%% 的任何 Docker 容器都是最新的。

要更新 %%Tailscale|tailscale%%:

- **更新 Unraid %%Tailscale|tailscale%% 插件：** 当有新版本时，请通过 Unraid 应用程序标签更新插件，就像其他插件一样。您始终可以在 [%%Tailscale|tailscale%% 更改日志](https://tailscale.com/changelog) 中查看最新更改。

- **在 Docker 容器中更新 %%Tailscale|tailscale%%：**
  1. 在 Docker 页面，悬停在某个容器的 %%Tailscale|tailscale%% 图标上。如果有可用更新，您将看到通知。
  2. 通过以下方式更新容器：
     - 切换到 **高级视图**（右上角），然后点击 **强制更新**。
     - 编辑容器，进行微小更改（如切换一个设置），并点击 **应用**。

---

## 用户空间网络

**用户空间网络** 控制容器如何连接到您的 %%Tailnet|tailnet%% 及其他网络。在大多数情况下，如果您使用他们的 %%Tailscale|tailscale%% WebUI URLs 访问容器并在所有客户端系统上安装了 %%Tailscale|tailscale%%，则可以忽略详细信息。

- **启用：** 容器在受限环境中操作。它无法启动与其他 %%Tailnet|tailnet%% 设备的连接或使用 %%Tailscale|tailscale%% DNS，但仍可通过 %%Tailscale|tailscale%% WebUI 和原始 WebUI URL 访问。

- **禁用：** 容器具有完整的 %%Tailnet|tailnet%% 访问权限，并可以使用 %%Tailscale|tailscale%% DNS。它可以与其他 %%Tailnet|tailnet%% 设备通信，但原始 WebUI URL 可能无法使用。

:::info[Feature 要求]
- 设置为 **出口节点** 的容器始终开启用户空间网络。
- Containers that **Use an Exit Node** always have userspace networking disabled.
:::

### 网络类型兼容性

Tailscale 集成和用户空间网络的行为取决于容器的网络类型。使用下表了解兼容性和访问选项：

| 网络类型                 | 用户空间网络默认  | 可以改变吗？ | WebUI 访问(%%Tailscale\|tailscale%%) | WebUI 访问（原始）        | 笔记                                                     |
| -------------------- | --------- | ------ | ---------------------------------- | ------------------- | ------------------------------------------------------ |
| `host`               | 禁用        | 不可以    | 不可以                                | Yes                 | 宿主模式下未提供 %%Tailscale\|tailscale%% 集成                   |
| `bridge`             | 禁用        | Yes    | Yes                                | *启用*: 可以  *禁用*: 不可以 | 如果启用，则启用两个 URL；如果禁用，只启用 %%Tailscale\|tailscale%% WebUI |
| `eth0`/`br0`/`bond0` | 禁用        | Yes    | Yes                                | Yes                 | 无论设置如何，都可以访问两个 URL                                     |
| `container`/`wg0`    | 已禁用（未经测试） | Yes    | 未知                                 | 未知                  | 使用时请谨慎；尚未完全测试                                          |

:::info[Keep 记住]
- %%Tailscale|tailscale%% 的 WebUI 地址仅可由安装了 %%Tailscale|tailscale%% 并加入您 %%Tailnet|tailnet%% 的设备访问，或者在显式共享启用时访问。
- For most users, default settings provide secure and reliable access. Advanced options are available for specialized networking needs.
:::

\* “%%WireGuard|wireguard%%”和“%%WireGuard|wireguard%%”徽标是Jason A. Donenfeld的注册商标。
