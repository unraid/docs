# 版本 6.12.8 2024-02-15

## 升级说明

此版本包括两个非常重要的修复。首先，我们更新了 Docker，以纳入其[近期安全公告](https://www.docker.com/blog/docker-security-advisory-multiple-vulnerabilities-in-runc-buildkit-and-moby/)中的修复。

其次，我们修复了一个在新添加的阵列驱动器具有非标准分区布局时，可能导致数据丢失的边缘案例错误。如果添加这些驱动器，第二次启动阵列时驱动器将显示为未格式化。如果发生这种情况，请联系支持人员，我们可以帮助您进行数据恢复。即使尚未遇到此问题，我们仍建议进行升级，以便将来在添加驱动器时不受影响。

此版本还包括网络、Docker 容器、Time Machine 支持和 虚拟机中的一些好修复，以及为某些系统在仪表板上出现的性能变慢问题进行的修复。我们还改进了 NVME 和 SSD 驱动器的 SMART 属性处理。详情如下。

### 已知问题

#### 过时的插件

过时的插件可能会导致问题，我们建议保持它们的最新状态。

#### 与macvlan相关的调用跟踪和崩溃

如果您收到与 macvlan 相关的调用跟踪（或任何无法解释的崩溃），第一步我们建议您导航到 _**设置 > Docker**_，切换到**高级**视图，然后将 **Docker 自定义网络类型** 从 **macvlan** 更改为 **ipvlan**。这是自版本 6.11.5 以来 Unraid 随附的默认配置，应该适用于大多数系统。

请注意，某些用户报告在使用某些路由器（Fritzbox）进行端口转发时遇到问题，并且在 ipvlan 模式下使用高级网络管理工具（Ubiquity）时功能受到限制。如果这影响到您，请查看自 Unraid 版本 [6.12.4](6.12.4.md#fix-for-macvlan-call-traces) 起提供的替代解决方案。

#### 由于jumbo frames导致的网络问题

如果您有任何类型的网络问题，请确认您没有启用 Jumbo 桢。导航到 _**设置 > 网络设置 > eth0**_ 并确认 **期望的 MTU** 为 1500。有关更多信息，请参阅 [关于 Jumbo 框架的常见问题警告](https://forums.unraid.net/topic/120220-fix-common-problems-more-information/page/2/#comment-1167702)。

#### 由于Realtek网卡导致的问题

升级的内核修复了与 Jumbo 框架和内核中 Realtek 8125 驱动程序的死锁问题。然而，我们仍然建议遵循上述关于 Jumbo 框架的建议。

如果您继续遇到网络稳定性问题，并且_**工具 > 系统设备**_ 显示您拥有 Realtek 以太网控制器，请获取显示的零件号并搜索社区应用，看看是否有专用的 Realtek 驱动程序插件。有关更多信息，请参阅 [Realtek 驱动程序插件支持页面](https://forums.unraid.net/topic/141349-plugin-realtek-r8125-r8168-and-r81526-drivers/)。

#### 其他问题？

我们强烈推荐安装**Fix Common Problems**插件，因为它会警告您常见配置问题。

如果您遇到其他崩溃或稳定性问题，请导航到 _**设置 > 系统日志服务器**_ 并启用 **镜像系统日志到闪存**。这将在您的 USB 闪存启动设备上造成额外的磨损，但在崩溃后收集日志短期内是有用的。

下次重启后，导航到_**工具 > 诊断**_并下载您的匿名诊断（从版本6.12.5起，诊断会自动包含镜像到闪存驱动器的日志）。

最后，在 [常规支持](https://forums.unraid.net/forum/55-general-support/) 下开始一个新主题，并提供问题的所有详细信息。一旦问题解决，请务必禁用 **镜像系统日志到闪存**。

### 回滚

请注意，回滚到早期版本将使您的系统可能受到 Docker 安全问题和[升级说明](#upgrade-notes)中提到的潜在数据丢失场景的影响。

如果回滚到 6.12.6 之前的版本，请同时查看[6.12.6 发行说明](6.12.6.md#rolling-back)。

## 与 6.12.7 的变更

修复了与 rc 版本升级相关的问题。

## 与 [6.12.6](6.12.6.md) 的变更

### 漏洞修复和改进

- Docker：
  - 修复了将 WG 路由添加到正确的接口（br0 或 eth0 或 bond0）。
  - 使用“延迟卸载”来卸载 Docker 镜像以防止阻塞阵列停止。
  - 更新以解决多个安全问题（CVE-2024-21626, CVE-2024-24557）
- 网络改进：
  - 通过在分配 DHCP 地址之前检查载波来加速启动。
  - 从 IPv4 和 IPv6 地址中去除前导零。
  - 新增 “/etc/rc.d/rc.inet1 status” 和 “/etc/rc.d/rc.inet1 status ip” 命令，以帮助在命令行进行网络故障排除。
- 通知：将 ntfy.sh 添加到通知代理。
- SMART 改进：
  - 修复 NVME 自检。
  - 修正显示“累计开机时间，小时：分钟 xxxxx:yy” SMART 属性。
  - 在 SSD 的 SMART 属性中显示已写入的 KB/MB/GB/TB。
  - 新增“SSD 耐用度剩余”SMART 属性。
- 系统日志：
  - 默认情况下，系统日志在关闭时复制到引导闪存中，查看_**设置 > 系统日志服务器**_以禁用。
  - 上述日志和**将系统日志镜像到闪存**的日志现在在下次启动时可通过_**工具 > 系统日志**_和诊断页面获得。
- VM管理器：降级修复：如果VM模板已更新到最新的QEMU机器类型，降级时可能找不到。此更改可以找到给定机器类型的最新版本。
- ZFS：使用 zpool import "-f" 标志允许导入外来池。
- 其他：
  - 默认情况下在新安装中启用 EFI 引导。
  - 修复仪表盘和 Docker 页面上的性能下降（并减少闪存设备写入）。
  - 格式化：如果设备分区布局已有效，则不初始化。
  - 更新操作系统：重新设计系统更新和降级页面，详见[博客文章](https://unraid.net/blog/new-update-os-tool)
  - 修复 MacOS 无法写入“闪存”共享并恢复时间机器兼容性（fruit 变更）
  - 允许社区应用程序（如果已安装）在执行多重安装时自动启动容器。
  - 反馈表单：将完成按钮更改为取消。

### 软件包更新

- docker：版本 24.0.9
- 内核固件：版本20231226_abfcad8

### Linux kernel

- 版本 6.1.74
  - 配置_USB串行XR：USB MaxLinear/Exar USB到串行驱动
  - 配置_CAN：CAN总线子系统支持
  - 配置_CAN_NETLINK：支持Netlink的CAN设备驱动程序
  - 配置_CAN_GS_USB：兼容Geschwister Schneider UG和candleLight的接口
  - 配置_SCSI_LPFC：Emulex LightPulse光纤通道支持

## 补丁

安装 [Unraid Patch 插件](https://forums.unraid.net/topic/185560-unraid-patch-plugin/) 后，访问 _**工具 → Unraid Patch**_ 获取以下补丁/紧急修复：

- 一部分安全更新，详情请参阅 [这篇博客文章](https://unraid.net/blog/cvd)。我们建议升级到最新稳定版本以获取其他安全更新。
