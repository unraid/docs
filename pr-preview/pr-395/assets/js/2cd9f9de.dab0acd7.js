"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[3101],{3242:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"API/programmatic-api-key-management","title":"Programmatic API key management","description":"Create, use, and delete API keys programmatically for automated workflows","source":"@site/docs/API/programmatic-api-key-management.mdx","sourceDirName":"API","slug":"/API/programmatic-api-key-management","permalink":"/docs/pr-preview/pr-395/API/programmatic-api-key-management","draft":false,"unlisted":false,"editUrl":"https://github.com/unraid/docs/edit/fix-device-counts-again/docs/API/programmatic-api-key-management.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Programmatic API key management","description":"Create, use, and delete API keys programmatically for automated workflows","sidebar_position":4},"sidebar":"unraidSidebar","previous":{"title":"CLI reference","permalink":"/docs/pr-preview/pr-395/API/cli"},"next":{"title":"Roadmap & Features","permalink":"/docs/pr-preview/pr-395/API/upcoming-features"}}');var i=r(4848),d=r(8453);const c={title:"Programmatic API key management",description:"Create, use, and delete API keys programmatically for automated workflows",sidebar_position:4},l="Programmatic API key management",t={},o=[{value:"Overview",id:"overview",level:2},{value:"Creating API keys",id:"creating-api-keys",level:2},{value:"Deleting API keys",id:"deleting-api-keys",level:2},{value:"Complete workflow example",id:"complete-workflow-example",level:2},{value:"Command reference",id:"command-reference",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function a(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"programmatic-api-key-management",children:"Programmatic API key management"})}),"\n",(0,i.jsx)(n.p,{children:"This guide explains how to create, use, and delete API keys programmatically using the Unraid API CLI, enabling automated workflows and scripts."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"unraid-api apikey"})," command supports both interactive and non-interactive modes, making it suitable for automated deployment scripts, CI/CD pipelines, temporary access provisioning, and infrastructure as code workflows."]}),"\n",(0,i.jsx)(n.h2,{id:"creating-api-keys",children:"Creating API keys"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Basic creation with JSON output:"})}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"--json"})," flag to get machine-readable output:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'unraid-api apikey --create --name "workflow key" --roles ADMIN --json\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "key": "your-generated-api-key-here",\n    "name": "workflow key",\n    "id": "generated-uuid"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Advanced creation with permissions:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'unraid-api apikey --create \\\n  --name "limited access key" \\\n  --permissions "DOCKER:READ_ANY,ARRAY:READ_ANY" \\\n  --description "Read-only access for monitoring" \\\n  --json\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Handling existing keys:"})}),"\n",(0,i.jsxs)(n.p,{children:["If a key with the same name exists, use ",(0,i.jsx)(n.code,{children:"--overwrite"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'unraid-api apikey --create --name "existing key" --roles ADMIN --overwrite --json\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--overwrite"})," flag will permanently replace the existing key. The old key will be immediately invalidated."]})}),"\n",(0,i.jsx)(n.h2,{id:"deleting-api-keys",children:"Deleting API keys"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Non-interactive deletion:"})}),"\n",(0,i.jsx)(n.p,{children:"Delete a key by name without prompts:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'unraid-api apikey --delete --name "workflow key"\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",children:"Successfully deleted 1 API key\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"JSON output for deletion:"})}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"--json"})," flag for machine-readable delete confirmation:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'unraid-api apikey --delete --name "workflow key" --json\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Success Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "deleted": 1,\n    "keys": [\n        {\n            "id": "generated-uuid",\n            "name": "workflow key"\n        }\n    ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Error Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "deleted": 0,\n    "error": "No API key found with name: nonexistent key"\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Error handling:"})}),"\n",(0,i.jsx)(n.p,{children:"When the specified key doesn't exist:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'unraid-api apikey --delete --name "nonexistent key"\n# Output: No API keys found to delete\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"JSON Error Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "deleted": 0,\n    "message": "No API keys found to delete"\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"complete-workflow-example",children:"Complete workflow example"}),"\n",(0,i.jsx)(n.p,{children:"This example demonstrates temporary access provisioning:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nset -e\n\n# 1. Create temporary API key\necho "Creating temporary API key..."\nKEY_DATA=$(unraid-api apikey --create \\\n  --name "temp deployment key" \\\n  --roles ADMIN \\\n  --description "Temporary key for deployment $(date)" \\\n  --json)\n\n# 2. Extract the API key\nAPI_KEY=$(echo "$KEY_DATA" | jq -r \'.key\')\necho "API key created successfully"\n\n# 3. Use the key for operations\necho "Configuring services..."\ncurl -H "Authorization: Bearer $API_KEY" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"provider": "azure", "clientId": "your-client-id"}\' \\\n  http://localhost:3001/graphql\n\n# 4. Clean up (always runs, even on error)\ntrap \'echo "Cleaning up..."; unraid-api apikey --delete --name "temp deployment key"\' EXIT\n\necho "Deployment completed successfully"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"command-reference",children:"Command reference"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Create command options:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Flag"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--name <name>"})}),(0,i.jsx)(n.td,{children:"Key name (required)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'--name "my key"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--roles <roles>"})}),(0,i.jsx)(n.td,{children:"Comma-separated roles"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--roles ADMIN,VIEWER"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--permissions <perms>"})}),(0,i.jsxs)(n.td,{children:["Resource",":action"," pairs"]}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'--permissions "DOCKER:READ_ANY"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--description <desc>"})}),(0,i.jsx)(n.td,{children:"Key description"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'--description "CI/CD key"'})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--overwrite"})}),(0,i.jsx)(n.td,{children:"Replace existing key"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--overwrite"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--json"})}),(0,i.jsx)(n.td,{children:"Machine-readable output"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--json"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Available roles:"})," ",(0,i.jsx)(n.code,{children:"ADMIN"})," (full system access), ",(0,i.jsx)(n.code,{children:"CONNECT"})," (Unraid Connect features), ",(0,i.jsx)(n.code,{children:"VIEWER"})," (read-only access), ",(0,i.jsx)(n.code,{children:"GUEST"})," (limited access)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Available resources:"})," ",(0,i.jsx)(n.code,{children:"ACTIVATION_CODE"}),", ",(0,i.jsx)(n.code,{children:"API_KEY"}),", ",(0,i.jsx)(n.code,{children:"ARRAY"}),", ",(0,i.jsx)(n.code,{children:"CLOUD"}),", ",(0,i.jsx)(n.code,{children:"CONFIG"}),", ",(0,i.jsx)(n.code,{children:"CONNECT"}),", ",(0,i.jsx)(n.code,{children:"CONNECT__REMOTE_ACCESS"}),", ",(0,i.jsx)(n.code,{children:"CUSTOMIZATIONS"}),", ",(0,i.jsx)(n.code,{children:"DASHBOARD"}),", ",(0,i.jsx)(n.code,{children:"DISK"}),", ",(0,i.jsx)(n.code,{children:"DISPLAY"}),", ",(0,i.jsx)(n.code,{children:"DOCKER"}),", ",(0,i.jsx)(n.code,{children:"FLASH"}),", ",(0,i.jsx)(n.code,{children:"INFO"}),", ",(0,i.jsx)(n.code,{children:"LOGS"}),", ",(0,i.jsx)(n.code,{children:"ME"}),", ",(0,i.jsx)(n.code,{children:"NETWORK"}),", ",(0,i.jsx)(n.code,{children:"NOTIFICATIONS"}),", ",(0,i.jsx)(n.code,{children:"ONLINE"}),", ",(0,i.jsx)(n.code,{children:"OS"}),", ",(0,i.jsx)(n.code,{children:"OWNER"}),", ",(0,i.jsx)(n.code,{children:"PERMISSION"}),", ",(0,i.jsx)(n.code,{children:"REGISTRATION"}),", ",(0,i.jsx)(n.code,{children:"SERVERS"}),", ",(0,i.jsx)(n.code,{children:"SERVICES"}),", ",(0,i.jsx)(n.code,{children:"SHARE"}),", ",(0,i.jsx)(n.code,{children:"VARS"}),", ",(0,i.jsx)(n.code,{children:"VMS"}),", ",(0,i.jsx)(n.code,{children:"WELCOME"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Available actions:"})," ",(0,i.jsx)(n.code,{children:"CREATE_ANY"}),", ",(0,i.jsx)(n.code,{children:"CREATE_OWN"}),", ",(0,i.jsx)(n.code,{children:"READ_ANY"}),", ",(0,i.jsx)(n.code,{children:"READ_OWN"}),", ",(0,i.jsx)(n.code,{children:"UPDATE_ANY"}),", ",(0,i.jsx)(n.code,{children:"UPDATE_OWN"}),", ",(0,i.jsx)(n.code,{children:"DELETE_ANY"}),", ",(0,i.jsx)(n.code,{children:"DELETE_OWN"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Delete command options:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Flag"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--delete"})}),(0,i.jsx)(n.td,{children:"Enable delete mode"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--delete"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"--name <name>"})}),(0,i.jsx)(n.td,{children:"Key to delete (optional)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'--name "my key"'})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"--name"})," is omitted, the command runs interactively."]}),"\n",(0,i.jsxs)(n.p,{children:["Use specific permissions instead of ADMIN role when possible (for example, ",(0,i.jsx)(n.code,{children:'--permissions "DOCKER:READ_ANY"'})," instead of ",(0,i.jsx)(n.code,{children:"--roles ADMIN"}),"). Always clean up temporary keys after use and store API keys securely (environment variables, secrets management). Use descriptive names that include purpose and date for audit trails. Note that names must contain only letters, numbers, and spaces (Unicode letters are supported)."]}),"\n",(0,i.jsxs)(n.p,{children:["Check exit codes (",(0,i.jsx)(n.code,{children:"$?"}),") after each command. Use ",(0,i.jsx)(n.code,{children:"set -e"})," in bash scripts to fail fast and implement proper cleanup with ",(0,i.jsx)(n.code,{children:"trap"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Common error messages:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:'"API key name must contain only letters, numbers, and spaces"'}),": Remove special characters like hyphens, underscores, or symbols."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\"API key with name 'x' already exists\""}),": Use ",(0,i.jsx)(n.code,{children:"--overwrite"})," flag or choose a different name."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:'"Please add at least one role or permission to the key"'}),": Specify either ",(0,i.jsx)(n.code,{children:"--roles"})," or ",(0,i.jsx)(n.code,{children:"--permissions"})," (or both)."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For troubleshooting, run with debug logging:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'LOG_LEVEL=debug unraid-api apikey --create --name "debug key" --roles ADMIN\n'})})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>l});var s=r(6540);const i={},d=s.createContext(i);function c(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);