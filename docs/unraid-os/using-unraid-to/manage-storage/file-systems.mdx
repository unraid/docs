---
sidebar_position: 4
sidebar_label: File systems
---

# File systems

### Selecting a file system type

Selecting the right file system for your Unraid %%array|array%% or %%cache pool|cache-pool%% is crucial. It helps you achieve a balance between performance, data protection, and advanced features. Unraid supports several modern Linux file systems, each with its own unique strengths and specific use cases:

| File System      | Data Protection                                                                       | Space Efficiency               | Advanced Features                                                | Best Use Case                                           |
| ---------------- | ------------------------------------------------------------------------------------- | ------------------------------ | ---------------------------------------------------------------- | ------------------------------------------------------- |
| %%XFS\|xfs%%     | No built-in redundancy                                                                | 100%                           | Robust against corruption                                        | Default for array drives; high reliability              |
| %%ZFS\|zfs%%     | %%RAIDZ1\|raidz1%%/%%RAIDZ2\|raidz2%%/%%RAIDZ3\|raidz3%%, mirrors, etc.               | Varies by %%RAID\|raid%% level | %%Checksums\|checksum%%, %%Snapshots\|snapshot%%, %%RAID\|raid%% | Multi-device pools, %%VMs\|vm%%, Docker, advanced users |
| %%BTRFS\|btrfs%% | %%RAID 0\|raid0%%/%%RAID 1\|raid1%%/%%10\|raid10%%/%%5\|raid5%%/%%6\|raid6%%, mirrors | Varies by %%RAID\|raid%% level | %%Checksums\|checksum%%, %%Snapshots\|snapshot%%, %%RAID\|raid%% | Multi-device pools, mixed SSD/HDD, flexible pools       |

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="xfs" label="XFS" default>
    **%%XFS|xfs%%** is the default file system for %%array|array%% drives in Unraid. It’s known for its robustness and ability to recover from corruption after unexpected shutdowns or crashes. Each drive formatted with %%XFS|xfs%% acts as a self-contained file system, making data recovery straightforward on any Linux system.

    - **Data protection:** No built-in redundancy; relies on Unraid's %%parity|parity%% for protection.
    - **Performance:** Consistent and reliable.
    - **Best for:** %%Array|array%% drives, especially when stability and ease of data recovery are priorities.

  </TabItem>

  <TabItem value="zfs" label="ZFS">
    %%ZFS|zfs%% is a modern file system that comes with advanced features such as %%checksums|checksum%% to detect %%bit rot|bit-rot%%, %%snapshots|snapshot%% for backups, and native %%RAID|raid%% support options like %%RAIDZ1|raidz1%%/%%RAIDZ2|raidz2%%/%%RAIDZ3|raidz3%% and mirrors. %%ZFS|zfs%% can be utilized for both single-device and multi-device pools in Unraid 6.12 and later.

    - **Data protection:** Supports various %%RAID|raid%% levels for redundancy.
    - **Performance:** Excellent, particularly for multi-device pools.
    - **Best for:** High-performance environments, %%virtual machines|vm%%, Docker, or when advanced features like %%snapshots|snapshot%% are required.

    For a deep dive into %%ZFS|zfs%% features, configuration, and best practices, check out our dedicated section on [ZFS storage](../../advanced-configurations/optimize-storage/zfs-storage.mdx).

  </TabItem>

  <TabItem value="btrfs" label="BTRFS">
    %%BTRFS|btrfs%% provides flexible %%RAID|raid%% support, %%checksums|checksum%% for data integrity, and efficient management of mixed-size drives in pools. It serves as the default file system for %%cache pools|cache-pool%% and supports both single-device and multi-device configurations.

    - **Data protection:** Supports %%RAID 0|raid0%%/%%1|raid1%%/%%10|raid10%%/%%5|raid5%%/%%6|raid6%% (note that %%RAID 5|raid5%%/%%6|raid6%% are still experimental).
    - **Performance:** Good, with flexibility for expansion and contraction.
    - **Best for:** %%Cache pools|cache-pool%%, especially if you plan to mix SSDs and HDDs or need an easy way to expand.

  </TabItem>
</Tabs>

:::note Additional Notes

- Mixing different file system types in your Unraid system is perfectly acceptable; the Unraid %%parity|parity%% system works independently of the file system used.
- Always format and partition drives within Unraid to ensure compatibility.
- Linux systems can read these file systems natively; however, Windows and macOS will require additional software for access.
- You can <u>encrypt</u> drives for enhanced security, but keep in mind that encrypted drives might pose challenges for recovery if corruption occurs.
- For transfer drives or external devices, it's recommended to use the **[Unassigned Devices](#using-the-unassigned-devices-plugins)** plugin, which supports additional file systems.

:::

:::tip Still need help choosing?

- **For array drives:** %%XFS|xfs%% is generally the best choice for most users.
- **For high-performance or advanced features:** Choose %%ZFS|zfs%% or %%BTRFS|btrfs%% for %%cache pools|cache-pool%% or multi-device setups.
- **For mixed or expanding pools:** %%BTRFS|btrfs%% is ideal if you want to use different drive sizes or easily add or remove devices.

If you're uncertain, starting with the defaults is a good approach: use %%XFS|xfs%% for %%array|array%% drives and %%BTRFS|btrfs%% for %%cache pools|cache-pool%%.

:::

---

## Setting a file system type

When adding a new drive to Unraid, you can select the file system type that works best for your needs. The file system determines how data is organized and protected on the disk.

To set the file system type:

1. **Set the default globally**:
   - Navigate to ***Settings → Disk Settings*** to set the default file system for new %%array|array%% drives only.
   - Unraid defaults to %%XFS|xfs%% for %%array|array%% drives.
   - **Note:** There is currently no global default setting for %%cache pools|cache-pool%%. They will always default to %%BTRFS|btrfs%% if left to "auto".

2. **Set the file system for an individual drive**:
   - Stop the %%array|array%%.
   - Click on the drive in the **Main** tab.
   - Choose your desired file system type from the drop-down menu.
   - If you select **auto**, Unraid will use the global default.
   - For multi-device %%cache pools|cache-pool%%, only %%BTRFS|btrfs%% or %%ZFS|zfs%% are supported.

---

## Creating a file system (formatting)

Before using a new disk in Unraid, you must format it with the selected file system. **Remember, formatting will erase all existing content on the drive.**

To begin with formatting:

1. **Start the %%array|array%%**.
2. **Identify unmountable drives**: Drives that are not recognized will appear as **unmountable**.
3. **Verify drive selection**: Verify that all unmountable drives are the ones you want to format.
4. **Confirm and format**: Check the box to confirm, read the warning dialog carefully, and click **Format**.
5. **Monitor the process**: The format process will begin. For new disks, Unraid will first rewrite the partition table.
6. **Wait for completion**: Formatting usually takes a few minutes. If you don't see progress, refresh the **Main** tab.

Once formatting is complete, the drive is ready to store files.

---

## Changing a file system type

You may want to change the file system type on a specific drive to take advantage of new features or to ensure compatibility with your other drives.

:::warning

Changing the file system type will **erase all existing data** on the drive. Always back up any important files before proceeding.

:::

To change the file system type on a particular drive:

1. **Stop the array**: Begin by stopping your %%array|array%% to ensure no operations are occurring during the change.
2. **Select the drive**: In the **Main** tab, click on the drive that you want to change the format for.
3. **Choose the new file system**: From the drop-down menu, select the desired file system format. If you have multiple drives to change, repeat this step for each one.
4. **Start the array**: Once you have selected the new file systems, start your %%array|array%% again.
5. **Format unmountable drives**: The **Main** tab will display an option to format unmountable drives. Take a moment to check the list and ensure that only the drives you intend to change are included.
6. **Confirm and format**: Check the confirmation box to acknowledge the change, then click the **Format** button to proceed.
7. **Wait for the process to finish**: Formatting usually takes just a few minutes. If you notice that the status isn't updating, you can refresh the **Main** tab to check the progress.

If you encounter any issues, feel free to visit the [Unraid forums](https://forums.unraid.net/). Attach your system diagnostics zip file (found under ***Tools → Diagnostics***) for assistance.

---

## Converting to a new file system type

:::important
Starting with Unraid 7.2, the ***Main*** page will warn if any array or pool drives are formatted in legacy filesystems:
* Any drives formatted in ReiserFS need to be migrated to another filesystem ASAP as they will not be usable in a future release of Unraid (likely Unraid 7.3).
* Any drives formatted in an older version of XFS need to be migrated before 2030.
:::

To change the file system type on a drive but keep its data, you must migrate the contents before reformatting. This process is especially common for users moving away from the deprecated ReiserFS (used in older Unraid versions) to %%XFS|xfs%% or %%BTRFS|btrfs%%, but it applies to any file system conversion.

:::important

This process requires temporarily moving your data to another location. Make sure you have enough free space elsewhere in your %%array|array%% or on an external device before you begin.

:::

To safely convert to a new file system type:

1. **Copy all data off the drive**: Move your files to another location. This could be another drive in your %%array|array%%, a %%cache pool|cache-pool%%, or an external backup.  
   - Prior to Unraid 7.0, you will need to move the files manually
   - Starting with Unraid 7.0, you can move files [use 'mover' to empty an array disk](../../release-notes/7.0.0.md#using-mover-to-empty-an-array-disk) to other array drives via the command line 
   - Starting with Unraid 7.2, you can empty an array drive to other array drives via the webGUI:
     - Navigate to ***Main → Array Operation*** and stop the array
     - Navigate to ***Settings → Global Share Settings***. In the **Emptying disk(s)** area, select the disk(s) to empty and **Apply**. Note: this status will automatically be removed when the array is stopped.
     - Navigate to ***Main → Array Operation*** and start the array
     - On ***Main → Array Operation*** click **Move** (or wait until mover runs via its normal schedule)
     - Mover will empty the disk according to your Share settings. Note that files at the root of the drive are outside of any Shares and will not be moved.
     - Check ***Tools → System Log*** for messages about any files that could not be moved due to being in use or a lack of free space
   - Navigate to ***Main → Array Devices*** and browse the disk to confirm it is empty. Proceed only when you are certain the disk is empty.
2. **Change the file system type**: Follow the procedure for [changing a file system type](#changing-a-file-system-type). This will format the drive and erase all content, leaving you with a blank drive in the new format.
3. **Copy your data back**: Move the saved files back to the newly formatted drive.
4. **Repeat as needed**: If you have more than one drive to convert, repeat these steps for each drive, transferring data as needed.

:::note Timing

The process can take several hours, depending on the amount of data and the speed of your drives. Most of the time is spent copying files, which can run unattended.

:::

---

## Reformatting a drive

Reformatting a drive in Unraid will erase all of your data and create a new, empty file system. This process is useful for resolving persistent file system errors or starting fresh with a new format.

:::warning

Reformatting will permanently erase all data on the drive. Always back up any important files before you begin.

:::

To **safely** reformat your drive:

1. **Stop the array**.
2. **Change the file system type**:
   - Go to the **Main** tab and click on the drive you want to reformat.
   - Select a different file system type (for example, change from %%XFS|xfs%% to %%BTRFS|btrfs%%).
   - Start the %%array|array%%, and the drive will show as **unmountable**.
   - When prompted, format the drive.
3. **(Optional) Change back to your original file system type**:
   - Stop the %%array|array%% again.
   - Change the file system back to your preferred type.
   - Start the %%array|array%% and format the drive once more.

This simple process ensures that the drive is fully wiped and formatted as you desire. The formatting process usually takes just a few minutes.

### Reformatting a cache drive

Sometimes, you'll need to reformat a %%cache|cache%% drive for the following reasons:

- To change the file system type (for example, from %%BTRFS|btrfs%% to %%XFS|xfs%% or vice versa)
- To fix persistent file system errors
- To start fresh for new workloads

<h4>Recommended procedure for reformatting a cache drive</h4>

1. **Stop the array**.
2. **Disable Docker and %%VM|vm%% services** under **Settings**.
3. **Start the array** (this will prevent the Docker and %%VM|vm%% tabs from appearing).

To move data off the cache:

4. **Set share storage and Mover action (cache → array)**: For each share that has files in the %%cache|cache%%, set **Primary storage** to the source %%cache|cache%% pool and **Secondary storage** to the %%array|array%%. Set **Mover action** to **cache → array**.
   - Note down any shares you change and their original settings.
5. **Run %%Mover|mover%%**: Run %%Mover|mover%% from the **Main** tab. Wait for it to finish and ensure that the %%cache|cache%% is empty.
   - If any files remain, stop and check the forums for help.

To reformat the cache drive:

6. **Stop the array**.
7. **Set the cache drive format** (choose between %%XFS|xfs%% or %%BTRFS|btrfs%%).
   - For a single-drive %%cache|cache%%, %%XFS|xfs%% is the recommended option.
   - Note that %%XFS|xfs%% is only available if you have one %%cache|cache%% slot.
8. **Start the array**.
9. **Format the cache drive**:
   - Confirm that only the %%cache|cache%% drive is listed as unmountable.
   - Proceed to format the drive.

To restore data and settings:

10. **Restore share settings**: For each share you changed, set **Primary storage** and **Secondary storage** back to their original values.
11. **Move data back (array → cache)**: Set **Primary storage** to the destination %%cache|cache%% pool and **Secondary storage** to the %%array|array%% for each share you changed. Set **Mover action** to **array → cache**, then run the %%Mover|mover%% again to move your data back to the %%cache|cache%%.
12. **Stop the array**.
13. **Re-enable Docker and %%VM|vm%% services**.
14. **Start the array**.

:::note Timing

The time it takes to move data with the %%Mover|mover%% and format the drive can vary from several minutes to several hours, depending on the amount of data and the speed of the drive.

:::

---

## BTRFS operations

Maintaining your %%BTRFS|btrfs%% pools in Unraid is essential for keeping them running well and ensuring your data stays safe. Two key tools you’ll want to use regularly are **Balance** and **Scrub**. These operations help solve space allocation problems, optimize your storage use, and protect your data from hidden corruption.

Let’s break down what each operation does and when to use them:

<Tabs>
  <TabItem value="balance" label="Balance" default>

    The **Balance** operation redistributes data and metadata chunks across your %%BTRFS|btrfs%% pool. This process helps free up space, resolves allocation issues, and can fix “no space left on device” errors even when space seems available.

    <h4>When to run Balance</h4>

    - When you encounter “no space left on device” errors but have free space.
    - After adding or removing drives in a pool.
    - To optimize space usage and improve performance.

    <h4>How to run Balance</h4>

    1. **Access the pool**: In the %%WebGUI|web-gui%%, click on the pool in the **Main** tab and select **Balance**.
    2. **Add parameters (optional)**: Optionally, add parameters for advanced use (refer to Unraid Help for details).
    3. **Start the process**: Click **Start** to begin the process.

    :::note Timing

    Balance operations can take a few minutes to several hours, depending on the pool size and amount of data.

    :::

  </TabItem>

  <TabItem value="scrub" label="Scrub">

    The **Scrub** operation reads all data and metadata, checks the integrity of checksums, and repairs any corrupt blocks using available redundant copies. Scrubbing helps identify and fix silent data corruption, known as “bit rot,” before it becomes a significant issue.

    <h4>When to run Scrub</h4>

    - As part of routine maintenance (see recommended schedule below).
    - After unclean shutdowns or if you suspect corruption.
    - More frequently on high-usage pools.

    <h4>Recommended schedule</h4>

    - High-usage pools: **Once a week**
    - All other pools: **Once a month**

    <h4>How to run Scrub</h4>

    1. **Access the pool**: In the %%WebGUI|web-gui%%, click on the pool in the **Main** tab and select **Scrub**.
    2. **Start the process**: Click **Start** to initiate the process.

    :::note Timing

    Scrub operations are usually quicker than a full disk scan because they only check allocated data. Based on pool size and usage, expect this to take anywhere from a few minutes to a few hours.

    :::

  </TabItem>
</Tabs>

:::tip

Both **Balance** and **Scrub** can be performed while the system is online, but keep in mind that performance may be affected during these operations. You can monitor the progress in the %%WebGUI|web-gui%%.

:::

For more details on advanced %%BTRFS|btrfs%% features, check out the [official BTRFS documentation](https://btrfs.readthedocs.io/en/latest/Introduction.html).

---

## Unassigned drives

Unassigned drives are storage devices connected to your Unraid server that aren't part of the main %%array|array%% or any %%cache pool|cache-pool%%. You can use these drives to transfer files, create backups, or provide fast storage for %%virtual machines|vm%%.

:::note

All drives connected to your server when the %%array|array%% starts count toward your Unraid Attached Devices license limit, even if they aren’t assigned to the %%array|array%% or a pool.

:::

<h4>Common uses for unassigned drives</h4>

- Connect removable drives for easy file transfers or backups.
- Use dedicated drives for high-performance tasks like running %%virtual machines|vm%% or temporary data storage.

### Using the Unassigned Devices plugins

To make the most of your unassigned drives, consider installing the following plugins from the **Apps** tab:

- **[Unassigned Devices](https://unraid.net/community/apps?q=dlandon\&r=0#:~:text=and%20iso%20files.-,Unassigned%20Devices,-dlandon):** This plugin allows you to mount, share, and manage drives with file systems that Unraid supports, like %%XFS|xfs%%, %%BTRFS|btrfs%%, or NTFS.

- **[Unassigned Devices Plus](https://unraid.net/community/apps?q=dlandon\&r=0#:~:text=and%20iso%20files.-,Unassigned%20Devices%20Plus,-\(Addon\)):** This extension broadens your options by supporting additional file systems, including ExFAT and HFS+.

These plugins enable:

- Easily mounting and unmounting drives from the Unraid web interface.
- Sharing your unassigned drives over the network.
- Automating the mounting process when the server boots up.
- Formatting or erasing drives for future use.
- Safely disconnecting USB or external drives without hassle.

For more details on installing and managing plugins, check out [Plugins](../customize-your-experience/plugins.mdx).

---

## Troubleshooting

### Drive shows as unmountable

If you see that a drive in Unraid is **unmountable**, it could be due to one of two main reasons:

1. **New drive added**: If you just added a new drive to your setup, it will show as unmountable until you format it. Formatting creates a file system that allows the drive to store files. You can find the steps to format a drive [here](#creating-a-file-system-formatting).

2. **File system problems**: If a drive that was previously working suddenly shows as unmountable, it likely has a file system issue. This can happen due to unexpected shutdowns, problems while writing data, or if the drive has been marked as disabled (which appears as a red 'x' in the %%WebGUI|web-gui%%).

:::important

Do not format an unmountable drive unless you are okay with losing all the data on it. Formatting will erase everything and update the %%parity|parity%% information, making recovery impossible. Always try to fix the file system first.

:::

If your drive is unmountable:

1. **Identify the situation**: Determine if it's a new drive or a previously working drive.
2. **For new drives**: Format the drive to create a new file system (check the [formatting steps](#creating-a-file-system-formatting)).
3. **For previously working drives**: Perform a file system check or repair (see [Checking a file system](#checking-a-file-system)). Avoid formatting if you want to keep the data.

:::note

If a drive is both unmountable and disabled (red 'x'), first run the file system check/repair on the **emulated** drive. If the emulated drive is also unmountable and you attempt to rebuild it, the new drive will also be unmountable.

:::

Fixing the file system typically takes less time than rebuilding the drive, allowing you to access your data without losing anything. Remember, rebuilding a drive does **not** fix file system issues; it merely ensures that the physical drive matches the emulated one, carrying over any existing problems.

:::important Why is parity not enough?

While %%parity|parity%% helps recover a failed drive, it cannot fix file system problems. If the file system is corrupted, %%parity|parity%% will simply replicate that corruption to the new drive.

If you’re unsure:

- Download your system logs by navigating to ***Tools → Diagnostics***.
- For expert help, post your issue along with the diagnostics on the [Unraid forums](https://forums.unraid.net/).

:::

:::note Just to reiterate

- Only format unmountable drives if they are brand new or if you want to erase all data.
- Use the file system check/repair for fixing corrupt files; don’t rely on %%parity|parity%% to solve these issues.
- For %%cache pools|cache-pool%% with multiple drives, consider using either %%BTRFS|btrfs%% or %%ZFS|zfs%%.
- Always double-check before formatting or repairing drives to avoid accidental loss of data.

:::

---

### Checking a file system

If a disk that previously mounted without issues now shows as **unmountable**, it typically indicates file system corruption. This may result from an unclean shutdown, a failed write operation, or the disk being marked as disabled in the %%WebGUI|web-gui%%. Checking and repairing the file system is generally quicker and safer than performing a rebuild, so it's advisable to try this before formatting or rebuilding the disk.

:::important

If the %%WebGUI|web-gui%% suggests formatting an unmountable drive, <strong>do not format</strong> unless you intend to erase all data. Formatting will destroy the contents of the drive and update %%parity|parity%%, making recovery impossible.

:::

<h4>Preparing to check or repair</h4>

1. **Identify the file system type**:
   - Navigate to the **Main** tab and select your disk (e.g., Disk 3, Cache).
   - Find the **File system type** (should be %%XFS|xfs%%, %%BTRFS|btrfs%%, or %%ZFS|zfs%%).

2. **Start the array in the correct mode**:
   - For **%%XFS|xfs%%**, start the %%array|array%% in **%%Maintenance Mode|maintenance-mode%%**.
   - For **%%BTRFS|btrfs%%**, start the %%array|array%% in **Normal mode** for a %%scrub|scrub%% or **%%Maintenance Mode|maintenance-mode%%** for a repair.
   - For **%%ZFS|zfs%%**, refer to the %%ZFS|zfs%% section below.

3. **Handle emulated disks**: If the disk is disabled and being emulated, run the check/repair on the %%emulated disk|emulated-disk%% before attempting a rebuild. If the %%emulated disk|emulated-disk%% is unmountable, the rebuilt disk will also be unmountable.

<h4>Common error messages</h4>

| Message                                             | Meaning / Action                                             |
| --------------------------------------------------- | ------------------------------------------------------------ |
| **Superblock has bad magic number**                 | Severe corruption; attempt a file system repair.             |
| **Filesystem is dirty**                             | Unclean shutdown; execute a file system check.               |
| **Metadata corruption detected**                    | File system structures are damaged; initiate a repair.       |
| **No valid %%BTRFS\|btrfs%% found**                 | Disk may not belong to a valid pool; check pool assignments. |
| **Mount: wrong fs type, bad option, etc.**          | Incorrect file system selection or disk is unformatted.      |
| **Cannot mount /dev/mdX: Structure needs cleaning** | File system is corrupted; perform a repair.                  |

#### Via the WebGUI

1. **Start the array**: Start the %%array|array%% in the correct mode (refer to the steps above).
2. **Select the disk**: Go to the **Main** tab and select the disk you wish to check.
3. **Access check options**: Scroll to **Check Filesystem Status**.
4. **For XFS (Unraid 7.0+)**: You will see a **CHECK** button without any options to enter. The system automatically determines the necessary actions based on the check results.
5. **For other file systems**: Enter any necessary options (for details, see **Help** in the upper right).
6. **Start the check**: Click **Check** to initiate the process.
7. **Monitor progress**: Monitor the progress in the output box. Use **Refresh** if required.
8. **Review results**: Review the results. If uncertain, copy the output and post it on the [forums](https://forums.unraid.net/) for advice.

#### XFS Automatic Repair Workflow (Unraid 7.0+)

Starting with Unraid 7.0, XFS file system repair is now fully automated through the WebGUI:

1. **Initial Check**: Click the **CHECK** button (no options to enter)
2. **Check Results**:
   - **No corruption detected**: Shows "no filesystem corruption detected" and the **CHECK** button remains
   - **Corruption detected**: Shows "filesystem corruption detected" and a **FIX** button appears
3. **Repair Process**: Click **FIX** to automatically repair the file system
4. **Additional Actions**: If needed, a **ZERO LOG** button may appear
5. **Completion**: Shows "filesystem repaired" when the process is complete

This automated system eliminates the need for users to manually enter repair options and ensures the correct repair sequence is followed.

#### Via the command line

<Tabs>
  <TabItem value="xfs" label="XFS">

    To check an %%XFS|xfs%% file system via command line:

    - Start the %%array|array%% in **%%Maintenance Mode|maintenance-mode%%**.
    - Run the following command: `xfs_repair -v /dev/mdXp1`
    - Replace `X` with the disk number (e.g., `/dev/md1p1`).
    - For encrypted %%XFS|xfs%%, use `/dev/mapper/mdXp1`.
    - For drives not in the %%array|array%%: `xfs_repair -v /dev/sdX1`
    - Ensure you are using the correct device identifier.

    :::warning

    Running this command on an %%array|array%% disk outside of **%%Maintenance Mode|maintenance-mode%%** will invalidate %%parity|parity%%.

    :::

  </TabItem>

  <TabItem value="btrfs" label="BTRFS">

    To check a %%BTRFS|btrfs%% file system via command line:

    - To perform a %%scrub|scrub%% (which checks and repairs many errors automatically), start the %%array|array%% in **Normal mode** and run: `btrfs scrub start /mnt/diskX`
    - For a read-only check, start the %%array|array%% in **%%Maintenance Mode|maintenance-mode%%** and run: `btrfs check --readonly /dev/mdXp1`
    - Replace `X` with the disk number.
    - For drives not in the %%array|array%%: `btrfs check --readonly /dev/sdX1`

    :::warning

    Running this command on an %%array|array%% disk outside of **%%Maintenance Mode|maintenance-mode%%** will invalidate %%parity|parity%%.

    :::

  </TabItem>

  <TabItem value="zfs" label="ZFS">

    To check a %%ZFS|zfs%% file system via the command line:

    <h4>Recommended method</h4>

    %%ZFS|zfs%% uses **scrubbing** instead of traditional filesystem checks like `fsck`. A %%scrub|scrub%% examines all data in the pool to verify checksums and automatically repairs any corruption found on redundant configurations.

    - Start the %%array|array%% in **Normal mode** and run: `zpool scrub poolname`
      - Replace `poolname` with your actual %%ZFS|zfs%% pool name.

    <h4>Check pool status</h4>
    To view the current health and any ongoing %%scrub|scrub%% progress, use the command: `zpool status -v poolname`

    This command shows detailed information about pool health, any errors, and %%scrub|scrub%% progress.

    <h4>Additional %%ZFS|zfs%% commands</h4>

    - To pause a %%scrub|scrub%%: `zpool scrub -p poolname`
    - To stop a %%scrub|scrub%%: `zpool scrub -s poolname`
    - To list all pools: `zpool list`

    :::info

    %%ZFS|zfs%% does not require or support traditional `fsck` utilities. The transactional nature of %%ZFS|zfs%% means it moves atomically from one consistent state to another, making scrubbing the preferred method for integrity checking.\\

    :::
    For comprehensive guidance on %%ZFS|zfs%% file systems, check out the dedicated [ZFS storage section](../../advanced-configurations/optimize-storage/zfs-storage.mdx).

  </TabItem>
</Tabs>

:::tip

- File system repairs are generally faster than a complete rebuild and can restore access without data loss.
- Rebuilding a disk does **not** resolve file system corruption; always run a check or repair first.
- If you have doubts, post your diagnostics and error messages on the Unraid [forums](https://forums.unraid.net/) for expert assistance.

:::

---

### Repairing a file system

If a check of your file system finds errors, you might need to run a repair to get access to your data again. Repairs typically take less time than a full rebuild, but it's important to read the output carefully and reach out for help on the [forums](https://forums.unraid.net/) if you're unsure about anything.

:::note Timing

Repairs can take anywhere from several minutes to several hours, especially for larger or heavily corrupted file systems. Progress might seem slow, but you can check on the activity by looking at the read/write statistics on the Main page.

:::

<h4>Preparing to repair</h4>

1. **Identify the file system type**: Go to the **Main** tab, click on the disk, and find out what type of file system it is (%%XFS|xfs%%, %%BTRFS|btrfs%%, or %%ZFS|zfs%%).

2. **Start the array in the correct mode**:

   - **For %%XFS|xfs%%:** Use **%%Maintenance Mode|maintenance-mode%%**.
   - **For %%BTRFS|btrfs%%:** Use **Normal mode** for a %%scrub|scrub%%; use **%%Maintenance Mode|maintenance-mode%%** for a repair.
   - **For %%ZFS|zfs%%:** Use **Normal mode** and run a %%scrub|scrub%% to check for errors.  See the [ZFS storage page](../../advanced-configurations/optimize-storage/zfs-storage.mdx) for guidance on %%ZFS|zfs%% pool maintenance and repair procedures.

3. **Handle emulated disks**: If the disk is disabled and being emulated, run the repair on the %%emulated disk|emulated-disk%% before trying to do a rebuild.

#### Via the WebGUI

1. **Start the array**: Start the %%array|array%% in the correct mode (refer to the section above).
2. **Select the disk**: Go to the **Main** tab and click on the disk you want to repair.
3. **Access repair options**: Scroll down to **Check Filesystem Status**.
4. **For XFS (Unraid 7.0+)**: The repair process is fully automated. Click **CHECK**, then **FIX** if corruption is detected, and **ZERO LOG** if prompted.
5. **For other file systems**: Remove any options that would run the process in check-only mode (like `--readonly` for %%BTRFS|btrfs%%).
6. **Add suggested options**: If prompted, add the suggested options as indicated in the check output.
7. **Start the repair**: Click on **Check** to begin the repair.
8. **Monitor progress**: Keep an eye on the progress in the output box. Use **Refresh** if needed.
9. **Check for lost files**: If you notice a `lost+found` folder after the repair, it may contain files or folders that couldn't be fully recovered. Use backups or the Linux `file` command to identify the contents if necessary.

:::info

If you're uncertain about the output, copy and share it on the [Unraid forums](https://forums.unraid.net/) for expert help. Use the code formatting option to keep it readable.

:::

#### Via the command line

<Tabs>
  <TabItem value="xfs" label="XFS">

    - Start the %%array|array%% in **%%Maintenance Mode|maintenance-mode%%**.
    - Run the following command: `xfs_repair /dev/mdXp1`. Replace `X` with the disk number (e.g., `/dev/md1p1`).
    - For encrypted %%XFS|xfs%%, use: `/dev/mapper/mdXp1`.
    - If you're prompted to use `-L`, re-run the command like this: `xfs_repair -L /dev/mdXp1`. This is usually safe and necessary to complete the repair.
    - For drives that are not part of the %%array|array%%: `xfs_repair /dev/sdX1`.

    :::caution

    Running this command on an %%array|array%% disk outside of **%%Maintenance Mode|maintenance-mode%%** will invalidate parity.

    :::

  </TabItem>

  <TabItem value="btrfs" label="BTRFS">

    - To perform a %%scrub|scrub%% (which detects and repairs many errors automatically), start the %%array|array%% in **Normal mode** and run: `btrfs scrub start /mnt/diskX`.
    - For a full repair, start the %%array|array%% in **%%Maintenance Mode|maintenance-mode%%** and run: `btrfs check --repair /dev/mdXp1`. Only use `--repair` if advised by the [forums](https://forums.unraid.net/) or documentation, as it can sometimes lead to further issues.

    :::caution Use `--repair` with caution

    The `--repair` option can sometimes cause data loss or make corruption worse if used incorrectly. Only use it when:

    - You've consulted the [Unraid forums](https://forums.unraid.net/) for your specific error
    - You have a recent backup of your data
    - You understand the risks involved

    For most %%BTRFS|btrfs%% issues, try running a `scrub` first (which is safer) or seek expert advice before attempting repairs.

    :::

  </TabItem>

  <TabItem value="zfs" label="ZFS">
    %%ZFS|zfs%% pools offer built-in integrity checking and self-healing capabilities, which often eliminate the need for traditional file system repairs.

    <h4>For %%ZFS|zfs%% pools</h4>

    - **Check pool health:** Use the command `zpool status poolname` to see the status of your pool.
    - **Run a scrub:** Execute `zpool scrub poolname`. This command detects and repairs any corruption automatically.
    - **Clear errors:** After addressing any underlying issues, run `zpool clear poolname` to clear the error state.

    <h4>For %%ZFS|zfs%% disks in the array</h4>

    - **Check dataset health:** Use `zfs list -o name,health` to check the health of your datasets.
    - **Run a scrub:** You can also run `zpool scrub poolname` for any disks belonging to a specific pool.

    %%ZFS|zfs%% automatically identifies and fixes data corruption when redundancy is available, such as in mirrors or %%RAIDZ1|raidz1%%/%%RAIDZ2|raidz2%%/%%RAIDZ3|raidz3%% configurations. Unlike traditional file systems, %%ZFS|zfs%% typically does not require manual repair commands because it continuously monitors data integrity with checksums.

    :::tip

    For a comprehensive understanding of %%ZFS|zfs%% management, troubleshooting, and advanced repair scenarios, refer to the dedicated [ZFS storage page](../../advanced-configurations/optimize-storage/zfs-storage.mdx) for detailed guides and best practices.

    :::

  </TabItem>
</Tabs>

:::info After the repair

- Stop and restart the %%array|array%% in **Normal mode**.
- The drive should now mount and be accessible.
- If you see a `lost+found` folder, check its contents for any important files.

:::

If you don't understand the repair output or if the process fails, share your diagnostics and repair log on the [Unraid forums](https://forums.unraid.net/) for further assistance.
