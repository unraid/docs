---
sidebar_position: 2
sidebar_label: Unclean shutdowns
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import {translate} from '@docusaurus/Translate';
import UncleanShutdownsPower from './partials/unclean-shutdowns/unexpected-power-loss.mdx';
import UncleanShutdownsFlash from './partials/unclean-shutdowns/flash-drive-failure.mdx';
import UncleanShutdownsTerminal from './partials/unclean-shutdowns/open-terminal-sessions.mdx';

# Unclean shutdowns

An unclean shutdown happens when Unraid detects that the %%array|array%% was not properly stopped before the system powered off. This situation can trigger an automatic %%parity check|parity-check%% during the next boot to ensure data integrity.

:::important[Recommendations to prevent unclean shutdowns]

Taking some proactive steps can help you avoid or identify unclean shutdowns:

- **Use a UPS:** Keep your server connected to an Uninterruptible Power Supply (UPS) and set it up to initiate a controlled shutdown when battery power runs low.
- **Attempt a graceful shutdown:** If your server is unresponsive, briefly press the power button to trigger a safe shutdown. Do not hold the button down, as this will force a hard power off and lead to an unclean shutdown.
- **Enable persistent logging:** Go to ***Settings → Syslog Server*** to activate logging that persists after a reboot. See [Persistent logs (Syslog server)](../diagnostics/capture-diagnostics-and-logs.mdx#persistent-logs-syslog-server) for more details.
- **Attach diagnostics for support:** If an unclean shutdown occurs, Unraid will attempt to save diagnostics to `/log/diagnostics.zip` on your flash device. Attach this file to forum posts when you seek help.

:::

:::tip[UPS configuration best practices]

A well-configured UPS is your best defense against unclean shutdowns caused by power loss.

- **Connect the UPS via USB** to your Unraid server.
- **Enable UPS support** in ***Settings → UPS Settings***.
- **Configure shutdown timeouts:** Set the UPS to trigger a controlled shutdown before the battery runs low. Adjust the "Battery runtime left" or "Battery charge level" thresholds to provide enough time for Unraid to [stop the %%array|array%%](../../using-unraid-to/manage-storage/array-configuration.mdx#startstop-the-array) and power down safely.
- **Test your configuration:** Simulate a power loss to ensure the UPS and Unraid respond correctly.

Look into the [NUT plugin](https://unraid.net/community/apps/c/plugins/p4?srsltid=AfmBOop675PrJQW4iqb4JBN3GyPpwDDiSmnZReq78t27XyxkFdMX8inO#:~:text=NUT%20%2D%20Network%20UPS%20Tools) for broader compatibility with more advanced UPS models or unsupported hardware.

:::

## Events That Cause Unclean Shutdowns

Understanding the main triggers for unclean shutdowns helps you prevent them. Explore the tabs below for details on each scenario.

<Tabs>
  <TabItem
    value="power"
    label={translate({ id: 'uncleanShutdowns.tabs.power', message: 'Unexpected power loss' })}
    default>
    <UncleanShutdownsPower />
  </TabItem>

  <TabItem
    value="flash"
    label={translate({ id: 'uncleanShutdowns.tabs.flash', message: 'Flash drive failure' })}>
    <UncleanShutdownsFlash />
  </TabItem>

  <TabItem
    value="terminal"
    label={translate({ id: 'uncleanShutdowns.tabs.terminal', message: 'Open terminal sessions' })}>
    <UncleanShutdownsTerminal />
  </TabItem>
</Tabs>

---

## Configuring shutdown timeouts

Properly configuring shutdown timeouts is essential to ensure your Unraid server can stop all services effectively, preventing unclean shutdowns, particularly during power loss or maintenance. Each component of your system - %%VM|vm%%s, Docker containers, and the overall %%array|array%% - has its own timeout setting that can be adjusted.

### Recommended timeout settings

| Setting                       | Default | Recommended minimum                              | Where to configure                                   |
| ----------------------------- | ------- | ------------------------------------------------ | ---------------------------------------------------- |
| %%VM\|vm%% shutdown timeout   | 60s     | 300s (5 min)                                     | ***Settings → VM Manager → VM Shutdown (Advanced)*** |
| Docker container stop timeout | 10s     | 30–60s                                           | ***Settings → Docker (Advanced)***                   |
| General shutdown timeout      | 90s     | 3 × %%VM\|vm%% timeout + Docker timeout + 15–30s | ***Settings → Disk Settings → Shutdown time-out***   |

### Virtual machines timeout

<details>
  <summary><strong>Click to expand/collapse</strong></summary>

  Unraid first shuts down all configured virtual machines (%%VMs|vm%%) before stopping Docker containers or the %%array|array%% itself. The VM Shutdown Timeout determines how long Unraid waits for each %%VM|vm%% to shut down gracefully.

  <h4>Where to set</h4>

  - ***Settings → VM Manager → VM Shutdown*** (enable Advanced view)

  <h4>Consider</h4>

  - Windows %%VMs|vm%% may take longer to shut down, especially if updates are pending or the %%VM|vm%% is in sleep/hibernation.
  - If the timeout is too short, %%VMs|vm%% will be force-stopped, risking data loss or corruption.

  <h4>Best practice</h4>

  Set the timeout to at least 300 seconds (5 minutes) for Windows %%VMs|vm%%. Schedule updates to run at boot, not shutdown, to avoid delays.

</details>

### Docker containers timeout

<details>
  <summary><strong>Click to expand/collapse</strong></summary>

  After %%VMs|vm%%, Unraid stops all running Docker containers. The Docker Container Stop Timeout controls how long Unraid waits for each container to exit cleanly.

  <h4>Where to set</h4>

  - ***Settings → Docker*** (enable Advanced view)

  <h4>Consider</h4>

  - Containers are stopped in parallel.
  - Complex containers, or those with large databases, may need more than the default 10 seconds to shut down safely.
  - If the timer expires, containers are force-stopped.

  <h4>Best practice</h4>
  Increase the timeout to 30–60 seconds if you run Docker containers that require additional shutdown time.

</details>

### General shutdown timer

<details>
  <summary><strong>Click to expand/collapse</strong></summary>

  The overall Shutdown time-out is the maximum time Unraid allows for all shutdown processes - %%VM|vm%%s, Docker, and disk operations - before forcing a shutdown.

  <h4>Where to set</h4>

  - ***Settings → Disk Settings → Shutdown time-out***

  <h4>How to calculate</h4>

  Add up your %%VM|vm%% and Docker timeouts, then add 15–30 seconds for disk unmounting and other processes.

  - Example: `3 × ***VM Shutdown timeout*** + ***Docker stop timeout*** + 15–30 seconds`

  <h4>Best practice</h4>
  Set this timer high enough to cover your slowest shutdown scenario, especially if you have many drives or a large %%array|array%%.

</details>

### UPS battery life

<details>
  <summary><strong>Click to expand/collapse</strong></summary>

  Your UPS must provide enough runtime to allow all shutdown timers to expire before the server loses power.

  <h4>Where to set</h4>

  - ***Settings → UPS Settings*** (see **Runtime left** with all disks spun up)

  <h4>Consider</h4>

  - The UPS should trigger a shutdown early enough to allow the full shutdown sequence to complete.
  - If the battery runs out before shutdown completes, you risk an unclean shutdown and possible data loss.

  <h4>Best practice</h4>

  Test your UPS by simulating a power outage and confirming that Unraid shuts down cleanly with time to spare.

</details>
